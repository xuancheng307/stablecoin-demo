<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>統一集團穩定幣生態系統創新應用提案</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", "微軟正黑體", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.15);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.8em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
            height: 80vh;
        }
        
        #ecosystem-container {
            background: #fafafa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        #ecosystem-svg {
            width: 100%;
            height: 100%;
            cursor: default;
        }
        
        .sidebar {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            overflow-y: auto;
            max-height: 100%;
        }
        
        .controls {
            margin-bottom: 25px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group h3 {
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-group h3::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        button {
            width: 100%;
            padding: 12px 20px;
            margin-bottom: 8px;
            border: none;
            border-radius: 8px;
            background: #fff;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .legend {
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .legend-item:hover {
            background: #f0f0f0 !important;
            transform: translateX(2px);
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .legend-label {
            font-size: 14px;
            color: #555;
            flex: 1;
        }
        
        .legend-count {
            font-size: 12px;
            color: #999;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .tooltip {
            position: absolute;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            border-radius: 10px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            max-width: 350px;
            line-height: 1.5;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-style: solid;
            border-width: 0 8px 8px 8px;
            border-color: transparent transparent rgba(0, 0, 0, 0.95) transparent;
        }
        
        .info-panel {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            display: none;
            animation: slideIn 0.3s ease;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 1001;
            background: white;
        }
        
        /* 價值流動卡片樣式 */
        .flow-card {
            padding: 20px;
            border-radius: 12px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }
        
        .flow-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .flow-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .flow-name {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .flow-amount {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .flow-frequency {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }
        
        .flow-card.large .flow-name {
            font-size: 18px;
        }
        
        .flow-card.large .flow-amount {
            font-size: 24px;
        }
        
        .flow-card.medium .flow-name {
            font-size: 16px;
        }
        
        .flow-card.medium .flow-amount {
            font-size: 18px;
        }
        
        .flow-card.small .flow-name {
            font-size: 14px;
        }
        
        .flow-card.small .flow-amount {
            font-size: 16px;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .info-panel h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-panel .icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .info-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .info-section h4 {
            color: #34495e;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .info-section p {
            color: #555;
            line-height: 1.6;
            margin: 5px 0;
        }
        
        .info-section ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .info-section li {
            color: #666;
            margin: 5px 0;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .flow-indicator {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }
        
        .search-box {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .zoom-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .sidebar {
                order: -1;
            }
            
            #ecosystem-container {
                height: 60vh;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .main-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .info-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <header>
            <h1>統一集團穩定幣生態系統</h1>
            <p class="subtitle">Web3創新應用整合提案 - 概念展示</p>
            <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin: 20px 0; font-size: 0.9em; color: #856404;">
                <strong>📋 重要說明：</strong> 本展示為統一集團Web3創新應用整合提案的概念示意圖，展示內容包含現有業務整合與未來創新應用構想。部分功能與數據為概念性展示，實際實施需依據法規環境、技術發展及商業評估而定。
            </div>
        </header>
        
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value">15-60億</div>
                <div class="stat-label">年手續費節省</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">1-3億</div>
                <div class="stat-label">匯兌成本節省/年</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">2.5億</div>
                <div class="stat-label">食品召回成本降低/案</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">28.5-102.5億</div>
                <div class="stat-label">總效益潛力/年</div>
            </div>
        </div>
        
        <div class="dashboard" id="main-dashboard">
            <div id="ecosystem-container">
                <svg id="ecosystem-svg"></svg>
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <button class="zoom-btn" onclick="zoomOut()">−</button>
                    <button class="zoom-btn" onclick="resetZoom()">⟲</button>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="controls">
                    <input type="text" class="search-box" placeholder="搜尋業務單位..." oninput="searchNodes(this.value)">
                    
                    <div class="control-group">
                        <h3>業務流程</h3>
                        <button onclick="highlightFlow('retail')">
                            <span>🛒</span> 零售支付流程
                        </button>
                        <button onclick="highlightFlow('supply')">
                            <span>📦</span> 供應鏈流程
                        </button>
                        <button onclick="highlightFlow('finance')">
                            <span>💰</span> 金融服務流程
                        </button>
                        <button onclick="highlightFlow('cross')">
                            <span>🌍</span> 跨境交易流程
                        </button>
                    </div>
                    
                    <div class="control-group">
                        <h3>核心效益分析</h3>
                        <button onclick="showEfficiencyAnalysis()">
                            <span>💰</span> 綜合效益分析
                        </button>
                        <button onclick="showRiskMap()">
                            <span>⚠️</span> 風險節點分析
                        </button>
                        <button onclick="showTechInfrastructureAnalysis()">
                            <span>⚙️</span> 基礎設施能力評估
                        </button>
                    </div>
                    
                    <div class="control-group">
                        <h3>視圖控制</h3>
                        <button onclick="toggleAnimation()">
                            <span>🎬</span> 動畫效果
                        </button>
                        <button onclick="showAllConnections()">
                            <span>🔗</span> 顯示所有連接
                        </button>
                        <button onclick="resetView()">
                            <span>🔄</span> 重置視圖
                        </button>
                        
                        <!-- 將圖例說明移到視圖控制組內，明確其適用範圍 -->
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                            <h4 style="color: #2c3e50; font-size: 1.1em; margin-bottom: 10px;">節點類型篩選</h4>
                            <div class="legend-item" onclick="filterByType('core')" style="margin-bottom: 8px; padding: 10px 12px; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                <div class="legend-color" style="background: #FF6B6B; width: 14px; height: 14px; border-radius: 50%; display: inline-block; margin-right: 10px;"></div>
                                <span class="legend-label" style="font-size: 15px; font-weight: 500; color: #2c3e50;">核心技術</span>
                                <span class="legend-count" style="font-size: 13px; color: #666; margin-left: 6px;">(2)</span>
                            </div>
                            <div class="legend-item" onclick="filterByType('business')" style="margin-bottom: 8px; padding: 10px 12px; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                <div class="legend-color" style="background: #FF9F40; width: 14px; height: 14px; border-radius: 50%; display: inline-block; margin-right: 10px;"></div>
                                <span class="legend-label" style="font-size: 15px; font-weight: 500; color: #2c3e50;">業務單位</span>
                                <span class="legend-count" style="font-size: 13px; color: #666; margin-left: 6px;">(7)</span>
                            </div>
                            <div class="legend-item" onclick="filterByType('finance')" style="margin-bottom: 8px; padding: 10px 12px; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                <div class="legend-color" style="background: #4ECDC4; width: 14px; height: 14px; border-radius: 50%; display: inline-block; margin-right: 10px;"></div>
                                <span class="legend-label" style="font-size: 15px; font-weight: 500; color: #2c3e50;">金融服務</span>
                                <span class="legend-count" style="font-size: 13px; color: #666; margin-left: 6px;">(2)</span>
                            </div>
                            <div class="legend-item" onclick="filterByType('partner')" style="margin-bottom: 8px; padding: 10px 12px; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                <div class="legend-color" style="background: #6C5CE7; width: 14px; height: 14px; border-radius: 50%; display: inline-block; margin-right: 10px;"></div>
                                <span class="legend-label" style="font-size: 15px; font-weight: 500; color: #2c3e50;">合作夥伴</span>
                                <span class="legend-count" style="font-size: 13px; color: #666; margin-left: 6px;">(1)</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 移除獨立的圖例區塊 -->
                
                <div class="flow-description" id="flow-description" style="display: none;">
                    <div class="control-group">
                        <button onclick="returnToMain()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; margin-bottom: 20px;">
                            <span>🔙</span> 返回主頁面
                        </button>
                    </div>
                    
                    <div class="flow-header">
                        <h2 id="flow-title" style="margin-bottom: 10px; font-size: 1.4em;"></h2>
                        <p id="flow-desc" style="color: #666; line-height: 1.6; margin-bottom: 25px; font-size: 1em;"></p>
                    </div>
                    
                    <div class="flow-content">
                        <div class="flow-section">
                            <div id="flow-steps"></div>
                        </div>
                        <div class="flow-section">
                            <div id="flow-benefits"></div>
                        </div>
                        <div class="flow-section">
                            <div id="flow-nodes"></div>
                        </div>
                        <div class="flow-section">
                            <div id="flow-metrics"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 流程詳情頁面 -->
        <div class="flow-detail-page" id="flow-detail-page" style="display: none;">
            <div class="flow-detail-header">
                <button class="back-btn" onclick="backToMain()">
                    <span>🔙</span> 返回主頁面
                </button>
                <div class="flow-detail-title">
                    <h1 id="detail-title"></h1>
                    <p id="detail-subtitle"></p>
                </div>
            </div>
            
            <div class="flow-detail-content">
                <div class="flow-detail-main">
                    <div class="detail-section">
                        <h2>📋 流程概述</h2>
                        <div class="detail-card">
                            <p id="detail-description"></p>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h2>🔄 實施步驟</h2>
                        <div class="detail-card">
                            <div id="detail-steps"></div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h2>✨ 核心效益</h2>
                        <div class="detail-card">
                            <div id="detail-benefits"></div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h2>📊 關鍵績效指標</h2>
                        <div class="detail-card">
                            <div id="detail-kpi" class="kpi-grid"></div>
                        </div>
                    </div>
                </div>
                
                <div class="flow-detail-sidebar">
                    <div class="detail-section">
                        <h2>🎯 流程路徑</h2>
                        <div class="detail-card">
                            <div id="detail-path"></div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h2>🔗 相關節點</h2>
                        <div class="detail-card">
                            <div id="detail-nodes" class="related-nodes"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flow-detail-ecosystem">
                <h2>🌐 相關生態節點</h2>
                <div class="mini-ecosystem" id="mini-ecosystem">
                    <svg id="mini-ecosystem-svg" width="100%" height="700"></svg>
                </div>
            </div>
        </div>
        
        <div id="info-panel" class="info-panel">
            <div style="position: absolute; top: 15px; right: 20px; cursor: pointer; font-size: 24px; color: #999;" onclick="hideInfoPanel()">&times;</div>
            <h3>
                <div class="icon" id="info-icon"></div>
                <span id="info-title"></span>
            </h3>
            <div class="info-content">
                <div class="info-section">
                    <h4>📋 詳細說明</h4>
                    <p id="info-description"></p>
                </div>
                <div class="info-section">
                    <div id="info-connections"></div>
                </div>
                <div class="info-section">
                    <div id="info-applications"></div>
                </div>
                <div class="info-section">
                    <div id="info-metrics"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    <div class="flow-indicator" id="flow-indicator"></div>
    <div class="info-panel-overlay" id="info-panel-overlay" onclick="hideInfoPanel()"></div>
    
    <script>
        // 擴展的節點數據 - 根據架構圖調整
        const nodes = [
            // 核心層 - 穩定幣和區塊鏈（中心位置）
            { 
                id: 'stablecoin', 
                name: '穩定幣', 
                type: 'core', 
                x: 450, 
                y: 350,
                info: '【提案概念】統一集團穩定幣，錨定新台幣，作為整個生態系統的價值交換媒介，儲備證明透明化',
                connections: ['blockchain', 'retail', 'food', 'partner', 'exchange', 'leisure', 'crossborder', 'construction', 'integration', 'other_business'],
                applications: ['跨境支付', '供應鏈融資', '忠誠度獎勵', 'B2B結算', '儲備審計開放第三方即時驗證'],
                metrics: { '儲備比例': '110%(推估)', '日交易量': '1,000萬筆(推估)', '節省成本': '1.5-3%' },
                annualVolume: '2,500億',
                settlementRate: 'high'
            },
            { 
                id: 'blockchain', 
                name: '區塊鏈', 
                type: 'core', 
                x: 600, 
                y: 350,
                info: '【提案概念】採用聯盟鏈架構，確保交易速度與安全性的平衡',
                connections: ['stablecoin', 'food', 'construction', 'other_business'],
                applications: ['智能合約執行', '交易記錄', '身份驗證', '資產追蹤'],
                metrics: { 'TPS': '10,000+', '節點數': '20+', '可用性': '99.99%' }
            },
            
            // 左上業務單位 - 休閒娛樂
            { 
                id: 'leisure', 
                name: '休閒\n娛樂', 
                type: 'business', 
                x: 250, 
                y: 200,
                info: '統一夢時代、7-ELEVEN聯名娛樂場館、KTV、電影票務、W Hotel等度假娛樂場景',
                connections: ['stablecoin'],
                applications: ['統一夢時代商場整合支付', '電影票務數位化', 'KTV會員積分系統', 'W Hotel度假整合服務'],
                metrics: { '娛樂場館': '50+(推估)', '年服務人次': '500萬+(推估)', '數位化票務': '100萬筆/月' }
            },
            // 右上業務單位 - 零售通路  
            { 
                id: 'retail', 
                name: '零售\n通路', 
                type: 'business', 
                x: 650, 
                y: 200,
                info: '7-ELEVEN、康是美、聖娜多堡、星巴克(聯名合作)、PChome(統一持股)',
                connections: ['stablecoin'],
                applications: ['零售連鎖統一支付(現有)', '線上線下整合會員系統(現有)', '跨店積分整合(現有)', '【提案】穩定幣B2B結算'],
                metrics: { '門市數': '7,110', '2024營收': '3,379億', '市佔率': '51.8%', '會員數': '1,800萬+' },
                annualVolume: '1,500億',
                settlementRate: 'high',
                profitability: {
                    costSaving: '22.5-45億', // 1,500億 × 1.5-3% 手續費節省
                    newRevenue: '低', 
                    totalBenefit: '22.5-45億/年',
                    roi: '高',
                    priority: 'high',
                    strategy: '優先全面推進'
                },
                techRequirements: {
                    chainType: '聯盟鏈',
                    tps: '1,500-2,000',
                    sla: '99.9%',
                    latency: '<1秒',
                    specialNeeds: ['高頻交易', '即時結算', '低延遲'],
                    priority: '高技術要求',
                    infrastructure: '需優先建設'
                }
            },
            // 左中業務單位 - 跨國貿易
            { 
                id: 'crossborder', 
                name: '跨國\n貿易', 
                type: 'business', 
                x: 200, 
                y: 350,
                info: '日本、泰國、菲律賓、中國大陸的原料、食品、零售供應鏈採購與B2B流通',
                connections: ['stablecoin'],
                applications: ['亞太區原料採購', '食品供應鏈流通', 'B2B跨境結算', 'DID/Travel Rule合規'],
                metrics: { '交易國家': '4+', '節省匯兌成本': '2-5%', '結算時間': '即時' },
                profitability: {
                    costSaving: '匯兌成本節省 1-3億', 
                    newRevenue: '利差收益低', 
                    totalBenefit: '1-3億/年',
                    roi: '中',
                    priority: 'medium',
                    strategy: '輔助推進'
                },
                techRequirements: {
                    chainType: '公有鏈+跨鏈橋',
                    tps: '500-1,000',
                    sla: '99.9%',
                    latency: '<5秒',
                    specialNeeds: ['匯率風控', '合規數據留存', '跨境同步'],
                    priority: '監管優先關注',
                    infrastructure: '可延後優化'
                }
            },
            
            // 右中業務單位 - 食品供應鏈
            { 
                id: 'food', 
                name: '食品\n供應鏈', 
                type: 'business', 
                x: 750, 
                y: 350,
                info: '冷鏈農產 → 加工 → 倉儲 → 配送中心 → 門市（與現有冷鏈管理整合）',
                connections: ['blockchain'],
                applications: ['冷鏈物流追蹤', '溫度監控上鏈', '食安即時驗證', '供應商結算自動化'],
                metrics: { '冷鏈節點': '1000+', '供應商': '500+', '食安追溯': '100%' },
                profitability: {
                    costSaving: '8-24億', // 800億 × 1-3% 手續費節省
                    newRevenue: '供應鏈融資收益', 
                    totalBenefit: '10-30億/年',
                    roi: '高',
                    priority: 'high',
                    strategy: '優先全面推進'
                },
                techRequirements: {
                    chainType: '聯盟鏈',
                    tps: '500-1,000',
                    sla: '99.9%',
                    latency: '<3秒',
                    specialNeeds: ['批次結算', '冷鏈系統對接', 'IoT整合'],
                    priority: '高技術要求',
                    infrastructure: '需優先建設'
                }
            },
            
            // 左下業務單位 - 建設
            { 
                id: 'construction', 
                name: '建設', 
                type: 'business', 
                x: 300, 
                y: 500,
                info: '【現有+提案】統一集團建設業務，包含商場、倉儲、物流園區、物業等資產開發，與多個應用場景連結',
                connections: ['stablecoin', 'rwa', 'blockchain'],
                applications: ['【提案】穩定幣工程款支付', '【提案】建設資產上鏈追溯', '【提案】建設資產RWA化', '【現有】BOT開發案', '【現有】物流園區建設', '【現有】商場開發'],
                metrics: { '建設投資': '300億+(台中)', 'BOT案': '5.62億(大里)', '物流園區': '235億(桃園)' },
                annualVolume: '120億',
                settlementRate: 'low',
                profitability: {
                    costSaving: '無直接成本效益', 
                    newRevenue: 'RWA資產代幣化收益', 
                    totalBenefit: '長期收益高',
                    roi: '高',
                    priority: 'medium-high',
                    strategy: '謹慎擴展、先試點'
                },
                techRequirements: {
                    chainType: '聯盟鏈+公有鏈',
                    tps: '100-500',
                    sla: '99.95%',
                    latency: '<5秒',
                    specialNeeds: ['大額結算', 'RWA發行', '跨鏈同步'],
                    priority: '高技術要求',
                    infrastructure: '需優先建設'
                }
            },
            // 中下業務單位 - 統一證  
            { 
                id: 'integration', 
                name: '統一證', 
                type: 'business', 
                x: 525, 
                y: 450,
                info: '【結合提案】數位身份與權益整合平台，未來可整合穩定幣應用',
                connections: ['construction', 'partner'],
                applications: ['建設', '統一'], 
                metrics: { '註冊用戶': '500萬+(推估)', '整合服務': '30+', '認證時間': '秒級' }
            },
            
            // 下方金融服務 - RWA
            { 
                id: 'rwa', 
                name: 'RWA', 
                type: 'finance', 
                x: 400, 
                y: 550,
                info: '【提案概念】實物資產數位化，提高資產流動性',
                connections: ['integration', 'exchange'],
                applications: ['不動產代幣', '設備租賃', '應收帳款', '碳權交易'],
                metrics: { '代幣化資產': '100億+(推估)', '投資者': '10萬+(推估)', '流動性提升': '300%(推估)' },
                annualVolume: '100億',
                settlementRate: 'low',
                profitability: {
                    costSaving: '無直接成本效益', 
                    newRevenue: '代幣化手續費與管理費', 
                    totalBenefit: '長期收益高',
                    roi: '高',
                    priority: 'medium-high',
                    strategy: '謹慎擴展、先試點'
                },
                techRequirements: {
                    chainType: '公有鏈',
                    tps: '200-1,000',
                    sla: '99.99%',
                    latency: '<10秒',
                    specialNeeds: ['透明度驗證', 'Merkle Proof', '跨鏈兼容'],
                    priority: '高技術要求',
                    infrastructure: '需優先建設'
                }
            },
            // 下方金融服務 - 交易所
            { 
                id: 'exchange', 
                name: '交易所', 
                type: 'finance', 
                x: 550, 
                y: 550,
                info: '【提案概念】提供穩定幣與其他資產的交易服務',
                connections: ['rwa', 'partner'],
                applications: ['法定幣入金管道', '虛擬資產交易', '衍生性商品交易'],
                metrics: { '24h交易量': '10-100億(推估)', '交易對': '100-2000(推估)', '用戶數': '100萬+(推估)' },
                profitability: {
                    costSaving: '無直接成本效益', 
                    newRevenue: '手續費與利差收益中等', 
                    totalBenefit: '中等收益',
                    roi: '中',
                    priority: 'medium',
                    strategy: '輔助推進'
                },
                techRequirements: {
                    chainType: '公有鏈+跨鏈橋',
                    tps: '1,000-5,000',
                    sla: '99.99%',
                    latency: '<2秒',
                    specialNeeds: ['高安全性', '即時儲備驗證', '多鏈支持'],
                    priority: '高技術要求',
                    infrastructure: '需優先建設'
                }
            },
            
            // 左邊業務單位 - 統一其他業務
            { 
                id: 'other_business', 
                name: '統一其他\n業務', 
                type: 'business', 
                x: 150, 
                y: 450,
                info: '【現有業務】旅行社、能源、其他服務業務，涵蓋支付、追溯、紀錄等金錢相關應用',
                connections: ['stablecoin', 'blockchain'],
                applications: ['【提案】穩定幣小額支付', '【提案】交易紀錄上鏈', '【提案】供應鏈追溯', '【現有】旅行社團費代收', '【現有】能源採購'],
                metrics: { '業務類型': '多元化', '交易規模': '小額', '優先級': '低' },
                profitability: {
                    costSaving: '人力成本與流程成本略微下降', 
                    newRevenue: '無', 
                    totalBenefit: '微小效益',
                    roi: '低',
                    priority: 'low',
                    strategy: '輔助推進'
                },
                techRequirements: {
                    chainType: '聯盟鏈',
                    tps: '100-300',
                    sla: '99.5%',
                    latency: '<10秒',
                    specialNeeds: ['基礎內部結算', '簡化流程'],
                    priority: '可延後優化',
                    infrastructure: '無高強度需求'
                }
            },
            
            // 右下合作夥伴 - 合作發行商
            { 
                id: 'partner', 
                name: '合作\n發行商', 
                type: 'partner', 
                x: 700, 
                y: 450,
                info: '與銀行、金融機構合作確保穩定幣的信任與流動性',
                connections: ['stablecoin', 'exchange', 'integration'],
                applications: ['合作發行', '合作設立'],
                metrics: { '合作銀行': '7家主要行庫', '儲備資產': '110%', '審計頻率': '每季' }
            },
        ];
        
        // 連接線數據 - 根據架構圖調整
        const links = [
            // 核心技術連接
            { source: 'blockchain', target: 'stablecoin', type: 'core', strength: 3 },
            
            // 穩定幣到各業務單位的支付連接 - 按資金流量分級
            { source: 'leisure', target: 'stablecoin', type: 'business', strength: 2, flowType: 'medium', style: 'solid', volume: '300億', frequency: 'medium' },
            { source: 'retail', target: 'stablecoin', type: 'business', strength: 5, flowType: 'high', style: 'solid', volume: '1,500億', frequency: 'high' }, // 最大資金流
            { source: 'crossborder', target: 'stablecoin', type: 'business', strength: 3, flowType: 'medium', style: 'solid', volume: '800億', frequency: 'medium' },
            { source: 'construction', target: 'stablecoin', type: 'business', strength: 4, flowType: 'high', style: 'dashed', volume: '120億', frequency: 'low' }, // 大額但低頻
            { source: 'other_business', target: 'stablecoin', type: 'business', strength: 1, flowType: 'low', style: 'solid', volume: '50億', frequency: 'low' }, // 小額支付場景
            
            // 區塊鏈技術支援 - 追溯、紀錄、驗證
            { source: 'blockchain', target: 'food', type: 'tech', strength: 2 },
            { source: 'blockchain', target: 'construction', type: 'tech', strength: 2 }, // 建設資產上鏈追溯
            { source: 'blockchain', target: 'other_business', type: 'tech', strength: 1 }, // 交易紀錄與追溯
            
            // 建設業務連接 - 資產代幣化
            { source: 'construction', target: 'rwa', type: 'finance', strength: 4, flowType: 'high', style: 'dashed', volume: '100億', frequency: 'low' }, // 資產代幣化，長期鎖倉
            
            // 統一證與合作發行商
            { source: 'integration', target: 'partner', type: 'partner', strength: 2 },
            
            // 金融服務連接
            { source: 'integration', target: 'rwa', type: 'finance', strength: 2 },
            { source: 'integration', target: 'exchange', type: 'finance', strength: 2 },
            { source: 'rwa', target: 'exchange', type: 'finance', strength: 3 },
            { source: 'partner', target: 'exchange', type: 'partner', strength: 2 },
            
            // 長年合作關係
            { source: 'partner', target: 'stablecoin', type: 'partner', strength: 3 }
        ];
        
        // 全局變量
        let svg, tooltip, container;
        let animationEnabled = true;
        let currentZoom = 1;
        let isDragging = false;
        let startX, startY;
        let translateX = 0, translateY = 0;
        
        // 初始化SVG
        function initSVG() {
            // 獲取DOM元素
            svg = document.getElementById('ecosystem-svg');
            tooltip = document.getElementById('tooltip');
            container = document.getElementById('ecosystem-container');
            
            
            if (!svg) {
                console.error('SVG element not found');
                return;
            }
            
            svg.innerHTML = '';
            
            // 設置viewBox - 調整為更緊湊的視圖
            svg.setAttribute('viewBox', '100 50 800 700');
            svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
            
            // 創建主要組
            const mainGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            mainGroup.setAttribute('id', 'main-group');
            mainGroup.setAttribute('transform', `scale(${currentZoom})`);
            
            // 添加定義
            const defs = createDefs();
            svg.appendChild(defs);
            
            // 添加背景網格
            const grid = createGrid();
            mainGroup.appendChild(grid);
            
            // 繪製連接線
            const linksGroup = createLinks();
            mainGroup.appendChild(linksGroup);
            
            // 繪製節點
            const nodesGroup = createNodes();
            mainGroup.appendChild(nodesGroup);
            
            svg.appendChild(mainGroup);
            
            // 添加拖動功能
            setupDragAndZoom();
        }
        
        // 創建定義元素
        function createDefs() {
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            
            // 節點漸變
            const gradients = [
                { id: 'coreGradient', colors: ['#FF6B6B', '#FF5252'] },
                { id: 'businessGradient', colors: ['#FF9F40', '#FF8A00'] },
                { id: 'financeGradient', colors: ['#4ECDC4', '#00BFA5'] },
                { id: 'partnerGradient', colors: ['#6C5CE7', '#5F3DC4'] }
            ];
            
            gradients.forEach(g => {
                const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'radialGradient');
                gradient.setAttribute('id', g.id);
                gradient.innerHTML = `
                    <stop offset="0%" style="stop-color:${g.colors[0]};stop-opacity:1" />
                    <stop offset="100%" style="stop-color:${g.colors[1]};stop-opacity:1" />
                `;
                defs.appendChild(gradient);
            });
            
            // 陰影濾鏡
            const filter = document.createElementNS('http://www.w3.org/2000/svg', 'filter');
            filter.setAttribute('id', 'shadow');
            filter.setAttribute('x', '-50%');
            filter.setAttribute('y', '-50%');
            filter.setAttribute('width', '200%');
            filter.setAttribute('height', '200%');
            filter.innerHTML = `
                <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                <feOffset dx="0" dy="2" result="offsetblur"/>
                <feComponentTransfer>
                    <feFuncA type="linear" slope="0.3"/>
                </feComponentTransfer>
                <feMerge>
                    <feMergeNode/>
                    <feMergeNode in="SourceGraphic"/>
                </feMerge>
            `;
            defs.appendChild(filter);
            
            // 箭頭標記
            const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            arrow.setAttribute('id', 'arrowhead');
            arrow.setAttribute('markerWidth', '10');
            arrow.setAttribute('markerHeight', '7');
            arrow.setAttribute('refX', '9');
            arrow.setAttribute('refY', '3.5');
            arrow.setAttribute('orient', 'auto');
            arrow.innerHTML = '<polygon points="0 0, 10 3.5, 0 7" fill="#999" />';
            defs.appendChild(arrow);
            
            return defs;
        }
        
        // 創建背景網格
        function createGrid() {
            const grid = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            grid.setAttribute('id', 'grid');
            grid.setAttribute('opacity', '0.1');
            
            // 垂直線
            for (let x = 100; x <= 900; x += 50) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('y1', 50);
                line.setAttribute('x2', x);
                line.setAttribute('y2', 650);
                line.setAttribute('stroke', '#999');
                line.setAttribute('stroke-width', x % 100 === 0 ? '1' : '0.5');
                grid.appendChild(line);
            }
            
            // 水平線
            for (let y = 50; y <= 650; y += 50) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', 100);
                line.setAttribute('y1', y);
                line.setAttribute('x2', 900);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#999');
                line.setAttribute('stroke-width', y % 100 === 0 ? '1' : '0.5');
                grid.appendChild(line);
            }
            
            return grid;
        }
        
        // 創建連接線
        function createLinks() {
            const linksGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            linksGroup.setAttribute('id', 'links');
            
            links.forEach((link, index) => {
                const sourceNode = nodes.find(n => n.id === link.source);
                const targetNode = nodes.find(n => n.id === link.target);
                
                if (!sourceNode || !targetNode) return;
                
                // 計算曲線路徑
                const dx = targetNode.x - sourceNode.x;
                const dy = targetNode.y - sourceNode.y;
                const dr = Math.sqrt(dx * dx + dy * dy);
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const d = `M ${sourceNode.x},${sourceNode.y} Q ${(sourceNode.x + targetNode.x) / 2},${(sourceNode.y + targetNode.y) / 2 - dr / 4} ${targetNode.x},${targetNode.y}`;
                
                path.setAttribute('d', d);
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', getLineColor(link.type));
                
                // 根據資金流量設定線條粗細
                const strokeWidth = link.strength ? link.strength * 1.5 : 2;
                path.setAttribute('stroke-width', strokeWidth);
                
                // 根據流動類型設定線條樣式
                if (link.style === 'dashed') {
                    path.setAttribute('stroke-dasharray', '8,4'); // 長期沉澱/鎖倉
                } else {
                    path.setAttribute('stroke-dasharray', '0'); // 實線：高頻支付
                }
                
                path.setAttribute('opacity', '0.7');
                path.setAttribute('class', `link link-${link.type} flow-${link.flowType || 'normal'}`);
                path.setAttribute('data-source', link.source);
                path.setAttribute('data-target', link.target);
                path.setAttribute('data-volume', link.volume || '');
                path.setAttribute('data-frequency', link.frequency || '');
                
                // 雙向箭頭標記
                if (link.type === 'business' || link.type === 'finance') {
                    path.setAttribute('marker-end', 'url(#arrowhead)');
                }
                
                // 添加動畫
                if (animationEnabled && link.type === 'flow') {
                    const animate = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
                    animate.setAttribute('attributeName', 'stroke-dashoffset');
                    animate.setAttribute('from', '0');
                    animate.setAttribute('to', '10');
                    animate.setAttribute('dur', '2s');
                    animate.setAttribute('repeatCount', 'indefinite');
                    path.appendChild(animate);
                }
                
                // 添加懸停效果
                path.addEventListener('mouseenter', () => {
                    path.setAttribute('stroke-width', (link.strength || 2) + 2);
                    path.setAttribute('opacity', '1');
                });
                
                path.addEventListener('mouseleave', () => {
                    path.setAttribute('stroke-width', link.strength || 2);
                    path.setAttribute('opacity', '0.6');
                });
                
                linksGroup.appendChild(path);
            });
            
            return linksGroup;
        }
        
        // 創建節點
        function createNodes() {
            const nodesGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            nodesGroup.setAttribute('id', 'nodes');
            
            nodes.forEach((node, index) => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('class', `node node-${node.type}`);
                g.setAttribute('transform', `translate(${node.x}, ${node.y})`);
                g.setAttribute('data-id', node.id);
                g.style.cursor = 'pointer';
                
                // 外圈光暈
                if (node.type === 'core') {
                    const halo = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    halo.setAttribute('r', '70');
                    halo.setAttribute('fill', 'none');
                    halo.setAttribute('stroke', getNodeColor(node.type));
                    halo.setAttribute('stroke-width', '2');
                    halo.setAttribute('opacity', '0.3');
                    
                    if (animationEnabled) {
                        const animateRadius = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
                        animateRadius.setAttribute('attributeName', 'r');
                        animateRadius.setAttribute('values', '70;80;70');
                        animateRadius.setAttribute('dur', '3s');
                        animateRadius.setAttribute('repeatCount', 'indefinite');
                        halo.appendChild(animateRadius);
                        
                        const animateOpacity = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
                        animateOpacity.setAttribute('attributeName', 'opacity');
                        animateOpacity.setAttribute('values', '0.3;0.1;0.3');
                        animateOpacity.setAttribute('dur', '3s');
                        animateOpacity.setAttribute('repeatCount', 'indefinite');
                        halo.appendChild(animateOpacity);
                    }
                    
                    g.appendChild(halo);
                }
                
                // 節點圓圈
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                const radius = node.type === 'core' ? 55 : 45;
                circle.setAttribute('r', radius);
                circle.setAttribute('fill', `url(#${node.type}Gradient)`);
                circle.setAttribute('filter', 'url(#shadow)');
                circle.setAttribute('stroke', '#fff');
                circle.setAttribute('stroke-width', '3');
                
                // 節點圖標背景
                const iconBg = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                iconBg.setAttribute('r', radius - 15);
                iconBg.setAttribute('fill', 'rgba(255,255,255,0.2)');
                
                // 節點文字
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dy', '5');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-size', node.type === 'core' ? '16' : '14');
                text.setAttribute('font-weight', 'bold');
                text.style.pointerEvents = 'none';
                
                // 處理較長的文字
                if (node.name.length > 5) {
                    const words = node.name.split(/(?=[A-Z])|(?=[\u4e00-\u9fa5]{3})/);
                    text.innerHTML = '';
                    words.forEach((word, i) => {
                        const tspan = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                        tspan.textContent = word;
                        tspan.setAttribute('x', '0');
                        tspan.setAttribute('dy', i === 0 ? '-5' : '18');
                        text.appendChild(tspan);
                    });
                } else {
                    text.textContent = node.name;
                }
                
                // 添加交互效果
                g.addEventListener('mouseenter', (e) => {
                    circle.setAttribute('filter', 'url(#glow)');
                    circle.setAttribute('r', radius + 5);
                    showTooltip(e, node);
                });
                
                g.addEventListener('mouseleave', () => {
                    circle.setAttribute('filter', 'url(#shadow)');
                    circle.setAttribute('r', radius);
                    hideTooltip();
                });
                
                g.addEventListener('click', () => {
                    showDetailedInfo(node);
                    highlightConnections(node.id);
                });
                
                // 添加年度交易額標註（右下角）
                if (node.annualVolume) {
                    const volumeTag = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    volumeTag.setAttribute('transform', `translate(${radius - 10}, ${radius - 10})`);
                    
                    const tagBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    tagBg.setAttribute('x', '-20');
                    tagBg.setAttribute('y', '-8');
                    tagBg.setAttribute('width', '40');
                    tagBg.setAttribute('height', '16');
                    tagBg.setAttribute('rx', '8');
                    tagBg.setAttribute('fill', '#2c3e50');
                    tagBg.setAttribute('opacity', '0.8');
                    
                    const tagText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    tagText.setAttribute('text-anchor', 'middle');
                    tagText.setAttribute('dy', '3');
                    tagText.setAttribute('fill', 'white');
                    tagText.setAttribute('font-size', '10');
                    tagText.textContent = node.annualVolume;
                    
                    volumeTag.appendChild(tagBg);
                    volumeTag.appendChild(tagText);
                    g.appendChild(volumeTag);
                }
                
                // 添加沉澱率色塊標示（左上角）
                if (node.settlementRate) {
                    const rateIndicator = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    rateIndicator.setAttribute('cx', -radius + 15);
                    rateIndicator.setAttribute('cy', -radius + 15);
                    rateIndicator.setAttribute('r', '8');
                    
                    // 根據周轉率設定顏色
                    const rateColor = node.settlementRate === 'high' ? '#2ECC71' : 
                                     node.settlementRate === 'medium' ? '#F39C12' : '#E74C3C';
                    rateIndicator.setAttribute('fill', rateColor);
                    rateIndicator.setAttribute('stroke', 'white');
                    rateIndicator.setAttribute('stroke-width', '2');
                    
                    g.appendChild(rateIndicator);
                }
                
                g.appendChild(circle);
                g.appendChild(iconBg);
                g.appendChild(text);
                nodesGroup.appendChild(g);
            });
            
            return nodesGroup;
        }
        
        // 獲取節點顏色
        function getNodeColor(type) {
            const colors = {
                'core': '#FF6B6B',
                'business': '#FF9F40',
                'finance': '#4ECDC4',
                'partner': '#6C5CE7'
            };
            return colors[type] || '#95A5A6';
        }
        
        // 獲取金融服務流程節點顏色
        function getFinanceServiceNodeColor(type) {
            const colors = {
                'settlement': '#FF9F40',    // 橘色 - 基礎支付層
                'core': '#FF6B6B',          // 紅色 - 穩定幣核心
                'finance': '#4ECDC4',       // 藍色 - 金融增值層
                'assets': '#4ECDC4',        // 藍色 - 金融增值層
                'crossborder': '#4ECDC4',   // 藍色 - 金融增值層
                'exchange': '#6C5CE7',      // 紫色 - 合作銀行與交易層
                'banking': '#6C5CE7',       // 紫色 - 合作銀行與交易層
                'compliance': '#9B59B6'     // 紫色 - 監管合規層
            };
            return colors[type] || '#95A5A6';
        }
        
        // 獲取連線顏色
        function getLineColor(type) {
            const colors = {
                'core': '#E74C3C',
                'business': '#F39C12',
                'flow': '#95A5A6',
                'finance': '#3498DB',
                'partner': '#9B59B6',
                'tech': '#2ECC71'
            };
            return colors[type] || '#BDC3C7';
        }
        
        // 顯示提示框
        function showTooltip(e, node) {
            tooltip.innerHTML = `
                <strong>${node.name}</strong><br>
                ${node.info}
            `;
            tooltip.style.opacity = '1';
            updateTooltipPosition(e);
        }
        
        // 隱藏提示框
        function hideTooltip() {
            tooltip.style.opacity = '0';
        }
        
        // 更新提示框位置
        function updateTooltipPosition(e) {
            const rect = container.getBoundingClientRect();
            const x = e.clientX - rect.left + 10;
            const y = e.clientY - rect.top - 40;
            tooltip.style.left = x + 'px';
            tooltip.style.top = y + 'px';
        }
        
        // 顯示詳細信息
        function showDetailedInfo(node) {
            const panel = document.getElementById('info-panel');
            const overlay = document.getElementById('info-panel-overlay');
            const icon = document.getElementById('info-icon');
            const title = document.getElementById('info-title');
            const description = document.getElementById('info-description');
            const connections = document.getElementById('info-connections');
            const applications = document.getElementById('info-applications');
            const metrics = document.getElementById('info-metrics');
            
            // 設置圖標顏色
            icon.style.background = getNodeColor(node.type);
            icon.innerHTML = getNodeIcon(node.type);
            
            // 設置基本信息
            title.textContent = node.name;
            description.textContent = node.info;
            
            // 設置連接關係
            connections.innerHTML = '<h4>🔗 連接關係</h4><ul>' + 
                node.connections.map(conn => {
                    const connNode = nodes.find(n => n.id === conn);
                    return `<li>${connNode ? connNode.name : conn}</li>`;
                }).join('') + 
                '</ul>';
            
            // 設置應用場景
            applications.innerHTML = '<h4>💡 應用場景</h4><ul>' + 
                node.applications.map(app => `<li>${app}</li>`).join('') + 
                '</ul>';
            
            // 設置關鍵指標
            metrics.innerHTML = '<h4>📊 關鍵指標</h4>' + Object.entries(node.metrics)
                .map(([key, value]) => `<p><strong>${key}:</strong> ${value}</p>`)
                .join('');
            
            overlay.style.display = 'block';
            panel.style.display = 'block';
        }
        
        // 隱藏資訊面板
        function hideInfoPanel() {
            const panel = document.getElementById('info-panel');
            const overlay = document.getElementById('info-panel-overlay');
            panel.style.display = 'none';
            overlay.style.display = 'none';
        }
        
        // 顯示流程說明
        function showFlowDescription(flow, flowType) {
            const controls = document.querySelector('.controls');
            const legend = document.querySelector('.legend');
            const flowDesc = document.getElementById('flow-description');
            const flowTitle = document.getElementById('flow-title');
            const flowDescText = document.getElementById('flow-desc');
            const flowSteps = document.getElementById('flow-steps');
            const flowBenefits = document.getElementById('flow-benefits');
            const flowNodes = document.getElementById('flow-nodes');
            const flowMetrics = document.getElementById('flow-metrics');
            
            // 隱藏控制項和圖例，顯示流程說明
            controls.style.display = 'none';
            legend.style.display = 'none';
            flowDesc.style.display = 'block';
            flowDesc.style.borderLeftColor = flow.color;
            
            // 設置標題和描述
            flowTitle.textContent = flow.title;
            flowTitle.style.color = flow.color;
            flowDescText.textContent = flow.description;
            
            // 設置流程步驟
            flowSteps.innerHTML = '<h4>🔄 流程步驟</h4><ul>' + 
                flow.steps.map(step => `<li>${step}</li>`).join('') + 
                '</ul>';
            
            // 設置主要效益
            flowBenefits.innerHTML = '<h4>✨ 主要效益</h4><ul>' + 
                flow.benefits.map(benefit => `<li>${benefit}</li>`).join('') + 
                '</ul>';
            
            // 設置相關節點路徑
            flowNodes.innerHTML = '<h4>🎯 流程路徑</h4><div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 2px dashed ' + flow.color + ';">' + 
                flow.nodes.map((nodeId, index) => {
                    const node = nodes.find(n => n.id === nodeId);
                    const isLast = index === flow.nodes.length - 1;
                    return `<span style="background: ${flow.color}; color: white; padding: 8px 12px; border-radius: 20px; font-weight: bold; margin: 5px;">${node ? node.name : nodeId}</span>${isLast ? '' : ' <span style="color: ' + flow.color + '; font-size: 1.2em;">→</span> '}`;
                }).join('') + 
                '</div>';
                
            // 添加關鍵數據指標
            const keyMetrics = getFlowMetrics(flowType);
            if (keyMetrics.length > 0) {
                flowMetrics.innerHTML = '<h4>📊 關鍵指標</h4>' + 
                    keyMetrics.map(metric => `<div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid ${flow.color};"><strong style="color: ${flow.color};">${metric.label}:</strong> <span style="font-size: 1.1em; font-weight: bold;">${metric.value}</span></div>`).join('');
            }
        }
        
        // 獲取流程關鍵指標
        function getFlowMetrics(flowType) {
            const metrics = {
                'retail': [
                    { label: '成本節省', value: '1.5-3%手續費' },
                    { label: '交易速度', value: '3秒結帳' },
                    { label: '覆蓋門市', value: '7,110' },
                    { label: '日交易量', value: '1,000萬筆(推估)' }
                ],
                'supply': [
                    { label: '供應商數量', value: '200+家' },
                    { label: '年交易額', value: '600億' },
                    { label: '冷鏈節點', value: '1000+個' },
                    { label: '追溯覆蓋率', value: '100%' },
                    { label: '結算效率提升', value: '即時' },
                    { label: '年成本節省', value: '10-30億' }
                ],
                'finance': [
                    { label: '業務板塊', value: '8+' },
                    { label: '年資金流', value: '1000億+' },
                    { label: '資產代幣化', value: 'RWA平台' },
                    { label: '支付效率提升', value: '50%' }
                ],
                'cross': [
                    { label: '交易國家', value: '4+國' },
                    { label: '年貿易額', value: '800億(推估)' },
                    { label: '匯兌成本節省', value: '2-5%' },
                    { label: '結算速度', value: '即時' },
                    { label: '合規框架', value: 'DID/Travel Rule' },
                    { label: '風險控制', value: '多層級' }
                ]
            };
            
            return metrics[flowType] || [];
        }
        
        // 顯示流程詳情頁面
        function showFlowDetailPage(flow, flowType) {
            // 隱藏主頁面，顯示詳情頁面
            document.getElementById('main-dashboard').style.display = 'none';
            document.getElementById('flow-detail-page').style.display = 'block';
            
            // 設置標題和描述
            document.getElementById('detail-title').textContent = flow.title;
            document.getElementById('detail-subtitle').textContent = flow.description;
            document.getElementById('detail-description').textContent = flow.description;
            
            // 設置詳情頁面的主題色
            const detailPage = document.getElementById('flow-detail-page');
            const detailCards = detailPage.querySelectorAll('.detail-card');
            detailCards.forEach(card => {
                card.style.borderLeftColor = flow.color;
            });
            
            // 設置流程步驟
            const stepsHtml = flow.steps.map((step, index) => 
                `<div style="display: flex; align-items: flex-start; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid ${flow.color};">
                    <div style="background: ${flow.color}; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; flex-shrink: 0;">${index + 1}</div>
                    <div style="flex: 1; font-size: 1.05em; line-height: 1.6;">${step}</div>
                </div>`
            ).join('');
            document.getElementById('detail-steps').innerHTML = stepsHtml;
            
            // 設置核心效益
            const benefitsHtml = `<ul style="list-style: none; padding: 0;">` +
                flow.benefits.map(benefit => 
                    `<li style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid ${flow.color}; position: relative;">
                        <span style="color: ${flow.color}; font-size: 1.2em; margin-right: 10px;">✨</span>${benefit}
                    </li>`
                ).join('') + `</ul>`;
            document.getElementById('detail-benefits').innerHTML = benefitsHtml;
            
            // 設置KPI指標
            let keyMetrics = getFlowMetrics(flowType);
            // 如果有keyMetrics屬性，使用flow中的數據
            if (flow.keyMetrics) {
                keyMetrics = flow.keyMetrics.map(metric => ({
                    label: metric.label,
                    value: `${metric.value}${metric.unit}`
                }));
            }
            
            const kpiHtml = keyMetrics.map(metric => 
                `<div class="kpi-item" style="border-left-color: ${flow.color};">
                    <div class="kpi-value" style="color: ${flow.color};">${metric.value}</div>
                    <div class="kpi-label">${metric.label}</div>
                </div>`
            ).join('');
            document.getElementById('detail-kpi').innerHTML = kpiHtml;
            
            // 設置流程路徑
            const pathHtml = `<div style="display: flex; flex-direction: column; gap: 15px; align-items: center;">` +
                flow.nodes.map((nodeId, index) => {
                    const node = nodes.find(n => n.id === nodeId);
                    const isLast = index === flow.nodes.length - 1;
                    return `
                        <div style="text-align: center;">
                            <div style="background: ${flow.color}; color: white; padding: 12px 20px; border-radius: 25px; font-weight: bold; margin-bottom: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                ${node ? node.name : nodeId}
                            </div>
                            ${!isLast ? `<div style="color: ${flow.color}; font-size: 1.5em; margin: 10px 0;">↓</div>` : ''}
                        </div>
                    `;
                }).join('') + `</div>`;
            document.getElementById('detail-path').innerHTML = pathHtml;
            
            // 設置相關節點
            let nodesHtml = '';
            if (flow.relatedNodes) {
                nodesHtml = flow.relatedNodes.map(category => `
                    <div class="related-category" style="margin-bottom: 20px;">
                        <h4 style="color: ${flow.color}; font-size: 14px; margin-bottom: 10px; border-bottom: 2px solid ${flow.color}; padding-bottom: 5px;">
                            ${category.category}
                        </h4>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            ${category.nodes.map(node => `
                                <div class="related-node-item" style="border-left: 3px solid ${flow.color}; background: #f8f9fa; padding: 10px; border-radius: 8px;">
                                    <div class="related-node-name" style="color: ${flow.color}; font-weight: bold; margin-bottom: 5px;">
                                        ${node.icon} ${node.name}
                                    </div>
                                    <div class="related-node-desc" style="font-size: 12px; color: #666; line-height: 1.4;">
                                        ${node.role}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            } else {
                // 如果沒有相關節點資訊，則顯示流程節點
                nodesHtml = flow.nodes.map(nodeId => {
                    const node = nodes.find(n => n.id === nodeId);
                    if (!node) return '';
                    return `
                        <div class="related-node-item" style="border-left-color: ${flow.color};">
                            <div class="related-node-name" style="color: ${flow.color};">${node.name}</div>
                            <div class="related-node-desc">${node.info}</div>
                        </div>
                    `;
                }).join('');
            }
            document.getElementById('detail-nodes').innerHTML = nodesHtml;
            
            // 創建迷你生態圖
            createMiniEcosystem(flow);
        }
        
        // 重新分佈節點到4列網格排列
        function repositionMiniEcosystem(nodes) {
            return nodes.map((node, index) => ({
                ...node,
                x: 200 + (index % 4) * 320, 
                y: 150 + Math.floor(index / 4) * 240
            }));
        }

        // 自動計算並設置 mini-ecosystem 的 viewBox
        function setMiniViewBox(miniNodes) {
            const maxX = Math.max(...miniNodes.map(n => n.x));
            const maxY = Math.max(...miniNodes.map(n => n.y));
            const svg = document.getElementById('mini-ecosystem-svg');
            svg.setAttribute('viewBox', `0 0 ${maxX + 400} ${maxY + 300}`);
            svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
        }

        // 創建迷你生態圖
        function createMiniEcosystem(flow) {
            const miniSvg = document.getElementById('mini-ecosystem-svg');
            miniSvg.innerHTML = '';
            
            // 如果有詳細節點結構，重新分佈節點並使用對應的詳細繪製函數
            if (flow.detailedNodes) {
                // 重新分佈詳細節點
                const repositionedDetailedNodes = repositionMiniEcosystem(flow.detailedNodes);
                const modifiedFlow = { ...flow, detailedNodes: repositionedDetailedNodes };
                
                // 自動設置 viewBox
                setMiniViewBox(repositionedDetailedNodes);
                
                if (flow.title.includes('食品供應鏈')) {
                    createDetailedSupplyChainSvg(miniSvg, modifiedFlow);
                } else if (flow.title.includes('零售支付')) {
                    createDetailedRetailPaymentSvg(miniSvg, modifiedFlow);
                } else if (flow.title.includes('跨境交易')) {
                    createDetailedCrossBorderSvg(miniSvg, modifiedFlow);
                } else if (flow.title.includes('金融服務')) {
                    createDetailedFinanceServiceSvg(miniSvg, modifiedFlow);
                } else {
                    createDetailedSupplyChainSvg(miniSvg, modifiedFlow); // 默認使用供應鏈繪製方式
                }
            } else {
                // 使用新的重新分佈節點顯示
                const relatedNodes = nodes.filter(n => flow.nodes.includes(n.id));
                
                // 重新分佈節點座標
                const repositionedNodes = repositionMiniEcosystem(relatedNodes);
                
                // 自動設置 viewBox
                setMiniViewBox(repositionedNodes);
                
                repositionedNodes.forEach((node, index) => {
                    // 創建節點組
                    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    g.setAttribute('transform', `translate(${node.x}, ${node.y})`);
                    
                    // 節點圓圈
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('r', '50');
                    circle.setAttribute('fill', flow.color);
                    circle.setAttribute('stroke', '#fff');
                    circle.setAttribute('stroke-width', '4');
                    circle.setAttribute('filter', 'drop-shadow(2px 2px 4px rgba(0,0,0,0.3))');
                    
                    // 節點文字
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('dy', '6');
                    text.setAttribute('fill', '#fff');
                    text.setAttribute('font-size', '14');
                    text.setAttribute('font-weight', 'bold');
                    text.textContent = node.name;
                    
                    // 節點標籤
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('text-anchor', 'middle');
                    label.setAttribute('dy', '80');
                    label.setAttribute('fill', '#333');
                    label.setAttribute('font-size', '17');
                    label.setAttribute('font-weight', 'bold');
                    label.textContent = node.name;
                    
                    g.appendChild(circle);
                    g.appendChild(text);
                    g.appendChild(label);
                    miniSvg.appendChild(g);
                });
                
                // 先添加連接線到底層，然後重新添加所有節點到上層
                for (let i = 0; i < repositionedNodes.length - 1; i++) {
                    const currentNode = repositionedNodes[i];
                    const nextNode = repositionedNodes[i + 1];
                    
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const { startX, startY, endX, endY } = getEdgePosition(currentNode, nextNode, 55);
                    line.setAttribute('x1', startX);
                    line.setAttribute('y1', startY);
                    line.setAttribute('x2', endX);
                    line.setAttribute('y2', endY);
                    line.setAttribute('stroke', flow.color);
                    line.setAttribute('stroke-width', '3');
                    line.setAttribute('stroke-dasharray', '8,4');
                    line.setAttribute('opacity', '0.7');
                    line.setAttribute('marker-end', 'url(#mini-arrow)');
                    line.setAttribute('filter', 'drop-shadow(1px 1px 2px rgba(0,0,0,0.1))');
                    // 將連接線插入到第一個位置（底層）
                    miniSvg.insertBefore(line, miniSvg.firstChild);
                }
            }
            
            // 添加箭頭標記
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            marker.setAttribute('id', 'mini-arrow');
            marker.setAttribute('markerWidth', '10');
            marker.setAttribute('markerHeight', '7');
            marker.setAttribute('refX', '9');
            marker.setAttribute('refY', '3.5');
            marker.setAttribute('orient', 'auto');
            marker.innerHTML = `<polygon points="0 0, 10 3.5, 0 7" fill="${flow.color}" />`;
            defs.appendChild(marker);
            miniSvg.insertBefore(defs, miniSvg.firstChild);
        }

        // 創建詳細供應鏈SVG圖
        function createDetailedSupplyChainSvg(svg, flow) {
            const mainNodes = flow.detailedNodes.filter(n => ['source', 'process', 'storage', 'logistics', 'retail'].includes(n.type));
            const supportNodes = flow.detailedNodes.filter(n => ['tech', 'finance'].includes(n.type));
            
            // 先繪製所有連接線（放在最底層）
            // 1. 主要供應鏈流程連接線
            for (let i = 0; i < mainNodes.length - 1; i++) {
                const node = mainNodes[i];
                const nextNode = mainNodes[i + 1];
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                const { startX, startY, endX, endY } = getEdgePosition(node, nextNode, 80);
                line.setAttribute('x1', startX);
                line.setAttribute('y1', startY);
                line.setAttribute('x2', endX);
                line.setAttribute('y2', endY);
                line.setAttribute('stroke', '#4ECDC4');
                line.setAttribute('stroke-width', '3');
                line.setAttribute('marker-end', 'url(#mini-arrow)');
                svg.appendChild(line);
            }
            
            // 2. 支撐節點連接線
            supportNodes.forEach(node => {
                mainNodes.forEach(mainNode => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const supportSource = { x: node.x, y: node.type === 'tech' ? node.y + 44 : node.y - 44 };
                    const supportTarget = { x: mainNode.x, y: node.type === 'tech' ? mainNode.y - 80 : mainNode.y + 80 };
                    const { startX: supportStartX, startY: supportStartY, endX: supportEndX, endY: supportEndY } = getEdgePosition(supportSource, supportTarget, node.type === 'tech' ? 90 : 80);
                    line.setAttribute('x1', supportStartX);
                    line.setAttribute('y1', supportStartY);
                    line.setAttribute('x2', supportEndX);
                    line.setAttribute('y2', supportEndY);
                    line.setAttribute('stroke', node.type === 'tech' ? '#3498DB' : '#E67E22');
                    line.setAttribute('stroke-width', '2');
                    line.setAttribute('stroke-dasharray', '6,3');
                    line.setAttribute('opacity', '0.7');
                    svg.appendChild(line);
                });
            });
            
            // 然後繪製主要供應鏈流程節點（放在上層）
            mainNodes.forEach((node, index) => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // 主供應鏈節點（圓形）
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', '80');
                circle.setAttribute('fill', getSupplyChainNodeColor(node.type));
                circle.setAttribute('stroke', '#fff');
                circle.setAttribute('stroke-width', '4');
                circle.setAttribute('filter', 'drop-shadow(3px 3px 8px rgba(0,0,0,0.2))');
                
                // 節點名稱
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + 8);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-size', '22');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.name;
                
                // 數據標籤（上方）
                const dataLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                dataLabel.setAttribute('x', node.x);
                dataLabel.setAttribute('y', node.y - 95);
                dataLabel.setAttribute('text-anchor', 'middle');
                dataLabel.setAttribute('fill', '#333');
                dataLabel.setAttribute('font-size', '16');
                dataLabel.setAttribute('font-weight', 'bold');
                dataLabel.textContent = node.data;
                
                // 資訊流標籤（下方）
                const infoLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                infoLabel.setAttribute('x', node.x);
                infoLabel.setAttribute('y', node.y + 100);
                infoLabel.setAttribute('text-anchor', 'middle');
                infoLabel.setAttribute('fill', '#2E8B57');
                infoLabel.setAttribute('font-size', '15');
                infoLabel.setAttribute('font-weight', 'bold');
                infoLabel.textContent = node.infoFlow;
                
                // 資金流標籤（最下方）
                const cashLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                cashLabel.setAttribute('x', node.x);
                cashLabel.setAttribute('y', node.y + 120);
                cashLabel.setAttribute('text-anchor', 'middle');
                cashLabel.setAttribute('fill', '#E74C3C');
                cashLabel.setAttribute('font-size', '14');
                cashLabel.textContent = node.cashFlow;
                
                g.appendChild(circle);
                g.appendChild(text);
                g.appendChild(dataLabel);
                g.appendChild(infoLabel);
                g.appendChild(cashLabel);
                svg.appendChild(g);
            });
            
            // 繪製支撐基礎設施（上下方向）
            supportNodes.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // 支撐節點（橢圓形）
                const ellipse = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
                ellipse.setAttribute('cx', node.x);
                ellipse.setAttribute('cy', node.y);
                ellipse.setAttribute('rx', '140');
                ellipse.setAttribute('ry', '70');
                ellipse.setAttribute('fill', node.type === 'tech' ? '#3498DB' : '#E67E22');
                ellipse.setAttribute('stroke', '#fff');
                ellipse.setAttribute('stroke-width', '3');
                ellipse.setAttribute('opacity', '0.9');
                ellipse.setAttribute('filter', 'drop-shadow(2px 2px 6px rgba(0,0,0,0.15))');
                
                // 節點名稱
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + 8);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-size', '20');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.name;
                
                // 數據標籤
                const dataLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                dataLabel.setAttribute('x', node.x);
                dataLabel.setAttribute('y', node.y + (node.type === 'tech' ? -85 : 85));
                dataLabel.setAttribute('text-anchor', 'middle');
                dataLabel.setAttribute('fill', '#666');
                dataLabel.setAttribute('font-size', '14');
                dataLabel.textContent = node.data;
                
                // 資訊流標籤
                const infoLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                infoLabel.setAttribute('x', node.x);
                infoLabel.setAttribute('y', node.y + (node.type === 'tech' ? -65 : 105));
                infoLabel.setAttribute('text-anchor', 'middle');
                infoLabel.setAttribute('fill', '#2E8B57');
                infoLabel.setAttribute('font-size', '13');
                infoLabel.textContent = node.infoFlow;
                
                // 資金流標籤
                const cashLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                cashLabel.setAttribute('x', node.x);
                cashLabel.setAttribute('y', node.y + (node.type === 'tech' ? -45 : 125));
                cashLabel.setAttribute('text-anchor', 'middle');
                cashLabel.setAttribute('fill', '#E74C3C');
                cashLabel.setAttribute('font-size', '13');
                cashLabel.textContent = node.cashFlow;
                
                g.appendChild(ellipse);
                g.appendChild(text);
                g.appendChild(dataLabel);
                g.appendChild(infoLabel);
                g.appendChild(cashLabel);
                svg.appendChild(g);
            });
        }
        
        // 獲取供應鏈節點顏色
        function getSupplyChainNodeColor(type) {
            const colors = {
                'source': '#27AE60',   // 綠色 - 源頭
                'process': '#F39C12',  // 橙色 - 加工
                'storage': '#3498DB',  // 藍色 - 倉儲
                'logistics': '#9B59B6', // 紫色 - 物流
                'retail': '#E74C3C'    // 紅色 - 零售
            };
            return colors[type] || '#95A5A6';
        }

        // 計算節點邊緣位置，避免線條穿過節點
        function getEdgePosition(source, target, radius = 60) {
            const dx = target.x - source.x;
            const dy = target.y - source.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const ratio = radius / distance;

            return {
                startX: source.x + dx * ratio,
                startY: source.y + dy * ratio,
                endX: target.x - dx * ratio,
                endY: target.y - dy * ratio
            };
        }

        // 創建詳細零售支付SVG圖
        function createDetailedRetailPaymentSvg(svg, flow) {
            const paymentNodes = flow.detailedNodes.filter(n => ['customer', 'merchant', 'platform', 'settlement'].includes(n.type));
            const supportNodes = flow.detailedNodes.filter(n => ['tech'].includes(n.type));
            
            // 先繪製所有連接線（放在最底層）
            // 1. 主要支付流程連接線
            for (let i = 0; i < paymentNodes.length - 1; i++) {
                const node = paymentNodes[i];
                const nextNode = paymentNodes[i + 1];
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                const { startX, startY, endX, endY } = getEdgePosition(node, nextNode, 65);
                line.setAttribute('x1', startX);
                line.setAttribute('y1', startY);
                line.setAttribute('x2', endX);
                line.setAttribute('y2', endY);
                line.setAttribute('stroke', '#FF6B6B');
                line.setAttribute('stroke-width', '3');
                line.setAttribute('marker-end', 'url(#mini-arrow)');
                svg.appendChild(line);
                
                // 添加流程標籤
                const connection = flow.connections.find(c => c.from === node.id && c.to === nextNode.id);
                if (connection) {
                    const connLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    connLabel.setAttribute('x', (node.x + nextNode.x) / 2);
                    connLabel.setAttribute('y', node.y - 20);
                    connLabel.setAttribute('text-anchor', 'middle');
                    connLabel.setAttribute('fill', '#FF6B6B');
                    connLabel.setAttribute('font-size', '16');
                    connLabel.setAttribute('font-weight', 'bold');
                    connLabel.textContent = connection.label;
                    svg.appendChild(connLabel);
                }
            }
            
            // 2. 支撐節點連接線
            supportNodes.forEach(node => {
                paymentNodes.forEach(paymentNode => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const techSource = { x: node.x, y: node.type === 'tech' ? node.y + 35 : node.y - 35 };
                    const techTarget = { x: paymentNode.x, y: node.type === 'tech' ? paymentNode.y - 40 : paymentNode.y + 40 };
                    const { startX: techStartX, startY: techStartY, endX: techEndX, endY: techEndY } = getEdgePosition(techSource, techTarget, node.type === 'tech' ? 90 : 45);
                    line.setAttribute('x1', techStartX);
                    line.setAttribute('y1', techStartY);
                    line.setAttribute('x2', techEndX);
                    line.setAttribute('y2', techEndY);
                    line.setAttribute('stroke', node.type === 'tech' ? '#3498DB' : '#E67E22');
                    line.setAttribute('stroke-width', '2');
                    line.setAttribute('stroke-dasharray', '6,3');
                    line.setAttribute('opacity', '0.7');
                    svg.appendChild(line);
                });
            });
            
            // 然後繪製主要支付流程節點（放在上層）
            paymentNodes.forEach((node, index) => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // 主支付節點（圓角矩形）
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', node.x - 120);
                rect.setAttribute('y', node.y - 70);
                rect.setAttribute('width', '240');
                rect.setAttribute('height', '140');
                rect.setAttribute('rx', '20');
                rect.setAttribute('fill', '#4A90E2');
                rect.setAttribute('stroke', '#fff');
                rect.setAttribute('stroke-width', '4');
                rect.setAttribute('filter', 'drop-shadow(3px 3px 8px rgba(0,0,0,0.2))');
                
                // 節點名稱
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + 8);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-size', '24');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.name;
                
                // 數據標籤（上方）
                const dataLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                dataLabel.setAttribute('x', node.x);
                dataLabel.setAttribute('y', node.y - 85);
                dataLabel.setAttribute('text-anchor', 'middle');
                dataLabel.setAttribute('fill', '#333');
                dataLabel.setAttribute('font-size', '19');
                dataLabel.setAttribute('font-weight', 'bold');
                dataLabel.textContent = node.data;
                
                // 支付流程標籤（下方）
                const flowLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                flowLabel.setAttribute('x', node.x);
                flowLabel.setAttribute('y', node.y + 90);
                flowLabel.setAttribute('text-anchor', 'middle');
                flowLabel.setAttribute('fill', '#E74C3C');
                flowLabel.setAttribute('font-size', '17');
                flowLabel.setAttribute('font-weight', 'bold');
                flowLabel.textContent = node.paymentFlow;
                
                // 交易數據標籤（最下方）
                const transLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                transLabel.setAttribute('x', node.x);
                transLabel.setAttribute('y', node.y + 110);
                transLabel.setAttribute('text-anchor', 'middle');
                transLabel.setAttribute('fill', '#666');
                transLabel.setAttribute('font-size', '14');
                transLabel.textContent = node.transactionData;
                
                g.appendChild(rect);
                g.appendChild(text);
                g.appendChild(dataLabel);
                g.appendChild(flowLabel);
                g.appendChild(transLabel);
                svg.appendChild(g);
            });
            
            // 繪製支撐基礎設施（上下方向）
            supportNodes.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // 支撐節點（橢圓形）
                const ellipse = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
                ellipse.setAttribute('cx', node.x);
                ellipse.setAttribute('cy', node.y);
                ellipse.setAttribute('rx', '150');
                ellipse.setAttribute('ry', '60');
                ellipse.setAttribute('fill', node.type === 'tech' ? '#3498DB' : '#E67E22');
                ellipse.setAttribute('stroke', '#fff');
                ellipse.setAttribute('stroke-width', '3');
                ellipse.setAttribute('opacity', '0.9');
                ellipse.setAttribute('filter', 'drop-shadow(2px 2px 6px rgba(0,0,0,0.15))');
                
                // 節點名稱
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + 8);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-size', '19');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.name;
                
                // 技術標籤
                const techLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                techLabel.setAttribute('x', node.x);
                techLabel.setAttribute('y', node.y + (node.type === 'tech' ? -70 : 75));
                techLabel.setAttribute('text-anchor', 'middle');
                techLabel.setAttribute('fill', '#666');
                techLabel.setAttribute('font-size', '14');
                techLabel.textContent = node.data;
                
                g.appendChild(ellipse);
                g.appendChild(text);
                g.appendChild(techLabel);
                svg.appendChild(g);
                
                // 添加到支付節點的連接線（虛線）
                paymentNodes.forEach(paymentNode => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', node.x);
                    const techSource = { x: node.x, y: node.type === 'tech' ? node.y + 35 : node.y - 35 };
                    const techTarget = { x: paymentNode.x, y: node.type === 'tech' ? paymentNode.y - 40 : paymentNode.y + 40 };
                    const { startX: techStartX, startY: techStartY, endX: techEndX, endY: techEndY } = getEdgePosition(techSource, techTarget, node.type === 'tech' ? 90 : 45);
                    line.setAttribute('x1', techStartX);
                    line.setAttribute('y1', techStartY);
                    line.setAttribute('x2', techEndX);
                    line.setAttribute('y2', techEndY);
                    line.setAttribute('stroke', node.type === 'tech' ? '#3498DB' : '#E67E22');
                    line.setAttribute('stroke-width', '2');
                    line.setAttribute('stroke-dasharray', '6,3');
                    line.setAttribute('opacity', '0.7');
                    svg.appendChild(line);
                });
            });
            
        }
        
        // 獲取零售支付節點顏色
        function getRetailPaymentNodeColor(type) {
            const colors = {
                'customer': '#3498DB',   // 藍色 - 消費者
                'merchant': '#27AE60',  // 綠色 - 商戶
                'platform': '#E74C3C', // 紅色 - 平台
                'settlement': '#9B59B6' // 紫色 - 結算
            };
            return colors[type] || '#95A5A6';
        }

        // 創建詳細跨境交易SVG圖
        function createDetailedCrossBorderSvg(svg, flow) {
            const mainNodes = flow.detailedNodes.filter(n => ['supplier', 'logistics', 'compliance', 'settlement', 'banking'].includes(n.type));
            const supportNodes = flow.detailedNodes.filter(n => ['tech', 'risk'].includes(n.type));
            
            // 先繪製所有連接線（放在最底層）
            // 1. 主要跨境交易流程連接線
            for (let i = 0; i < mainNodes.length - 1; i++) {
                const node = mainNodes[i];
                const nextNode = mainNodes[i + 1];
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                const { startX, startY, endX, endY } = getEdgePosition(node, nextNode, 80);
                line.setAttribute('x1', startX);
                line.setAttribute('y1', startY);
                line.setAttribute('x2', endX);
                line.setAttribute('y2', endY);
                line.setAttribute('stroke', '#FF9F40');
                line.setAttribute('stroke-width', '3');
                line.setAttribute('marker-end', 'url(#mini-arrow)');
                svg.appendChild(line);
            }
            
            // 2. 支撐節點連接線 - 只留風險管理系統的連接線
            supportNodes.forEach(node => {
                if (node.type === 'risk') {
                    // 風險管理系統連接到所有主要節點
                    mainNodes.forEach(mainNode => {
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        const { startX, startY, endX, endY } = getEdgePosition(node, mainNode, 80);
                        line.setAttribute('x1', startX);
                        line.setAttribute('y1', startY);
                        line.setAttribute('x2', endX);
                        line.setAttribute('y2', endY);
                        line.setAttribute('stroke', '#E67E22');
                        line.setAttribute('stroke-width', '2');
                        line.setAttribute('stroke-dasharray', '6,3');
                        line.setAttribute('opacity', '0.7');
                        svg.appendChild(line);
                    });
                }
            });
            
            // 然後繪製主要跨境交易流程節點（放在上層）
            mainNodes.forEach((node, index) => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // 根據風險等級設置節點形狀和顏色，放大節點尺寸
                let shape, fill;
                if (node.riskLevel === 'high') {
                    // 高風險節點使用六邊形
                    shape = createHexagon(node.x, node.y, 80);
                    fill = '#E74C3C'; // 紅色
                } else if (node.riskLevel === 'medium') {
                    // 中風險節點使用菱形
                    shape = createDiamond(node.x, node.y, 80);
                    fill = '#F39C12'; // 橙色
                } else {
                    // 低風險節點使用圓形
                    shape = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    shape.setAttribute('cx', node.x);
                    shape.setAttribute('cy', node.y);
                    shape.setAttribute('r', '80');
                    fill = '#27AE60'; // 綠色
                }
                
                shape.setAttribute('fill', fill);
                shape.setAttribute('stroke', '#fff');
                shape.setAttribute('stroke-width', '4');
                shape.setAttribute('filter', 'drop-shadow(3px 3px 8px rgba(0,0,0,0.2))');
                
                // 節點名稱，調整字體大小以配合更大的節點
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + 8);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-size', '15');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.name;
                
                g.appendChild(shape);
                g.appendChild(text);
                svg.appendChild(g);
            });
            
            // 添加回款流程線（從銀行回到供應商）
            const bankNode = mainNodes.find(n => n.type === 'banking');
            const supplierNode = mainNodes.find(n => n.type === 'supplier');
            if (bankNode && supplierNode) {
                const returnLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const d = `M ${bankNode.x} ${bankNode.y + 35} Q ${(bankNode.x + supplierNode.x) / 2} ${bankNode.y + 80} ${supplierNode.x} ${supplierNode.y + 35}`;
                returnLine.setAttribute('d', d);
                returnLine.setAttribute('fill', 'none');
                returnLine.setAttribute('stroke', '#27AE60');
                returnLine.setAttribute('stroke-width', '3');
                returnLine.setAttribute('stroke-dasharray', '6,3');
                returnLine.setAttribute('marker-end', 'url(#mini-arrow)');
                svg.appendChild(returnLine);
            }
            
            // 繪製支撐系統（上下方向）
            supportNodes.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // 支撐節點（橢圓形）
                const ellipse = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
                ellipse.setAttribute('cx', node.x);
                ellipse.setAttribute('cy', node.y);
                ellipse.setAttribute('rx', '140');
                ellipse.setAttribute('ry', '60');
                ellipse.setAttribute('fill', node.type === 'tech' ? '#3498DB' : '#E67E22');
                ellipse.setAttribute('stroke', '#fff');
                ellipse.setAttribute('stroke-width', '3');
                ellipse.setAttribute('opacity', '0.9');
                ellipse.setAttribute('filter', 'drop-shadow(2px 2px 6px rgba(0,0,0,0.15))');
                
                // 節點名稱
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + 8);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-size', '18');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.name;
                
                // 技術標籤
                const techLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                techLabel.setAttribute('x', node.x);
                techLabel.setAttribute('y', node.y + (node.type === 'tech' ? -75 : 75));
                techLabel.setAttribute('text-anchor', 'middle');
                techLabel.setAttribute('fill', '#666');
                techLabel.setAttribute('font-size', '13');
                techLabel.textContent = node.data;
                
                g.appendChild(ellipse);
                g.appendChild(text);
                g.appendChild(techLabel);
                svg.appendChild(g);
            });
            
            // 移除各國交易額顯示
        }
        
        // 創建金融服務流程詳細SVG
        function createDetailedFinanceServiceSvg(svg, flow) {
            const nodes = flow.detailedNodes;
            
            // 根據層級分組
            const settlementNodes = nodes.filter(n => n.type === 'settlement');
            const coreNodes = nodes.filter(n => n.type === 'core');
            const financeNodes = nodes.filter(n => n.type === 'finance' || n.type === 'assets' || n.type === 'crossborder');
            const exchangeNodes = nodes.filter(n => n.type === 'exchange' || n.type === 'banking');
            const complianceNodes = nodes.filter(n => n.type === 'compliance');
            
            // 先繪製所有連接線（放在最底層）
            // 1. 結算層到核心連接線
            settlementNodes.forEach(settlementNode => {
                coreNodes.forEach(coreNode => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const { startX, startY, endX, endY } = getEdgePosition(settlementNode, coreNode, 100);
                    line.setAttribute('x1', startX);
                    line.setAttribute('y1', startY);
                    line.setAttribute('x2', endX);
                    line.setAttribute('y2', endY);
                    line.setAttribute('stroke', '#3498DB');
                    line.setAttribute('stroke-width', '3');
                    line.setAttribute('opacity', '0.8');
                    svg.appendChild(line);
                });
            });
            
            // 2. 核心到金融服務連接線
            coreNodes.forEach(coreNode => {
                financeNodes.forEach(financeNode => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const { startX, startY, endX, endY } = getEdgePosition(coreNode, financeNode, 100);
                    line.setAttribute('x1', startX);
                    line.setAttribute('y1', startY);
                    line.setAttribute('x2', endX);
                    line.setAttribute('y2', endY);
                    line.setAttribute('stroke', '#E67E22');
                    line.setAttribute('stroke-width', '3');
                    line.setAttribute('opacity', '0.8');
                    svg.appendChild(line);
                });
            });
            
            // 3. 金融服務到交易所/銀行連接線
            financeNodes.forEach(financeNode => {
                exchangeNodes.forEach(exchangeNode => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const { startX, startY, endX, endY } = getEdgePosition(financeNode, exchangeNode, 100);
                    line.setAttribute('x1', startX);
                    line.setAttribute('y1', startY);
                    line.setAttribute('x2', endX);
                    line.setAttribute('y2', endY);
                    line.setAttribute('stroke', '#9B59B6');
                    line.setAttribute('stroke-width', '2');
                    line.setAttribute('stroke-dasharray', '6,3');
                    line.setAttribute('opacity', '0.7');
                    svg.appendChild(line);
                });
            });
            
            // 然後繪製所有節點（放在上層）
            nodes.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // 節點圓圈
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', node.type === 'core' ? '100' : '80');
                circle.setAttribute('fill', getFinanceServiceNodeColor(node.type));
                circle.setAttribute('stroke', '#fff');
                circle.setAttribute('stroke-width', '4');
                circle.setAttribute('filter', 'drop-shadow(3px 3px 8px rgba(0,0,0,0.2))');
                
                // 節點名稱
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y - 8);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-size', node.type === 'core' ? '18' : '16');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.name;
                
                // 數據標籤（放在節點框內，標題下方）
                const dataLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                dataLabel.setAttribute('x', node.x);
                dataLabel.setAttribute('y', node.y + 18);
                dataLabel.setAttribute('text-anchor', 'middle');
                dataLabel.setAttribute('fill', '#333');
                dataLabel.setAttribute('font-size', '13');
                dataLabel.setAttribute('font-weight', 'bold');
                dataLabel.textContent = node.data;
                
                // 層級標籤
                const layerLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                layerLabel.setAttribute('x', node.x);
                layerLabel.setAttribute('y', node.y + 115);
                layerLabel.setAttribute('text-anchor', 'middle');
                layerLabel.setAttribute('fill', '#666');
                layerLabel.setAttribute('font-size', '13');
                layerLabel.textContent = node.layer;
                
                // 效率標籤
                const efficiencyLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                efficiencyLabel.setAttribute('x', node.x);
                efficiencyLabel.setAttribute('y', node.y + 135);
                efficiencyLabel.setAttribute('text-anchor', 'middle');
                efficiencyLabel.setAttribute('fill', '#888');
                efficiencyLabel.setAttribute('font-size', '11');
                efficiencyLabel.textContent = node.efficiency;
                
                g.appendChild(circle);
                g.appendChild(text);
                g.appendChild(dataLabel);
                g.appendChild(layerLabel);
                g.appendChild(efficiencyLabel);
                svg.appendChild(g);
            });
            
            // 添加層級背景
            const layerColors = {
                '基礎支付層': '#FF9F40',
                '金融增值層': '#4ECDC4',
                '合作銀行與交易層': '#6C5CE7',
                '監管合規層': '#9B59B6'
            };
            
            Object.keys(layerColors).forEach(layerName => {
                const layerNodes = nodes.filter(n => n.layer === layerName);
                if (layerNodes.length > 0) {
                    const minX = Math.min(...layerNodes.map(n => n.x)) - 80;
                    const maxX = Math.max(...layerNodes.map(n => n.x)) + 80;
                    const minY = Math.min(...layerNodes.map(n => n.y)) - 35;
                    const maxY = Math.max(...layerNodes.map(n => n.y)) + 35;
                    
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttribute('x', minX);
                    rect.setAttribute('y', minY);
                    rect.setAttribute('width', maxX - minX);
                    rect.setAttribute('height', maxY - minY);
                    rect.setAttribute('fill', layerColors[layerName]);
                    rect.setAttribute('opacity', '0.1');
                    rect.setAttribute('rx', '10');
                    svg.insertBefore(rect, svg.firstChild);
                }
            });
        }
        
        // 創建六邊形
        function createHexagon(cx, cy, size) {
            const hex = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            const points = [];
            for (let i = 0; i < 6; i++) {
                const angle = (Math.PI / 3) * i;
                const x = cx + size * Math.cos(angle);
                const y = cy + size * Math.sin(angle);
                points.push(`${x},${y}`);
            }
            hex.setAttribute('points', points.join(' '));
            return hex;
        }
        
        // 創建菱形
        function createDiamond(cx, cy, size) {
            const diamond = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            const points = [
                `${cx},${cy - size}`,      // 上
                `${cx + size},${cy}`,      // 右
                `${cx},${cy + size}`,      // 下
                `${cx - size},${cy}`       // 左
            ];
            diamond.setAttribute('points', points.join(' '));
            return diamond;
        }
        
        // 返回主頁面
        function backToMain() {
            document.getElementById('flow-detail-page').style.display = 'none';
            document.getElementById('main-dashboard').style.display = 'grid';
            resetView();
        }
        
        // 獲取節點圖標
        function getNodeIcon(type) {
            const icons = {
                'core': '💎',
                'business': '🏢',
                'finance': '💰',
                'partner': '🤝'
            };
            return icons[type] || '📍';
        }
        
        // 高亮連接
        function highlightConnections(nodeId) {
            // 重置所有元素
            document.querySelectorAll('.node').forEach(n => {
                n.style.opacity = '0.3';
            });
            document.querySelectorAll('.link').forEach(l => {
                l.style.opacity = '0.1';
            });
            
            // 高亮選中節點
            const selectedNode = document.querySelector(`[data-id="${nodeId}"]`);
            if (selectedNode) {
                selectedNode.style.opacity = '1';
            }
            
            // 高亮相關連線和節點
            const node = nodes.find(n => n.id === nodeId);
            if (node && node.connections) {
                node.connections.forEach(connId => {
                    // 高亮連接的節點
                    const connNode = document.querySelector(`[data-id="${connId}"]`);
                    if (connNode) {
                        connNode.style.opacity = '0.8';
                    }
                    
                    // 高亮連線
                    document.querySelectorAll('.link').forEach(link => {
                        if ((link.dataset.source === nodeId && link.dataset.target === connId) ||
                            (link.dataset.source === connId && link.dataset.target === nodeId)) {
                            link.style.opacity = '1';
                            link.setAttribute('stroke-width', '4');
                        }
                    });
                });
            }
        }
        
        // 流程高亮
        function highlightFlow(flowType) {
            resetView();
            
            // 設置按鈕狀態
            document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const flows = {
                'retail': {
                    nodes: ['consumers', 'merchant_pos', 'stablecoin_platform', 'supplier_settlement'],
                    detailedNodes: [
                        {
                            id: 'consumers',
                            name: '消費者',
                            type: 'customer',
                            x: 150,
                            y: 250,
                            data: '日交易: 1,000萬筆(推估)',
                            paymentFlow: 'B2C支付',
                            transactionData: '3秒完成, 會員1,800萬+',
                            scenarios: ['便利商店', '藥妝店', '咖啡廳', '線上購物']
                        },
                        {
                            id: 'merchant_pos',
                            name: '商戶POS/零售通路',
                            type: 'merchant',
                            x: 350,
                            y: 250,
                            data: '門市: 7,110家',
                            paymentFlow: 'POS終端/線上支付',
                            transactionData: '1.5-3%手續費節省',
                            scenarios: ['7-ELEVEN', '康是美', '聖娜多堡', '星巴克', 'PChome'],
                            entertainmentSub: ['統一夢時代', 'KTV', '電影票務', 'W Hotel', '50+娛樂場館(推估)']
                        },
                        {
                            id: 'stablecoin_platform',
                            name: '穩定幣支付平台',
                            type: 'platform',
                            x: 550,
                            y: 250,
                            data: '統一證整合',
                            paymentFlow: '即時結算',
                            transactionData: '自動化清算, 24/7運行',
                            scenarios: ['身份驗證', '交易記錄', '風控系統', '合規管理']
                        },
                        {
                            id: 'supplier_settlement',
                            name: '供應商結算/品牌清算',
                            type: 'settlement',
                            x: 750,
                            y: 250,
                            data: '供應商: 500+(推估)',
                            paymentFlow: 'B2B自動結算',
                            transactionData: '智能合約執行',
                            scenarios: ['供應商付款', '品牌分潤', '加盟商結算', '平台手續費']
                        },
                        {
                            id: 'blockchain_support',
                            name: '區塊鏈基礎設施',
                            type: 'tech',
                            x: 400,
                            y: 150,
                            data: 'TPS: 1,500-2,000',
                            paymentFlow: '交易驗證與記錄',
                            transactionData: '99.9% SLA, <1秒延遲',
                            scenarios: ['交易確認', '智能合約', '數據存證', '審計追蹤']
                        },
                        {
                            id: 'financial_rails',
                            name: '金融軌道',
                            type: 'finance',
                            x: 450,
                            y: 350,
                            data: '多銀行整合',
                            paymentFlow: '法幣兌換與儲備',
                            transactionData: '110%儲備率, 季審',
                            scenarios: ['入金出金', '儲備管理', '流動性池', '監管報告']
                        }
                    ],
                    connections: [
                        { from: '消費者', to: '商戶系統', type: '企業對消費者支付', label: '企業對消費者支付' },
                        { from: '商戶系統', to: '穩定幣平台', type: '商戶結算', label: '商戶結算' },
                        { from: '穩定幣平台', to: '供應商結算', type: '企業對企業結算', label: '企業對企業結算' },
                        { from: '區塊鏈支援', to: '消費者', type: '技術支援', label: '交易確認' },
                        { from: '區塊鏈支援', to: '商戶系統', type: '技術支援', label: '銷售點系統整合' },
                        { from: '區塊鏈支援', to: '穩定幣平台', type: '技術支援', label: '智能合約' },
                        { from: '區塊鏈支援', to: '供應商結算', type: '技術支援', label: '自動結算' },
                        { from: '金融軌道', to: '消費者', type: '流動性', label: '入金通道' },
                        { from: '金融軌道', to: '商戶系統', type: '流動性', label: '出金通道' },
                        { from: '金融軌道', to: '穩定幣平台', type: '流動性', label: '儲備支撐' },
                        { from: '金融軌道', to: '供應商結算', type: '流動性', label: '資金池' }
                    ],
                    color: '#FF6B6B',
                    title: '零售支付流程',
                    description: '統一集團完整零售支付鏈路：消費者B2C支付 → 商戶POS結算 → 穩定幣平台處理 → 供應商B2B清算，整合區塊鏈技術與金融基礎設施',
                    steps: [
                        '👥 消費者端：1,800萬+會員，日1,000萬筆交易，3秒快速支付體驗',
                        '🏪 商戶POS：7,110門市全通路，1.5-3%手續費節省，包含娛樂場景',
                        '⚡ 穩定幣平台：統一證整合身份，24/7自動清算，即時結算',
                        '🏭 供應商結算：500+供應商智能合約自動付款，品牌分潤精確',
                        '⛓️ 區塊鏈支撐：1,500-2,000 TPS，99.9% SLA，全程交易記錄',
                        '🏦 金融軌道：多銀行整合，110%儲備率，合規監管保障'
                    ],
                    benefits: [
                        '💰 B2C成本優化：消費者享受更低手續費，商戶節省1.5-3%成本',
                        '⚡ 支付效率：3秒快速結帳，24/7即時結算，無需等待',
                        '🔄 B2B自動化：供應商智能合約自動收款，減少人工對帳',
                        '🎯 全場景覆蓋：零售+娛樂+線上，統一積分會員系統',
                        '📊 數據透明：區塊鏈記錄不可篡改，支援精準營運分析',
                        '🛡️ 風險控制：合規身份驗證，多層風控，資金安全保障'
                    ],
                    relatedNodes: [
                        {
                            category: '核心節點',
                            nodes: [
                                { name: '穩定幣', role: '價值交換媒介，錨定新台幣，提供穩定價值基礎', icon: '💎' },
                                { name: '區塊鏈', role: '交易記錄與驗證，智能合約執行，數據不可篡改', icon: '⛓️' }
                            ]
                        },
                        {
                            category: '業務節點',
                            nodes: [
                                { name: '零售通路', role: '7-ELEVEN、PChome等零售支付場景，提供消費者直接接觸點', icon: '🏪' },
                                { name: '休閒娛樂', role: '統一夢時代、KTV、電影票務等娛樂支付場景', icon: '🎮' },
                                { name: '統一其他業務', role: '旅行社、能源等小額支付場景，擴展支付生態', icon: '🏢' }
                            ]
                        },
                        {
                            category: '合作夥伴',
                            nodes: [
                                { name: '合作發行商', role: '銀行、金融機構，提供支付結算可信度與合規保障', icon: '🤝' }
                            ]
                        }
                    ],
                    keyMetrics: [
                        { label: '日交易筆數', value: '1,000萬', unit: '筆(推估)' },
                        { label: '覆蓋門市', value: '7,110', unit: '家' },
                        { label: '手續費節省', value: '1.5-3%', unit: '' },
                        { label: '結算速度', value: '3', unit: '秒' },
                        { label: '會員數量', value: '1,800萬+', unit: '人' },
                        { label: '供應商數量', value: '500+', unit: '家(推估)' },
                        { label: '娛樂場館', value: '50+', unit: '個(推估)' },
                        { label: '系統可用性', value: '99.9%', unit: 'SLA' }
                    ]
                },
                'supply': {
                    nodes: ['cold_source', 'processing', 'warehouse', 'distribution', 'retail_end', 'blockchain', 'stablecoin'],
                    detailedNodes: [
                        {
                            id: 'cold_source',
                            name: '冷鏈農產',
                            type: 'source',
                            x: 100,
                            y: 280,
                            data: '源頭供應商: 200+(推估)',
                            infoFlow: '溫度、產地、檢驗數據',
                            cashFlow: '採購款 15億/年(推估)'
                        },
                        {
                            id: 'processing',
                            name: '加工廠',
                            type: 'process',
                            x: 250,
                            y: 280,
                            data: '加工廠: 50+(推估)',
                            infoFlow: '加工記錄、品質檢驗',
                            cashFlow: '加工費 8億/年(推估)'
                        },
                        {
                            id: 'warehouse',
                            name: '倉儲中心',
                            type: 'storage',
                            x: 400,
                            y: 280,
                            data: '倉儲節點: 100+(推估)',
                            infoFlow: '庫存、溫控、出入庫',
                            cashFlow: '倉儲費 3億/年(推估)'
                        },
                        {
                            id: 'distribution',
                            name: '配送中心',
                            type: 'logistics',
                            x: 550,
                            y: 280,
                            data: '配送中心: 30+(推估)',
                            infoFlow: '配送軌跡、溫度監控',
                            cashFlow: '物流費 5億/年(推估)'
                        },
                        {
                            id: 'retail_end',
                            name: '門市終端',
                            type: 'retail',
                            x: 700,
                            y: 280,
                            data: '門市: 7,110家',
                            infoFlow: '銷售數據、庫存管理',
                            cashFlow: '終端銷售 600億/年(推估)'
                        },
                        {
                            id: 'supply_finance',
                            name: '供應鏈融資',
                            type: 'finance',
                            x: 400,
                            y: 100,
                            data: '應收帳款融資服務',
                            infoFlow: '供應商提交應收帳款/倉單作為抵押',
                            cashFlow: '穩定幣即時放款，智能合約自動還款'
                        },
                        {
                            id: 'rwa_assets',
                            name: 'RWA資產化',
                            type: 'assets',
                            x: 400,
                            y: 300,
                            data: '不動產代幣化',
                            infoFlow: '商場、倉儲、建設項目資產評估',
                            cashFlow: 'RWA/REIT代幣發行，穩定幣投資認購'
                        },
                        {
                            id: 'cross_border',
                            name: '跨境貿易',
                            type: 'global',
                            x: 850,
                            y: 200,
                            data: '4+國家貿易網路',
                            infoFlow: '日本、泰國、菲律賓、大陸',
                            cashFlow: '降低2-5%匯兌成本，數分鐘到帳'
                        },
                        {
                            id: 'blockchain',
                            name: '區塊鏈',
                            type: 'tech',
                            x: 400,
                            y: 150,
                            data: 'TPS: 500-1,000',
                            infoFlow: '全程追溯、智能合約',
                            cashFlow: '系統成本節省 10-30億/年(推估)'
                        },
                        {
                            id: 'stablecoin',
                            name: '穩定幣',
                            type: 'finance',
                            x: 400,
                            y: 400,
                            data: '結算效率: 即時',
                            infoFlow: '交易記錄、合規數據',
                            cashFlow: '手續費節省 1.5-3%'
                        }
                    ],
                    connections: [
                        { from: 'cold_source', to: 'processing', type: 'supply' },
                        { from: 'processing', to: 'warehouse', type: 'supply' },
                        { from: 'warehouse', to: 'distribution', type: 'supply' },
                        { from: 'distribution', to: 'retail_end', type: 'supply' },
                        { from: 'blockchain', to: 'cold_source', type: 'data' },
                        { from: 'blockchain', to: 'processing', type: 'data' },
                        { from: 'blockchain', to: 'warehouse', type: 'data' },
                        { from: 'blockchain', to: 'distribution', type: 'data' },
                        { from: 'blockchain', to: 'retail_end', type: 'data' },
                        { from: 'stablecoin', to: 'cold_source', type: 'payment' },
                        { from: 'stablecoin', to: 'processing', type: 'payment' },
                        { from: 'stablecoin', to: 'warehouse', type: 'payment' },
                        { from: 'stablecoin', to: 'distribution', type: 'payment' }
                    ],
                    color: '#4ECDC4',
                    title: '食品供應鏈流程',
                    description: '統一集團完整食品供應鏈：冷鏈農產 → 加工 → 倉儲 → 配送中心 → 門市，結合區塊鏈追溯與穩定幣結算的數位化升級',
                    steps: [
                        '🌾 冷鏈農產源頭：200+供應商，年採購15億，溫度監控上鏈',
                        '🏭 加工廠處理：50+加工廠，品質檢驗數據區塊鏈記錄',
                        '📦 倉儲配送：130+節點，溫控與庫存即時追蹤',
                        '🏪 門市終端：7,110門市，銷售數據與追溯系統整合',
                        '⛓️ 區塊鏈追溯：全程不可篡改記錄，秒級問題定位',
                        '💎 穩定幣結算：供應商自動化付款，節省1.5-3%手續費'
                    ],
                    benefits: [
                        '📊 資訊流透明：全程追溯100%，食安問題秒級定位',
                        '💰 資金流優化：年節省手續費10-30億，供應商即時收款',
                        '🔄 流程自動化：智能合約執行付款，減少人工對帳成本',
                        '⚡ 效率提升：結算時間從數天縮短至即時',
                        '🛡️ 風險控制：食品召回精準化，每案最高省2.5億成本',
                        '📈 數據價值：供應鏈大數據支援精準採購與庫存管理'
                    ],
                    relatedNodes: [
                        {
                            category: '核心節點',
                            nodes: [
                                { name: '穩定幣', role: '供應鏈結算媒介，提供穩定價值基礎與即時結算', icon: '💎' },
                                { name: '區塊鏈', role: '冷鏈追溯記錄，食品安全數據不可篡改存證', icon: '⛓️' }
                            ]
                        },
                        {
                            category: '業務節點',
                            nodes: [
                                { name: '食品供應鏈', role: '冷鏈追溯系統，從農場到餐桌的完整食品安全管理', icon: '🍎' },
                                { name: '統一證', role: '作為金融介面，整合身份驗證與結算功能', icon: '🏛️' }
                            ]
                        },
                        {
                            category: '金融節點',
                            nodes: [
                                { name: '交易所', role: '大宗採購支付結算，提供流動性與價格發現', icon: '💹' },
                                { name: 'RWA', role: '應收帳款代幣化，將供應鏈資產證券化', icon: '💎' }
                            ]
                        },
                        {
                            category: '合作夥伴',
                            nodes: [
                                { name: '合作發行商', role: '銀行、金融機構，提供供應鏈融資支持', icon: '🤝' }
                            ]
                        }
                    ],
                    keyMetrics: [
                        { label: '供應商數量', value: '200+', unit: '家' },
                        { label: '年交易額', value: '參考產業規模', unit: '' },
                        { label: '冷鏈設施', value: '完整網絡', unit: '' },
                        { label: '追溯能力', value: '區塊鏈技術', unit: '' },
                        { label: '結算效率', value: '智能合約', unit: '' },
                        { label: '成本效益', value: '參考案例', unit: '' }
                    ]
                },
                'finance': {
                    nodes: ['retail_settlement', 'supply_settlement', 'stablecoin', 'supply_finance', 'rwa_reit', 'crossborder_settlement', 'exchange', 'partner_banks', 'regulatory_audit'],
                    detailedNodes: [
                        // 基礎支付層（第一層，最上方）
                        {
                            id: 'retail_settlement',
                            name: '零售結算',
                            type: 'settlement',
                            x: 200,
                            y: 100,
                            data: '日交易: 1,000萬筆',
                            layer: '基礎支付層',
                            flowType: '日常交易穩定幣流動',
                            efficiency: '3秒結算，24/7運行'
                        },
                        {
                            id: 'supply_settlement',
                            name: '供應鏈結算',
                            type: 'settlement',
                            x: 500,
                            y: 100,
                            data: '供應商: 500+',
                            layer: '基礎支付層',
                            flowType: 'B2B自動結算',
                            efficiency: '智能合約執行'
                        },
                        // 穩定幣核心（第二層，中間置中）
                        {
                            id: 'stablecoin',
                            name: '穩定幣核心',
                            type: 'core',
                            x: 350,
                            y: 220,
                            data: '核心價值媒介',
                            layer: '核心節點',
                            flowType: '連接所有金融服務',
                            efficiency: '支付→融資→資產化→監管全流程'
                        },
                        // 金融增值層（第三層，三個並列）
                        {
                            id: 'supply_finance',
                            name: '供應鏈融資',
                            type: 'finance',
                            x: 200,
                            y: 340,
                            data: '應收帳款融資',
                            layer: '金融增值層',
                            flowType: '穩定幣即時放款',
                            efficiency: 'T+1放款，縮短融資週期'
                        },
                        {
                            id: 'rwa_reit',
                            name: 'RWA/REIT',
                            type: 'assets',
                            x: 350,
                            y: 340,
                            data: '不動產代幣化',
                            layer: '金融增值層',
                            flowType: '穩定幣投資認購',
                            efficiency: '公有鏈資產可查詢'
                        },
                        {
                            id: 'crossborder_settlement',
                            name: '跨境結算',
                            type: 'crossborder',
                            x: 500,
                            y: 340,
                            data: '跨境支付服務',
                            layer: '金融增值層',
                            flowType: '穩定幣跨境流動',
                            efficiency: '即時跨境結算'
                        },
                        // 合作銀行與交易層（第四層，分支結構）
                        {
                            id: 'exchange',
                            name: '交易所',
                            type: 'exchange',
                            x: 275,
                            y: 460,
                            data: '24h交易: 10-100億',
                            layer: '合作銀行與交易層',
                            flowType: '形成流動性',
                            efficiency: '100-2000交易對'
                        },
                        {
                            id: 'partner_banks',
                            name: '合作銀行',
                            type: 'banking',
                            x: 500,
                            y: 460,
                            data: '7家主要銀行',
                            layer: '合作銀行與交易層',
                            flowType: '出入金與儲備保管',
                            efficiency: '110%儲備率'
                        },
                        // 監管合規層（第五層，最下方）
                        {
                            id: 'regulatory_audit',
                            name: '監管審計 / 透明化',
                            type: 'compliance',
                            x: 500,
                            y: 580,
                            data: '季度審計',
                            layer: '監管合規層',
                            flowType: '儲備與跨境合規',
                            efficiency: '獨立審計機構'
                        }
                    ],
                    connections: [
                        // 基礎支付流向
                        { from: '零售結算', to: '穩定幣核心', type: '支付流程', label: '日常交易流' },
                        { from: '供應鏈結算', to: '穩定幣核心', type: '支付流程', label: 'B2B結算流' },
                        // 金融增值流向
                        { from: '穩定幣核心', to: '供應鏈融資', type: '融資流程', label: '融資放款' },
                        { from: '穩定幣核心', to: 'RWA/REIT', type: '投資流程', label: '資產投資' },
                        { from: '供應鏈融資', to: '交易所', type: '流動性流程', label: '形成流動性' },
                        { from: 'RWA/REIT', to: '交易所', type: '流動性流程', label: '代幣交易' },
                        // 跨境與合規流向
                        { from: '穩定幣核心', to: '跨境結算', type: '跨境流程', label: '跨境支付' },
                        { from: '跨境結算', to: '合作銀行', type: '銀行流程', label: '儲備管理' },
                        { from: '合作銀行', to: '監管審計 / 透明化', type: '審計流程', label: '合規監管' }
                    ],
                    color: '#6C5CE7',
                    title: '金融服務流程',
                    description: '以穩定幣為核心的五層金融服務架構：基礎支付層→穩定幣核心→金融增值層→合作銀行與交易層→監管合規層',
                    steps: [
                        '🧡 基礎支付層：零售結算與供應鏈結算，日1,000萬筆交易流量',
                        '🔴 穩定幣核心：居中協調，連接所有金融服務的價值媒介',
                        '🔵 金融增值層：供應鏈融資、RWA/REIT、跨境結算三個並列服務',
                        '🔵 合作銀行與交易層：交易所形成流動性，合作銀行管理儲備',
                        '🟣 監管合規層：監管審計透明化，確保合規與儲備安全'
                    ],
                    benefits: [
                        '⚡ 融資速度：供應鏈融資T+1放款，大幅縮短融資週期',
                        '🔍 透明度：RWA資產在公有鏈可查詢，投資透明',
                        '🏗️ 資產流動性：不動產代幣化，流動性大幅提升',
                        '🛡️ 風險控制：四層架構分工明確，風險隔離有效'
                    ],
                    relatedNodes: [
                        {
                            category: '核心節點',
                            nodes: [
                                { name: '穩定幣', role: '金融服務核心媒介，連接支付、融資、資產化全流程', icon: '💎' }
                            ]
                        },
                        {
                            category: '金融節點',
                            nodes: [
                                { name: 'RWA', role: '資產代幣化平台，將實體資產轉化為數位證券', icon: '🏢' },
                                { name: '交易所', role: '提供資產交易流動性，價格發現與市場機制', icon: '💹' },
                                { name: '統一證', role: '金融服務介面，整合身份驗證與投資功能', icon: '🏛️' }
                            ]
                        },
                        {
                            category: '業務節點',
                            nodes: [
                                { name: '建設', role: 'RWA資產化來源，提供不動產與建設項目', icon: '🏗️' }
                            ]
                        },
                        {
                            category: '合作夥伴',
                            nodes: [
                                { name: '合作發行商', role: '銀行、金融機構，提供傳統金融服務介面', icon: '🤝' }
                            ]
                        }
                    ],
                    keyMetrics: [
                        { label: '融資速度', value: 'T+1', unit: '天' },
                        { label: '儲備率', value: '110%', unit: '' },
                        { label: '審計頻率', value: '季度', unit: '' },
                        { label: '交易對數', value: '100-2000', unit: '對' },
                        { label: '合作銀行', value: '7', unit: '家' },
                        { label: '日交易量', value: '1000萬', unit: '筆' }
                    ]
                },
                'cross': {
                    nodes: ['overseas_suppliers', 'logistics_customs', 'compliance_hub', 'stablecoin_settlement', 'partner_banks'],
                    detailedNodes: [
                        {
                            id: 'overseas_suppliers',
                            name: '海外供應商/出口商',
                            type: 'supplier',
                            x: 120,
                            y: 280,
                            data: '供應商: 300+(推估)',
                            countryBreakdown: {
                                '日本': '150億/年',
                                '泰國': '200億/年', 
                                '菲律賓': '180億/年',
                                '中國': '270億/年'
                            },
                            transactionData: '原料採購、食品進口',
                            riskLevel: 'medium',
                            complianceReq: ['商業發票', '產地證明', '品質檢驗']
                        },
                        {
                            id: 'logistics_customs',
                            name: '物流與海關',
                            type: 'logistics',
                            x: 280,
                            y: 280,
                            data: '港口: 4個主要',
                            services: ['貨運追蹤', '清關代理', '倉儲配送', '文件處理'],
                            transactionData: '貨物流+資訊流整合',
                            riskLevel: 'high',
                            complianceReq: ['海關申報', '檢疫證明', '關稅計算']
                        },
                        {
                            id: 'compliance_hub',
                            name: '合規審核中心',
                            type: 'compliance',
                            x: 440,
                            y: 280,
                            data: 'DID/Travel Rule',
                            services: ['身份驗證', 'AML檢查', '制裁名單', '交易監控'],
                            transactionData: '合規數據留存7年',
                            riskLevel: 'high',
                            complianceReq: ['KYC/KYB', 'AML/CFT', 'FATCA/CRS']
                        },
                        {
                            id: 'stablecoin_settlement',
                            name: '穩定幣結算平台',
                            type: 'settlement',
                            x: 600,
                            y: 280,
                            data: '即時結算',
                            services: ['匯率鎖定', '智能合約', '多幣種支援', '風險控制'],
                            transactionData: '節省2-5%匯兌成本',
                            riskLevel: 'medium',
                            complianceReq: ['儲備審計', '流動性管理', '監管報告']
                        },
                        {
                            id: 'partner_banks',
                            name: '合作銀行/法幣出入金',
                            type: 'banking',
                            x: 760,
                            y: 280,
                            data: '銀行: 7家主要',
                            services: ['法幣兌換', '資金託管', '信用狀', 'SWIFT替代'],
                            transactionData: '多國銀行網絡',
                            riskLevel: 'low',
                            complianceReq: ['央行監管', '外匯管制', 'SWIFT合規']
                        },
                        {
                            id: 'blockchain_network',
                            name: '區塊鏈跨鏈網絡',
                            type: 'tech',
                            x: 440,
                            y: 100,
                            data: 'TPS: 500-1,000',
                            services: ['跨鏈橋接', '交易確認', '數據存證', '智能合約'],
                            transactionData: '99.9% SLA, <5秒延遲',
                            riskLevel: 'low',
                            complianceReq: ['節點管理', '數據備份', '安全審計']
                        },
                        {
                            id: 'risk_management',
                            name: '風險管理系統',
                            type: 'risk',
                            x: 440,
                            y: 380,
                            data: '24/7監控',
                            services: ['匯率風控', '信用評估', '制裁篩查', '異常檢測'],
                            transactionData: '多層級風控',
                            riskLevel: 'medium',
                            complianceReq: ['風險評級', '監控報告', '應急預案']
                        }
                    ],
                    connections: [
                        { from: '海外供應商', to: '物流海關', type: '貨物流程', label: '貨物流+發票' },
                        { from: '物流海關', to: '合規中心', type: '文件流程', label: '清關文件' },
                        { from: '合規中心', to: '穩定幣結算', type: '核准流程', label: '合規通過' },
                        { from: '穩定幣結算', to: '合作銀行', type: '流動性流程', label: '法幣轉換' },
                        { from: '合作銀行', to: '海外供應商', type: '付款流程', label: '付款到帳' },
                        { from: '區塊鏈網路', to: '合規中心', type: '技術支援', label: '數據存證' },
                        { from: '區塊鏈網路', to: '穩定幣結算', type: '技術支援', label: '智能合約' },
                        { from: '風險管理', to: '合規中心', type: '風險監控', label: '風險評估' },
                        { from: '風險管理', to: '穩定幣結算', type: '風險監控', label: '交易監控' }
                    ],
                    color: '#FF9F40',
                    title: '跨境交易流程',
                    description: '統一集團亞太4國(日本、泰國、菲律賓、中國)完整跨境貿易流程：海外供應商 → 物流清關 → 合規審核 → 穩定幣結算 → 銀行出入金，整合DID/Travel Rule合規框架',
                    steps: [
                        '🏭 海外供應商：300+供應商，涵蓋日泰菲中4國，年交易800億',
                        '🚢 物流清關：4個主要港口，貨物流與資訊流整合管理',
                        '🛡️ 合規審核：DID/Travel Rule框架，KYC/AML/制裁篩查',
                        '⚡ 穩定幣結算：即時結算，節省2-5%匯兌成本，智能合約執行',
                        '🏦 合作銀行：7家主要銀行，法幣出入金，SWIFT替代方案',
                        '⛓️ 區塊鏈支撐：跨鏈網絡，500-1,000 TPS，數據存證不可篡改',
                        '⚠️ 風險管控：24/7監控，匯率風控，多層級風險管理'
                    ],
                    benefits: [
                        '💰 成本優化：節省2-5%匯兌成本，年省1-3億元',
                        '⚡ 效率提升：即時結算替代T+1-3，加速資金周轉',
                        '🛡️ 合規保障：DID/Travel Rule框架，符合國際AML/CFT標準',
                        '🌐 網絡效應：整合亞太4國供應鏈，增強議價能力',
                        '📊 透明度：區塊鏈全程記錄，支援審計與追溯',
                        '⚠️ 風險分散：多國多銀行合作，降低單點風險',
                        '🚀 創新優勢：SWIFT替代方案，提升國際競爭力'
                    ],
                    relatedNodes: [
                        {
                            category: '核心節點',
                            nodes: [
                                { name: '穩定幣', role: '跨境支付媒介，避免匯率波動，提供穩定價值傳遞', icon: '💎' }
                            ]
                        },
                        {
                            category: '業務節點',
                            nodes: [
                                { name: '跨國貿易', role: '國際貿易結算，涵蓋日本、泰國、菲律賓、中國等市場', icon: '🌏' }
                            ]
                        },
                        {
                            category: '金融節點',
                            nodes: [
                                { name: '交易所', role: '外匯匯兌功能，提供穩定幣與各國法幣兌換', icon: '💹' }
                            ]
                        },
                        {
                            category: '合作夥伴',
                            nodes: [
                                { name: '合作發行商', role: '負責外部匯率管理、出入金服務與國際銀行網絡', icon: '🤝' }
                            ]
                        },
                        {
                            category: '技術支援',
                            nodes: [
                                { name: '區塊鏈', role: 'DID/Travel Rule合規，確保跨境交易符合國際反洗錢規範', icon: '⛓️' }
                            ]
                        }
                    ],
                    keyMetrics: [
                        { label: '交易國家', value: '4+', unit: '國' },
                        { label: '年貿易額', value: '800', unit: '億(推估)' },
                        { label: '海外供應商', value: '300+', unit: '家(推估)' },
                        { label: '匯兌成本節省', value: '2-5%', unit: '' },
                        { label: '結算速度', value: '即時', unit: '' },
                        { label: '合作銀行', value: '7', unit: '家' },
                        { label: '主要港口', value: '4', unit: '個' },
                        { label: '年成本節省', value: '1-3', unit: '億' }
                    ]
                }
            };
            
            const flow = flows[flowType];
            if (!flow) return;
            
            // 降低所有元素透明度
            document.querySelectorAll('.node').forEach(n => {
                n.style.opacity = '0.2';
            });
            document.querySelectorAll('.link').forEach(l => {
                l.style.opacity = '0.1';
            });
            
            // 高亮流程節點
            flow.nodes.forEach((nodeId, index) => {
                const node = document.querySelector(`[data-id="${nodeId}"]`);
                if (node) {
                    node.style.opacity = '1';
                    
                    // 添加序號標記
                    const number = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    number.setAttribute('x', '30');
                    number.setAttribute('y', '-30');
                    number.setAttribute('fill', flow.color);
                    number.setAttribute('font-size', '24');
                    number.setAttribute('font-weight', 'bold');
                    number.textContent = index + 1;
                    number.setAttribute('class', 'flow-number');
                    node.appendChild(number);
                }
            });
            
            // 高亮流程連線
            for (let i = 0; i < flow.nodes.length - 1; i++) {
                animateFlowPath(flow.nodes[i], flow.nodes[i + 1], flow.color);
            }
            
            // 跳轉到詳情頁面
            showFlowDetailPage(flow, flowType);
        }
        
        // 動畫流程路徑
        function animateFlowPath(sourceId, targetId, color) {
            document.querySelectorAll('.link').forEach(link => {
                if ((link.dataset.source === sourceId && link.dataset.target === targetId) ||
                    (link.dataset.source === targetId && link.dataset.target === sourceId)) {
                    link.style.opacity = '1';
                    link.setAttribute('stroke', color);
                    link.setAttribute('stroke-width', '4');
                    
                    // 添加流動動畫
                    const length = link.getTotalLength();
                    link.style.strokeDasharray = length;
                    link.style.strokeDashoffset = length;
                    
                    link.animate([
                        { strokeDashoffset: length },
                        { strokeDashoffset: 0 }
                    ], {
                        duration: 1000,
                        fill: 'forwards'
                    });
                }
            });
        }
        
        // 顯示價值流動
        
        // 原始價值流分析功能
        function showValueFlowAnalysis() {
            resetView();
            
            // 確保圖例顯示
            document.querySelector('.legend').style.display = 'block';
            document.getElementById('flow-description').style.display = 'none';
            
            // 創建粒子動畫
            const mainGroup = document.getElementById('main-group');
            
            links.forEach(link => {
                const sourceNode = nodes.find(n => n.id === link.source);
                const targetNode = nodes.find(n => n.id === link.target);
                
                if (!sourceNode || !targetNode || !link.frequency) return;
                
                // 根據交易頻率設定粒子密度和間隔
                const particleCount = link.frequency === 'high' ? 6 : 
                                    link.frequency === 'medium' ? 3 : 1;
                const interval = link.frequency === 'high' ? 200 : 
                               link.frequency === 'medium' ? 500 : 1000;
                
                // 創建流動粒子
                for (let i = 0; i < particleCount; i++) {
                    setTimeout(() => {
                        createFlowParticle(sourceNode, targetNode, link);
                    }, i * interval);
                }
            });
        }
        
        // 創建流動粒子
        function createFlowParticle(source, target, link) {
            const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            
            // 根據流動類型調整粒子大小和顏色
            const particleSize = link.flowType === 'high' ? 7 : 
                               link.flowType === 'medium' ? 5 : 3;
            particle.setAttribute('r', particleSize);
            particle.setAttribute('fill', getLineColor(link.type));
            particle.setAttribute('filter', 'url(#glow)');
            
            const mainGroup = document.getElementById('main-group');
            mainGroup.appendChild(particle);
            
            // 根據結算週期調整動畫速度
            const duration = link.frequency === 'high' ? 1500 : 
                           link.frequency === 'medium' ? 3000 : 5000;
            const startTime = Date.now();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = (elapsed % duration) / duration;
                
                // 曲線路徑動畫
                const midX = (source.x + target.x) / 2;
                const midY = (source.y + target.y) / 2 - 30;
                
                const x = Math.pow(1-progress, 2) * source.x + 
                         2 * (1-progress) * progress * midX + 
                         Math.pow(progress, 2) * target.x;
                const y = Math.pow(1-progress, 2) * source.y + 
                         2 * (1-progress) * progress * midY + 
                         Math.pow(progress, 2) * target.y;
                
                particle.setAttribute('cx', x);
                particle.setAttribute('cy', y);
                
                // 根據流動類型調整透明度變化
                const opacity = link.style === 'dashed' ? 
                              0.3 + 0.4 * Math.sin(progress * Math.PI) : // 沉澱型：淡入淡出
                              0.8 * (1 - Math.abs(progress - 0.5) * 1.5); // 流動型：快速變化
                particle.setAttribute('opacity', Math.max(0, opacity));
                
                if (elapsed < duration * 3) {
                    requestAnimationFrame(animate);
                } else {
                    particle.remove();
                }
            }
            
            animate();
        }
        
        // 風險地圖
        function showRiskMap() {
            showAnalysisDetailPage('risk-analysis', '⚠️ 風險節點分析', '分析統一集團穩定幣生態系統中的風險來源、傳導路徑與聲譽風險');
        }
        
        // 原始風險分析功能
        function showRiskAnalysis() {
            resetView();
            
            // 確保圖例顯示
            document.querySelector('.legend').style.display = 'block';
            document.getElementById('flow-description').style.display = 'none';
            
            // 風險等級定義
            const riskLevels = {
                'stablecoin': { 
                    level: 'medium', 
                    reason: '聲譽風險：公眾信任、品牌影響',
                    riskSources: ['儲備透明度', '監管合規', '市場信心'],
                    icon: '🛡️',
                    stability: 'T+0 結算'
                },
                'blockchain': { 
                    level: 'low', 
                    reason: '技術風險：系統穩定、安全防護',
                    riskSources: ['技術故障', '網路攻擊', '節點維護'],
                    icon: '⚙️',
                    stability: 'SLA 99.9%'
                },
                'crossborder': { 
                    level: 'high', 
                    reason: '法規風險：各國政策、匯率波動',
                    riskSources: ['法規變化', '匯率風險', '跨境合規'],
                    icon: '🌍',
                    stability: 'T+1 結算'
                },
                'construction': { 
                    level: 'medium-high', 
                    reason: '資產風險：估值波動、RWA流動性',
                    riskSources: ['資產估值', 'RWA流動性', '建設延期'],
                    icon: '🏗️',
                    stability: 'T+30 結算'
                },
                'rwa': { 
                    level: 'medium', 
                    reason: '新興技術：監管不明、流動性風險',
                    riskSources: ['監管待明', '技術創新', '流動性'],
                    icon: '💎',
                    stability: 'T+7 結算'
                },
                'exchange': { 
                    level: 'medium', 
                    reason: '市場風險：流動性、交易對手',
                    riskSources: ['流動性風險', '監管風險', '交易對手'],
                    icon: '📈',
                    stability: 'T+0 結算'
                },
                'partner': { 
                    level: 'low', 
                    reason: '合作風險：多方合作，風險分散',
                    riskSources: ['信用風險', '合作穩定性'],
                    icon: '🤝',
                    stability: 'SLA 99.9%'
                },
                'retail': { 
                    level: 'low', 
                    reason: '營運風險：商戶接入、操作流程',
                    riskSources: ['商戶接入', '操作風險', '系統故障'],
                    icon: '🏪',
                    stability: 'T+0 結算'
                },
                'food': { 
                    level: 'medium', 
                    reason: '供應鏈風險：供應商接入、結算延遲',
                    riskSources: ['供應商風險', '結算延遲', '品質控制'],
                    icon: '🍎',
                    stability: 'T+1 結算'
                },
                'leisure': { 
                    level: 'low', 
                    reason: '業務風險：現有場景，影響有限',
                    riskSources: ['季節性波動', '消費習慣'],
                    icon: '🎮',
                    stability: 'T+0 結算'
                },
                'other_business': { 
                    level: 'low', 
                    reason: '營運風險：小額交易，影響有限',
                    riskSources: ['業務分散', '小額影響'],
                    icon: '🔧',
                    stability: 'T+1 結算'
                },
                'integration': { 
                    level: 'low', 
                    reason: '平台風險：現有技術，穩定可靠',
                    riskSources: ['系統整合', '數據安全'],
                    icon: '🆔',
                    stability: 'SLA 99.99%'
                }
            };
            
            // 應用風險顏色
            nodes.forEach(node => {
                const nodeElement = document.querySelector(`[data-id="${node.id}"] circle`);
                if (nodeElement && riskLevels[node.id]) {
                    const risk = riskLevels[node.id];
                    const color = risk.level === 'high' ? '#E74C3C' : 
                                 risk.level === 'medium-high' ? '#E67E22' : 
                                 risk.level === 'medium' ? '#F39C12' : '#2ECC71';
                    
                    const nodeGroup = nodeElement.parentElement;
                    
                    // 添加風險外圈
                    const riskIndicator = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    riskIndicator.setAttribute('r', '60');
                    riskIndicator.setAttribute('fill', 'none');
                    riskIndicator.setAttribute('stroke', color);
                    riskIndicator.setAttribute('stroke-width', '4');
                    riskIndicator.setAttribute('opacity', '0.8');
                    
                    // 添加風險圖標（右上角）
                    const riskIcon = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    riskIcon.setAttribute('x', '40');
                    riskIcon.setAttribute('y', '-30');
                    riskIcon.setAttribute('font-size', '16');
                    riskIcon.setAttribute('text-anchor', 'middle');
                    riskIcon.textContent = risk.icon;
                    
                    // 添加風險來源提示（右上角小文字）
                    const riskText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    riskText.setAttribute('x', '40');
                    riskText.setAttribute('y', '-15');
                    riskText.setAttribute('font-size', '10');
                    riskText.setAttribute('text-anchor', 'middle');
                    riskText.setAttribute('fill', color);
                    riskText.setAttribute('font-weight', 'bold');
                    riskText.textContent = risk.riskSources[0]; // 顯示主要風險來源
                    
                    // 添加穩定性指標（左下角）
                    const stabilityBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    stabilityBg.setAttribute('x', '-65');
                    stabilityBg.setAttribute('y', '35');
                    stabilityBg.setAttribute('width', '80');
                    stabilityBg.setAttribute('height', '16');
                    stabilityBg.setAttribute('rx', '8');
                    stabilityBg.setAttribute('fill', '#34495E');
                    stabilityBg.setAttribute('opacity', '0.9');
                    
                    const stabilityText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    stabilityText.setAttribute('x', '-25');
                    stabilityText.setAttribute('y', '46');
                    stabilityText.setAttribute('font-size', '9');
                    stabilityText.setAttribute('text-anchor', 'middle');
                    stabilityText.setAttribute('fill', 'white');
                    stabilityText.textContent = risk.stability;
                    
                    // 將所有風險元素添加到節點組
                    nodeGroup.insertBefore(riskIndicator, nodeElement);
                    nodeGroup.appendChild(riskIcon);
                    nodeGroup.appendChild(riskText);
                    nodeGroup.appendChild(stabilityBg);
                    nodeGroup.appendChild(stabilityText);
                }
            });
            
            // 添加風險傳導路徑
            const riskPaths = [
                { from: 'crossborder', to: 'exchange', strength: 3, reason: '匯率風險影響交易所流動性' },
                { from: 'crossborder', to: 'stablecoin', strength: 2, reason: '法規風險影響穩定幣信任度' },
                { from: 'construction', to: 'rwa', strength: 4, reason: '建設資產估值直接影響RWA' },
                { from: 'food', to: 'retail', strength: 2, reason: '供應鏈延遲影響零售結算' },
                { from: 'exchange', to: 'stablecoin', strength: 3, reason: '交易所風險影響穩定幣儲備' },
                { from: 'stablecoin', to: 'retail', strength: 2, reason: '聲譽風險影響零售信心' }
            ];
            
            // 繪製風險傳導箭頭
            riskPaths.forEach(path => {
                const fromNode = nodes.find(n => n.id === path.from);
                const toNode = nodes.find(n => n.id === path.to);
                
                if (!fromNode || !toNode) return;
                
                const riskArrow = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const startX = fromNode.x;
                const startY = fromNode.y;
                const endX = toNode.x;
                const endY = toNode.y;
                
                // 創建弧形路徑
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2 - 40;
                const d = `M ${startX},${startY} Q ${midX},${midY} ${endX},${endY}`;
                
                riskArrow.setAttribute('d', d);
                riskArrow.setAttribute('fill', 'none');
                riskArrow.setAttribute('stroke', '#E74C3C');
                riskArrow.setAttribute('stroke-width', path.strength);
                riskArrow.setAttribute('stroke-dasharray', '8,4');
                riskArrow.setAttribute('opacity', '0.7');
                riskArrow.setAttribute('marker-end', 'url(#risk-arrow)');
                riskArrow.setAttribute('class', 'risk-path');
                
                // 添加路徑標籤
                const pathLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                pathLabel.setAttribute('x', midX);
                pathLabel.setAttribute('y', midY - 10);
                pathLabel.setAttribute('text-anchor', 'middle');
                pathLabel.setAttribute('fill', '#E74C3C');
                pathLabel.setAttribute('font-size', '8');
                pathLabel.setAttribute('opacity', '0.8');
                pathLabel.textContent = `風險傳導`;
                
                const mainGroup = document.getElementById('main-group');
                mainGroup.appendChild(riskArrow);
                mainGroup.appendChild(pathLabel);
            });
            
            // 添加風險箭頭標記到defs
            const defs = document.querySelector('defs');
            const riskArrowMarker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            riskArrowMarker.setAttribute('id', 'risk-arrow');
            riskArrowMarker.setAttribute('markerWidth', '12');
            riskArrowMarker.setAttribute('markerHeight', '8');
            riskArrowMarker.setAttribute('refX', '10');
            riskArrowMarker.setAttribute('refY', '4');
            riskArrowMarker.setAttribute('orient', 'auto');
            riskArrowMarker.innerHTML = '<polygon points="0 0, 12 4, 0 8" fill="#E74C3C" opacity="0.8" />';
            defs.appendChild(riskArrowMarker);
        }
        
        
        
        
        
        // 技術與基礎設施分析
        function showTechInfrastructureAnalysis() {
            showAnalysisDetailPage('tech-infrastructure', '⚙️ 技術基礎設施分析', '分析統一集團穩定幣生態系統的技術架構需求、鏈類型選擇與建設優先級');
        }
        
        // 原始技術分析功能
        function showTechInfrastructureAnalysisView() {
            resetView();
            
            // 確保圖例顯示
            document.querySelector('.legend').style.display = 'block';
            document.getElementById('flow-description').style.display = 'none';
            
            // 為每個節點添加技術需求標註
            nodes.forEach(node => {
                if (!node.techRequirements) return;
                
                const nodeGroup = document.querySelector(`[data-id="${node.id}"]`);
                if (!nodeGroup) return;
                
                const tech = node.techRequirements;
                
                // 根據鏈類型設定節點顏色
                const chainColor = tech.chainType.includes('聯盟鏈') ? '#3498DB' : 
                                  tech.chainType.includes('公有鏈') ? '#2ECC71' : '#E74C3C';
                
                // 添加技術架構外圈
                const techRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                techRing.setAttribute('r', '70');
                techRing.setAttribute('fill', 'none');
                techRing.setAttribute('stroke', chainColor);
                techRing.setAttribute('stroke-width', '4');
                techRing.setAttribute('opacity', '0.8');
                techRing.setAttribute('stroke-dasharray', '10,3');
                
                // 添加鏈類型標籤（上方）
                const chainBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                chainBg.setAttribute('x', '-40');
                chainBg.setAttribute('y', '-85');
                chainBg.setAttribute('width', '80');
                chainBg.setAttribute('height', '18');
                chainBg.setAttribute('rx', '9');
                chainBg.setAttribute('fill', chainColor);
                chainBg.setAttribute('opacity', '0.9');
                
                const chainText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                chainText.setAttribute('x', '0');
                chainText.setAttribute('y', '-72');
                chainText.setAttribute('font-size', '10');
                chainText.setAttribute('text-anchor', 'middle');
                chainText.setAttribute('fill', 'white');
                chainText.setAttribute('font-weight', 'bold');
                chainText.textContent = tech.chainType;
                
                // 添加TPS指標（右上角）
                const tpsBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                tpsBg.setAttribute('x', '35');
                tpsBg.setAttribute('y', '-45');
                tpsBg.setAttribute('width', '65');
                tpsBg.setAttribute('height', '16');
                tpsBg.setAttribute('rx', '8');
                tpsBg.setAttribute('fill', '#9B59B6');
                tpsBg.setAttribute('opacity', '0.9');
                
                const tpsText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tpsText.setAttribute('x', '67');
                tpsText.setAttribute('y', '-33');
                tpsText.setAttribute('font-size', '9');
                tpsText.setAttribute('text-anchor', 'middle');
                tpsText.setAttribute('fill', 'white');
                tpsText.setAttribute('font-weight', 'bold');
                tpsText.textContent = tech.tps + ' TPS';
                
                // 添加SLA指標（左上角）
                const slaBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                slaBg.setAttribute('x', '-70');
                slaBg.setAttribute('y', '-45');
                slaBg.setAttribute('width', '50');
                slaBg.setAttribute('height', '16');
                slaBg.setAttribute('rx', '8');
                slaBg.setAttribute('fill', '#E67E22');
                slaBg.setAttribute('opacity', '0.9');
                
                const slaText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                slaText.setAttribute('x', '-45');
                slaText.setAttribute('y', '-33');
                slaText.setAttribute('font-size', '9');
                slaText.setAttribute('text-anchor', 'middle');
                slaText.setAttribute('fill', 'white');
                slaText.setAttribute('font-weight', 'bold');
                slaText.textContent = tech.sla;
                
                // 添加優先級圖標（左下角）
                const priorityIcon = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                priorityIcon.setAttribute('x', '-45');
                priorityIcon.setAttribute('y', '50');
                priorityIcon.setAttribute('font-size', '18');
                priorityIcon.setAttribute('text-anchor', 'middle');
                
                const priorityEmoji = tech.priority === '高技術要求' ? '🚀' : 
                                    tech.priority === '監管優先關注' ? '🛡️' : '📊';
                priorityIcon.textContent = priorityEmoji;
                
                // 添加延遲指標（右下角）
                const latencyBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                latencyBg.setAttribute('x', '20');
                latencyBg.setAttribute('y', '35');
                latencyBg.setAttribute('width', '60');
                latencyBg.setAttribute('height', '16');
                latencyBg.setAttribute('rx', '8');
                latencyBg.setAttribute('fill', '#34495E');
                latencyBg.setAttribute('opacity', '0.9');
                
                const latencyText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                latencyText.setAttribute('x', '50');
                latencyText.setAttribute('y', '46');
                latencyText.setAttribute('font-size', '9');
                latencyText.setAttribute('text-anchor', 'middle');
                latencyText.setAttribute('fill', 'white');
                latencyText.textContent = tech.latency;
                
                // 獲取節點元素用於插入順序
                const nodeElement = nodeGroup.querySelector('circle');
                
                // 將所有技術元素添加到節點組
                nodeGroup.insertBefore(techRing, nodeElement);
                nodeGroup.appendChild(chainBg);
                nodeGroup.appendChild(chainText);
                nodeGroup.appendChild(tpsBg);
                nodeGroup.appendChild(tpsText);
                nodeGroup.appendChild(slaBg);
                nodeGroup.appendChild(slaText);
                nodeGroup.appendChild(priorityIcon);
                nodeGroup.appendChild(latencyBg);
                nodeGroup.appendChild(latencyText);
            });
            
            // 添加查看技術矩陣按鈕到側邊欄
            setTimeout(() => {
                addTechMatrixButton();
            }, 500);
        }
        
        // 添加技術矩陣按鈕
        function addTechMatrixButton() {
            const sidebar = document.querySelector('.sidebar');
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'tech-matrix-button-container';
            buttonContainer.innerHTML = `
                <div style="margin-top: 20px; padding: 15px; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                    <button onclick="showTechMatrixPage()" style="
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: bold;
                        cursor: pointer;
                        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                        transition: all 0.3s;
                        width: 100%;
                    ">
                        ⚙️ 查看技術架構矩陣
                    </button>
                    <p style="margin: 10px 0 0 0; color: #666; font-size: 12px;">點擊查看詳細的技術需求規格表</p>
                </div>
            `;
            
            // 移除舊的按鈕（如果存在）
            const existingButton = sidebar.querySelector('.tech-matrix-button-container');
            if (existingButton) existingButton.remove();
            
            sidebar.appendChild(buttonContainer);
        }
        
        // 顯示技術矩陣頁面
        function showTechMatrixPage() {
            showAnalysisDetailPage('tech-matrix', '⚙️ 技術架構需求矩陣', '詳細的技術規格需求與建設優先級矩陣');
        }
        
        // 顯示分析詳情頁面
        function showAnalysisDetailPage(analysisType, title, description) {
            // 隱藏主要內容
            document.querySelector('.main-container').style.display = 'none';
            
            // 創建分析詳情頁面
            const analysisPage = document.createElement('div');
            analysisPage.className = 'flow-detail-page';
            analysisPage.id = 'analysis-detail-page';
            
            analysisPage.innerHTML = `
                <div class="flow-detail-header">
                    <button class="back-btn" onclick="hideAnalysisDetailPage()">
                        <span>←</span> 回到生態系統
                    </button>
                    <div class="flow-detail-title">
                        <h1>${title}</h1>
                        <p>${description}</p>
                    </div>
                </div>
                
                <div class="flow-detail-content">
                    <div class="detail-main">
                        <div id="analysis-content"></div>
                    </div>
                    
                    <div class="flow-detail-sidebar">
                        <div class="detail-section">
                            <h2>📊 分析概要</h2>
                            <div class="detail-card">
                                <div id="analysis-summary"></div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h2>🎯 重點指標</h2>
                            <div class="detail-card">
                                <div id="analysis-metrics"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flow-detail-ecosystem">
                    <h2>🎯 環形風險分層圖</h2>
                    <div class="mini-ecosystem" id="analysis-ecosystem">
                        <svg id="analysis-ecosystem-svg" width="100%" height="800"></svg>
                    </div>
                </div>
            `;
            
            document.body.appendChild(analysisPage);
            
            // 根據分析類型加載對應內容
            loadAnalysisContent(analysisType);
        }
        
        // 隱藏分析詳情頁面
        function hideAnalysisDetailPage() {
            const analysisPage = document.getElementById('analysis-detail-page');
            if (analysisPage) {
                analysisPage.remove();
            }
            document.querySelector('.main-container').style.display = 'block';
        }
        
        // 加載分析內容
        function loadAnalysisContent(analysisType) {
            const contentDiv = document.getElementById('analysis-content');
            const summaryDiv = document.getElementById('analysis-summary');
            const metricsDiv = document.getElementById('analysis-metrics');
            const ecosystemSvg = document.getElementById('analysis-ecosystem-svg');
            
            switch(analysisType) {
                case 'risk-analysis':
                    loadRiskAnalysisContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg);
                    break;
                case 'tech-infrastructure':
                    loadTechInfrastructureContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg);
                    break;
                case 'tech-matrix':
                    loadTechMatrixContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg);
                    break;
                case 'efficiency-analysis':
                    loadEfficiencyAnalysisContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg);
                    break;
            }
        }
        
        // 價值流分析內容
        function loadValueFlowContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg) {
            contentDiv.innerHTML = `
                <div class="detail-section">
                    <h2>💸 價值流動分析</h2>
                    
                    <!-- 資金流向總覽（核心指標卡片） -->
                    <div class="detail-card">
                        <h4>💰 資金流向總覽</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px;">
                            <!-- 按資金流量大小排序的卡片 -->
                            <div class="flow-card large" style="flex: 3; background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border-left: 5px solid #4caf50;">
                                <div class="flow-header">
                                    <span class="flow-name">零售網路</span>
                                    <span class="flow-amount">1,500 億</span>
                                </div>
                                <div class="flow-frequency">高頻交易</div>
                            </div>
                            
                            <div class="flow-card medium" style="flex: 2; background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-left: 5px solid #2196f3;">
                                <div class="flow-header">
                                    <span class="flow-name">跨境貿易</span>
                                    <span class="flow-amount">800 億</span>
                                </div>
                                <div class="flow-frequency">中頻交易</div>
                            </div>
                            
                            <div class="flow-card medium" style="flex: 2; background: linear-gradient(135deg, #fff3e0, #ffcc80); border-left: 5px solid #ff9800;">
                                <div class="flow-header">
                                    <span class="flow-name">食品供應鏈</span>
                                    <span class="flow-amount">600 億</span>
                                </div>
                                <div class="flow-frequency">中頻交易</div>
                            </div>
                            
                            <div class="flow-card small" style="flex: 1; background: linear-gradient(135deg, #fce4ec, #f8bbd9); border-left: 5px solid #e91e63;">
                                <div class="flow-header">
                                    <span class="flow-name">RWA</span>
                                    <span class="flow-amount">100 億</span>
                                </div>
                                <div class="flow-frequency">低頻交易</div>
                            </div>
                            
                            <div class="flow-card small" style="flex: 1; background: linear-gradient(135deg, #f3e5f5, #ce93d8); border-left: 5px solid #9c27b0;">
                                <div class="flow-header">
                                    <span class="flow-name">其他</span>
                                    <span class="flow-amount">270 億</span>
                                </div>
                                <div class="flow-frequency">混合頻率</div>
                            </div>
                        </div>
                        
                        <!-- 總結框 -->
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #dee2e6;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 24px; font-weight: bold; color: #2c3e50;">年度總資金流量：3,570 億</div>
                                    <div style="font-size: 14px; color: #6c757d; margin-top: 5px;">核心流向集中度：前 3 項占比約 85%</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 16px; color: #28a745; font-weight: bold;">穩定幣覆蓋率</div>
                                    <div style="font-size: 20px; color: #28a745; font-weight: bold;">72%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 價值流動結構圖 -->
                    <div class="detail-card">
                        <h4>🔄 價值流動結構圖</h4>
                        <div style="position: relative; height: 500px; border: 1px solid #ddd; border-radius: 8px; background: #fff;">
                            <svg id="value-flow-svg" width="100%" height="100%" viewBox="0 0 800 500"></svg>
                        </div>
                    </div>
                    
                    <!-- 結算頻率與效率分析 -->
                    <div class="detail-card">
                        <h4>⚡ 結算頻率與效率分析</h4>
                        <div style="display: flex; gap: 30px; align-items: center;">
                            <!-- 圓餅圖容器 -->
                            <div style="flex: 1;">
                                <div style="position: relative; height: 300px;">
                                    <svg id="settlement-efficiency-svg" width="100%" height="100%" viewBox="0 0 300 300"></svg>
                                </div>
                            </div>
                            
                            <!-- 說明文字 -->
                            <div style="flex: 1;">
                                <div class="kpi-grid">
                                    <div class="kpi-item" style="background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border-left: 4px solid #4caf50;">
                                        <div class="kpi-value" style="color: #2e7d32;">即時結算</div>
                                        <div class="kpi-label">70% - 零售網路、休閒娛樂</div>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">高頻業務已具備即時結算能力</div>
                                    </div>
                                    <div class="kpi-item" style="background: linear-gradient(135deg, #fff3e0, #ffcc80); border-left: 4px solid #ff9800;">
                                        <div class="kpi-value" style="color: #ef6c00;">T+1 結算</div>
                                        <div class="kpi-label">20% - 食品供應鏈、部分建設</div>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">供應商結算和工程款項</div>
                                    </div>
                                    <div class="kpi-item" style="background: linear-gradient(135deg, #ffebee, #ffcdd2); border-left: 4px solid #f44336;">
                                        <div class="kpi-value" style="color: #c62828;">T+2 以上</div>
                                        <div class="kpi-label">10% - 跨境模組、大型RWA</div>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">跨境模組尚依賴較長結算周期</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            summaryDiv.innerHTML = `
                <p><strong>年度總資金流量：</strong>3,570億</p>
                <p><strong>核心流向集中度：</strong>前3項占比85%</p>
                <p><strong>即時結算覆蓋：</strong>70%</p>
                <p><strong>效率提升：</strong>成本節省3-5%</p>
            `;
            
            metricsDiv.innerHTML = `
                <div class="kpi-grid">
                    <div class="kpi-item">
                        <div class="kpi-value">3,570億</div>
                        <div class="kpi-label">年度資金處理規模</div>
                    </div>
                    <div class="kpi-item">
                        <div class="kpi-value">85%</div>
                        <div class="kpi-label">核心流向集中度</div>
                    </div>
                </div>
            `;
            
            // 渲染價值流動結構圖
            setTimeout(() => renderValueFlowDiagram(), 100);
            
            // 渲染結算效率圓餅圖
            setTimeout(() => renderSettlementEfficiencyChart(), 100);
        }
        
        // 渲染價值流動結構圖（流向圖）
        function renderValueFlowDiagram() {
            const svg = document.getElementById('value-flow-svg');
            if (!svg) return;
            
            svg.innerHTML = '';
            
            // 流動數據
            const flowData = [
                { name: '零售網路', amount: 1500, color: '#4caf50', efficiency: 'high', settlement: '即時' },
                { name: '跨境貿易', amount: 800, color: '#2196f3', efficiency: 'medium', settlement: 'T+1' },
                { name: '食品供應鏈', amount: 600, color: '#ff9800', efficiency: 'medium', settlement: 'T+1' },
                { name: 'RWA', amount: 100, color: '#e91e63', efficiency: 'low', settlement: 'T+2' },
                { name: '其他業務', amount: 270, color: '#9c27b0', efficiency: 'medium', settlement: '混合' }
            ];
            
            const centerX = 400;
            const centerY = 250;
            const centerRadius = 60;
            
            // 繪製中心圓（統一集團穩定幣）
            const centerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            centerCircle.setAttribute('cx', centerX);
            centerCircle.setAttribute('cy', centerY);
            centerCircle.setAttribute('r', centerRadius);
            centerCircle.setAttribute('fill', '#2c3e50');
            centerCircle.setAttribute('stroke', '#fff');
            centerCircle.setAttribute('stroke-width', '4');
            svg.appendChild(centerCircle);
            
            // 中心文字
            const centerText1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerText1.setAttribute('x', centerX);
            centerText1.setAttribute('y', centerY - 8);
            centerText1.setAttribute('text-anchor', 'middle');
            centerText1.setAttribute('font-size', '14');
            centerText1.setAttribute('font-weight', 'bold');
            centerText1.setAttribute('fill', '#fff');
            centerText1.textContent = '統一集團';
            svg.appendChild(centerText1);
            
            const centerText2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerText2.setAttribute('x', centerX);
            centerText2.setAttribute('y', centerY + 8);
            centerText2.setAttribute('text-anchor', 'middle');
            centerText2.setAttribute('font-size', '14');
            centerText2.setAttribute('font-weight', 'bold');
            centerText2.setAttribute('fill', '#fff');
            centerText2.textContent = '穩定幣';
            svg.appendChild(centerText2);
            
            // 繪製流向線和節點
            flowData.forEach((item, index) => {
                const angle = (index / flowData.length) * 2 * Math.PI - Math.PI / 2;
                const distance = 180;
                const nodeX = centerX + distance * Math.cos(angle);
                const nodeY = centerY + distance * Math.sin(angle);
                
                // 線條粗細基於資金流量
                const lineWidth = Math.max(3, (item.amount / 1500) * 15);
                
                // 線條顏色基於結算效率
                const lineColor = item.efficiency === 'high' ? '#4caf50' : 
                                 item.efficiency === 'medium' ? '#ff9800' : '#f44336';
                
                // 連接線
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', centerX + centerRadius * Math.cos(angle));
                line.setAttribute('y1', centerY + centerRadius * Math.sin(angle));
                line.setAttribute('x2', nodeX - 30 * Math.cos(angle));
                line.setAttribute('y2', nodeY - 30 * Math.sin(angle));
                line.setAttribute('stroke', lineColor);
                line.setAttribute('stroke-width', lineWidth);
                line.setAttribute('opacity', '0.7');
                line.setAttribute('stroke-linecap', 'round');
                svg.appendChild(line);
                
                // 節點圓圈
                const nodeRadius = Math.max(25, (item.amount / 1500) * 35);
                const nodeCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                nodeCircle.setAttribute('cx', nodeX);
                nodeCircle.setAttribute('cy', nodeY);
                nodeCircle.setAttribute('r', nodeRadius);
                nodeCircle.setAttribute('fill', item.color);
                nodeCircle.setAttribute('stroke', '#fff');
                nodeCircle.setAttribute('stroke-width', '3');
                nodeCircle.setAttribute('opacity', '0.9');
                svg.appendChild(nodeCircle);
                
                // 節點標籤背景
                const textBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                const textWidth = item.name.length * 8;
                textBg.setAttribute('x', nodeX - textWidth / 2);
                textBg.setAttribute('y', nodeY - 8);
                textBg.setAttribute('width', textWidth);
                textBg.setAttribute('height', '16');
                textBg.setAttribute('fill', '#fff');
                textBg.setAttribute('opacity', '0.9');
                textBg.setAttribute('rx', '8');
                textBg.setAttribute('stroke', '#ccc');
                textBg.setAttribute('stroke-width', '1');
                svg.appendChild(textBg);
                
                // 節點標籤
                const nodeText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                nodeText.setAttribute('x', nodeX);
                nodeText.setAttribute('y', nodeY + 4);
                nodeText.setAttribute('text-anchor', 'middle');
                nodeText.setAttribute('font-size', '12');
                nodeText.setAttribute('font-weight', 'bold');
                nodeText.setAttribute('fill', '#000');
                nodeText.textContent = item.name;
                svg.appendChild(nodeText);
                
                // 資金流量標籤
                const amountText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                amountText.setAttribute('x', nodeX);
                amountText.setAttribute('y', nodeY + nodeRadius + 20);
                amountText.setAttribute('text-anchor', 'middle');
                amountText.setAttribute('font-size', '11');
                amountText.setAttribute('font-weight', 'bold');
                amountText.setAttribute('fill', item.color);
                amountText.textContent = `${item.amount}億`;
                svg.appendChild(amountText);
                
                // 添加互動提示框功能
                const tooltip = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                tooltip.setAttribute('class', 'tooltip');
                tooltip.style.display = 'none';
                
                nodeCircle.addEventListener('mouseenter', function() {
                    // 顯示提示框邏輯可以在這裡添加
                });
            });
            
            // 添加圖例
            const legend = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            const legendData = [
                { color: '#4caf50', label: '高效率即時結算', x: 50, y: 50 },
                { color: '#ff9800', label: 'T+1結算', x: 50, y: 70 },
                { color: '#f44336', label: 'T+2以上延遲結算', x: 50, y: 90 }
            ];
            
            legendData.forEach(item => {
                const legendLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                legendLine.setAttribute('x1', item.x);
                legendLine.setAttribute('y1', item.y);
                legendLine.setAttribute('x2', item.x + 20);
                legendLine.setAttribute('y2', item.y);
                legendLine.setAttribute('stroke', item.color);
                legendLine.setAttribute('stroke-width', '4');
                svg.appendChild(legendLine);
                
                const legendText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                legendText.setAttribute('x', item.x + 30);
                legendText.setAttribute('y', item.y + 4);
                legendText.setAttribute('font-size', '12');
                legendText.setAttribute('fill', '#333');
                legendText.textContent = item.label;
                svg.appendChild(legendText);
            });
        }
        
        // 渲染結算效率圓餅圖
        function renderSettlementEfficiencyChart() {
            const svg = document.getElementById('settlement-efficiency-svg');
            if (!svg) return;
            
            svg.innerHTML = '';
            
            const centerX = 150;
            const centerY = 150;
            const radius = 100;
            
            const data = [
                { label: '即時結算', value: 70, color: '#4caf50' },
                { label: 'T+1結算', value: 20, color: '#ff9800' },
                { label: 'T+2以上', value: 10, color: '#f44336' }
            ];
            
            let currentAngle = -Math.PI / 2; // 從頂部開始
            
            data.forEach((item, index) => {
                const sliceAngle = (item.value / 100) * 2 * Math.PI;
                const endAngle = currentAngle + sliceAngle;
                
                // 計算弧形路徑
                const largeArcFlag = sliceAngle > Math.PI ? 1 : 0;
                const x1 = centerX + radius * Math.cos(currentAngle);
                const y1 = centerY + radius * Math.sin(currentAngle);
                const x2 = centerX + radius * Math.cos(endAngle);
                const y2 = centerY + radius * Math.sin(endAngle);
                
                const pathData = `M ${centerX} ${centerY} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', item.color);
                path.setAttribute('stroke', '#fff');
                path.setAttribute('stroke-width', '2');
                path.setAttribute('opacity', '0.9');
                svg.appendChild(path);
                
                // 百分比標籤
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelRadius = radius * 0.7;
                const labelX = centerX + labelRadius * Math.cos(labelAngle);
                const labelY = centerY + labelRadius * Math.sin(labelAngle);
                
                const labelText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                labelText.setAttribute('x', labelX);
                labelText.setAttribute('y', labelY + 4);
                labelText.setAttribute('text-anchor', 'middle');
                labelText.setAttribute('font-size', '14');
                labelText.setAttribute('font-weight', 'bold');
                labelText.setAttribute('fill', '#fff');
                labelText.textContent = `${item.value}%`;
                svg.appendChild(labelText);
                
                currentAngle = endAngle;
            });
            
            // 中心標題
            const titleText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            titleText.setAttribute('x', centerX);
            titleText.setAttribute('y', centerY - 5);
            titleText.setAttribute('text-anchor', 'middle');
            titleText.setAttribute('font-size', '16');
            titleText.setAttribute('font-weight', 'bold');
            titleText.setAttribute('fill', '#2c3e50');
            titleText.textContent = '結算效率';
            svg.appendChild(titleText);
            
            const subtitleText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            subtitleText.setAttribute('x', centerX);
            subtitleText.setAttribute('y', centerY + 15);
            subtitleText.setAttribute('text-anchor', 'middle');
            subtitleText.setAttribute('font-size', '12');
            subtitleText.setAttribute('fill', '#6c757d');
            subtitleText.textContent = '分布圖';
            svg.appendChild(subtitleText);
        }
        
        // 風險分析內容
        function loadRiskAnalysisContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg) {
            contentDiv.innerHTML = `
                <div class="detail-section">
                    <h2>⚠️ 統一集團穩定幣風險節點分析</h2>
                    <div class="detail-card">
                        <h4>🔴 高風險節點（紅色外圈）</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffebee, #ffcdd2); border-left: 4px solid #e74c3c;">
                                <div class="kpi-value" style="color: #c62828;">🌍 跨境支付</div>
                                <div class="kpi-label">法規不確定</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">東南亞國家對穩定幣政策尚不穩定，監管限制將影響資金調度</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffebee, #ffcdd2); border-left: 4px solid #e74c3c;">
                                <div class="kpi-value" style="color: #c62828;">🏗️ 海外供應鏈</div>
                                <div class="kpi-label">匯率波動</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">海外原料採購及食品進口涉及匯率波動與法規變動</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffebee, #ffcdd2); border-left: 4px solid #e74c3c;">
                                <div class="kpi-value" style="color: #c62828;">🏢 建設與大型RWA</div>
                                <div class="kpi-label">流動性風險</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">長期借貸與高額支付，房地產或基建市場不景氣影響</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>🟠 中風險節點（橙色中圈）</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item" style="background: linear-gradient(135deg, #fff3e0, #ffcc80); border-left: 4px solid #ff9800;">
                                <div class="kpi-value" style="color: #e65100;">💹 交易所與DeFi</div>
                                <div class="kpi-label">流動性波動</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">涉及流動性與市場波動，需完善監理規範</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #fff3e0, #ffcc80); border-left: 4px solid #ff9800;">
                                <div class="kpi-value" style="color: #e65100;">💎 RWA抵押</div>
                                <div class="kpi-label">市場風險</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">債券上鏈與抵押資產涉及市場波動</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #fff3e0, #ffcc80); border-left: 4px solid #ff9800;">
                                <div class="kpi-value" style="color: #e65100;">💰 資金池運用</div>
                                <div class="kpi-label">利率波動</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">儲備配置比例失衡或市場利率劇烈波動</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #fff3e0, #ffcc80); border-left: 4px solid #ff9800;">
                                <div class="kpi-value" style="color: #e65100;">🌟 品牌Token</div>
                                <div class="kpi-label">聲譽風險</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">作為大型零售品牌，任何支付故障將直接影響品牌信任</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>🟢 低風險節點（綠色內圈）</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item" style="background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border-left: 4px solid #4caf50;">
                                <div class="kpi-value" style="color: #2e7d32;">💵 TWDT穩定幣</div>
                                <div class="kpi-label">風險極低</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">100%-110%現金及短債儲備，儲備分散多家銀行、定期審計</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border-left: 4px solid #4caf50;">
                                <div class="kpi-value" style="color: #2e7d32;">🔗 聯盟鏈清算</div>
                                <div class="kpi-label">技術穩定</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">以聯盟鏈為主要結算層，技術風險極低</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border-left: 4px solid #4caf50;">
                                <div class="kpi-value" style="color: #2e7d32;">🏪 7-ELEVEN</div>
                                <div class="kpi-label">場景穩固</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">現有零售通路穩定，受外部波動影響有限</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border-left: 4px solid #4caf50;">
                                <div class="kpi-value" style="color: #2e7d32;">🤝 合作夥伴</div>
                                <div class="kpi-label">風險分散</div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">多數合作僅限於支付或場景接入，統一掌控主要清算</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>🔍 風險描述補充</h4>
                        <ul style="font-size: 14px; line-height: 1.8;">
                            <li><strong style="color: #e74c3c;">🏦 監理風險</strong>：合規仍需依賴金管會與央行態度，特別是在小額信貸、供應鏈融資模組</li>
                            <li><strong style="color: #ff9800;">🔧 技術風險</strong>：跨鏈橋仍是潛在攻擊目標，需引入第三方安全審計及多簽管理</li>
                            <li><strong style="color: #f44336;">🏢 聲譽風險</strong>：作為大型零售品牌，任何支付故障、資金延遲都會直接影響品牌信任</li>
                        </ul>
                    </div>
                </div>
            `;
            
            summaryDiv.innerHTML = `
                <p><strong>高風險節點：</strong>3個</p>
                <p><strong>主要風險：</strong>法規不確定</p>
                <p><strong>核心風險：</strong>監理聲譽技術</p>
                <p><strong>風險緩解：</strong>分散儲備多元合規</p>
            `;
            
            metricsDiv.innerHTML = `
                <div class="kpi-grid">
                    <div class="kpi-item">
                        <div class="kpi-value">3層</div>
                        <div class="kpi-label">風險分層策略</div>
                    </div>
                    <div class="kpi-item">
                        <div class="kpi-value">100~110%</div>
                        <div class="kpi-label">儲備保障率</div>
                    </div>
                </div>
            `;
            
            renderAnalysisEcosystem(ecosystemSvg, 'risk-analysis');
        }
        
        
        // 技術基礎設施分析內容
        function loadTechInfrastructureContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg) {
            contentDiv.innerHTML = `
                <div class="detail-section">
                    <h2>⚙️ 基礎設施能力評估</h2>
                    <!-- 雙欄佈局：左側技術棧結構圖 + 右側優先排序矩陣圖 -->
                    <div style="display: flex; gap: 30px; margin-bottom: 30px;">
                        <!-- 左側：技術棧結構圖 -->
                        <div style="flex: 1; min-width: 0;">
                            <div class="detail-card">
                                <h4>🏗️ 系統架構概覽</h4>
                                <div style="position: relative; height: 500px; border: 1px solid #ddd; border-radius: 8px; background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);">
                                    <svg id="tech-stack-svg" width="100%" height="100%" viewBox="0 0 400 500"></svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右側：優先排序矩陣圖 -->
                        <div style="flex: 1; min-width: 0;">
                            <div class="detail-card">
                                <h4>🎯 部署優先度矩陣</h4>
                                <div style="position: relative; height: 500px; border: 1px solid #ddd; border-radius: 8px; background: #fff;">
                                    <svg id="priority-matrix-svg" width="100%" height="100%" viewBox="0 0 400 400"></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 結論性建議 -->
                    <div class="detail-card">
                        <h4>📝 結論性建議</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item recommendation-high" data-priority="high" style="background: linear-gradient(135deg, #d4edda, #c3e6cb); border-left: 4px solid #28a745; cursor: pointer;">
                                <div class="kpi-value" style="color: #155724; font-weight: bold;">優先部署</div>
                                <div class="kpi-label" style="font-weight: bold; margin-bottom: 8px;">零售網路、食品供應鏈、RWA</div>
                                <div style="font-size: 12px; color: #666;">
                                    <div>✓ <strong>零售網路</strong>：峰值TPS 1,500 | 戰略影響力 90%</div>
                                    <div>✓ <strong>食品供應鏈</strong>：峰值TPS 800 | 戰略影響力 85%</div>
                                    <div>✓ <strong>RWA</strong>：峰值TPS 500 | 戰略影響力 75%</div>
                                </div>
                                <div style="font-size: 11px; color: #155724; margin-top: 8px; font-weight: bold;">
                                    📊 高峰值TPS需求、高戰略影響力、部署效益明確
                                </div>
                            </div>
                            <div class="kpi-item recommendation-medium" data-priority="medium" style="background: linear-gradient(135deg, #f8d7da, #f5c6cb); border-left: 4px solid #dc3545; cursor: pointer;">
                                <div class="kpi-value" style="color: #721c24; font-weight: bold;">監管重點</div>
                                <div class="kpi-label" style="font-weight: bold; margin-bottom: 8px;">RWA、公有鏈資產管理</div>
                                <div style="font-size: 12px; color: #666;">
                                    <div>⚠️ <strong>RWA資產代幣化</strong>：法規審查嚴格</div>
                                    <div>⚠️ <strong>公有鏈資產管理</strong>：監管框架待明確</div>
                                    <div>⚠️ <strong>跨境合規</strong>：DID/Travel Rule 要求</div>
                                </div>
                                <div style="font-size: 11px; color: #721c24; margin-top: 8px; font-weight: bold;">
                                    🔍 法規要求高、需與監管機關密切配合
                                </div>
                            </div>
                            <div class="kpi-item recommendation-low" data-priority="low" style="background: linear-gradient(135deg, #e2e3e5, #d6d8db); border-left: 4px solid #6c757d; cursor: pointer;">
                                <div class="kpi-value" style="color: #495057; font-weight: bold;">延後優化</div>
                                <div class="kpi-label" style="font-weight: bold; margin-bottom: 8px;">交易場域、海外供應鏈</div>
                                <div style="font-size: 12px; color: #666;">
                                    <div>⏳ <strong>交易場域</strong>：峰值TPS 1,000 | 戰略影響力 55%</div>
                                    <div>⏳ <strong>海外供應鏈</strong>：峰值TPS 200 | 戰略影響力 35%</div>
                                    <div>⏳ <strong>跨境支付</strong>：峰值TPS 300 | 戰略影響力 45%</div>
                                </div>
                                <div style="font-size: 11px; color: #495057; margin-top: 8px; font-weight: bold;">
                                    ⏰ 技術成熟後再推進，資源優先投入核心業務
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            summaryDiv.innerHTML = `
                <p><strong>主要架構：</strong>聯盟鏈+公有鏈+混合鏈</p>
                <p><strong>最高TPS需求：</strong>1,500</p>
                <p><strong>優先部署：</strong>3個核心模組</p>
                <p><strong>監管重點：</strong>RWA與跨境合規</p>
            `;
            
            metricsDiv.innerHTML = `
                <div class="kpi-grid">
                    <div class="kpi-item">
                        <div class="kpi-value">99.99%</div>
                        <div class="kpi-label">最高SLA要求</div>
                    </div>
                    <div class="kpi-item">
                        <div class="kpi-value">1,500</div>
                        <div class="kpi-label">最高TPS需求</div>
                    </div>
                </div>
            `;
            
            // 渲染技術棧結構圖
            renderTechStack();
            
            // 渲染優先排序矩陣圖
            renderPriorityMatrix();
            
            // 移除底部環型風險分層圖，不再調用 renderAnalysisEcosystem
            
            // 添加互動功能：點擊結論區塊高亮對應節點
            setTimeout(() => {
                const recommendationItems = document.querySelectorAll('.recommendation-high, .recommendation-medium, .recommendation-low');
                
                recommendationItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const priority = this.getAttribute('data-priority');
                        highlightTechInfrastructureNodes(priority);
                    });
                });
            }, 100);
        }
        
        // 高亮技術基礎設施節點
        function highlightTechInfrastructureNodes(priority) {
            // 重置所有高亮
            const techStackSvg = document.getElementById('tech-stack-svg');
            const priorityMatrixSvg = document.getElementById('priority-matrix-svg');
            
            if (techStackSvg) {
                // 重置技術棧圖中的高亮
                const allCircles = techStackSvg.querySelectorAll('circle');
                allCircles.forEach(circle => {
                    circle.style.filter = '';
                    circle.style.strokeWidth = circle.getAttribute('stroke-width') || '2';
                });
                
                // 根據優先級高亮對應節點
                if (priority === 'high') {
                    // 高亮零售網路、食品供應鏈、RWA
                    const highPriorityNodes = ['零售網路', '食品供應鏈', 'RWA（實物資產代幣化）'];
                    allCircles.forEach(circle => {
                        const nextSibling = circle.nextSibling;
                        if (nextSibling && nextSibling.tagName === 'rect') {
                            const textElement = nextSibling.nextSibling;
                            if (textElement && highPriorityNodes.includes(textElement.textContent)) {
                                circle.style.filter = 'drop-shadow(0 0 10px #28a745)';
                                circle.style.strokeWidth = '4';
                            }
                        }
                    });
                } else if (priority === 'low') {
                    // 高亮交易場域、海外供應鏈、跨境支付
                    const lowPriorityNodes = ['交易場域', '海外供應鏈', '跨境支付'];
                    allCircles.forEach(circle => {
                        const nextSibling = circle.nextSibling;
                        if (nextSibling && nextSibling.tagName === 'rect') {
                            const textElement = nextSibling.nextSibling;
                            if (textElement && lowPriorityNodes.includes(textElement.textContent)) {
                                circle.style.filter = 'drop-shadow(0 0 10px #6c757d)';
                                circle.style.strokeWidth = '4';
                            }
                        }
                    });
                }
            }
            
            if (priorityMatrixSvg) {
                // 重置矩陣圖中的高亮
                const allBubbles = priorityMatrixSvg.querySelectorAll('circle');
                allBubbles.forEach(bubble => {
                    bubble.style.filter = '';
                    bubble.style.strokeWidth = bubble.getAttribute('stroke-width') || '2';
                });
                
                // 根據優先級高亮對應氣泡
                const modulesByPriority = {
                    'high': ['零售網路', '食品供應鏈', 'RWA'],
                    'medium': ['交易場域'],
                    'low': ['跨境支付', '海外供應鏈']
                };
                
                if (modulesByPriority[priority]) {
                    // 查找並高亮對應的氣泡
                    const labels = priorityMatrixSvg.querySelectorAll('text');
                    labels.forEach(label => {
                        if (modulesByPriority[priority].includes(label.textContent)) {
                            // 找到對應的氣泡（前一個circle元素）
                            const bubble = label.previousSibling?.previousSibling;
                            if (bubble && bubble.tagName === 'circle') {
                                const glowColor = priority === 'high' ? '#28a745' : priority === 'medium' ? '#ffc107' : '#6c757d';
                                bubble.style.filter = `drop-shadow(0 0 15px ${glowColor})`;
                                bubble.style.strokeWidth = '4';
                            }
                        }
                    });
                }
            }
        }
        
        
        // 技術架構矩陣內容
        function loadTechMatrixContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg) {
            contentDiv.innerHTML = `
                <div class="detail-section">
                    <h2>⚙️ 技術架構需求矩陣詳細分析</h2>
                    <div class="detail-card">
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; font-size: 14px; border-collapse: collapse; margin-bottom: 20px;">
                                <thead>
                                    <tr style="background: #34495e; color: white;">
                                        <th style="padding: 12px; text-align: left;">業務單位</th>
                                        <th style="padding: 12px;">鏈類型</th>
                                        <th style="padding: 12px;">TPS需求</th>
                                        <th style="padding: 12px;">SLA要求</th>
                                        <th style="padding: 12px;">延遲要求</th>
                                        <th style="padding: 12px;">建設優先級</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="background: #d4edda;">
                                        <td style="padding: 10px; font-weight: bold;">🏪 零售通路</td>
                                        <td style="padding: 10px;"><span style="background: #3498DB; color: white; padding: 2px 6px; border-radius: 4px;">聯盟鏈</span></td>
                                        <td style="padding: 10px;">1,500-2,000</td>
                                        <td style="padding: 10px;">99.9%</td>
                                        <td style="padding: 10px;">&lt;1秒</td>
                                        <td style="padding: 10px; font-weight: bold; color: #27AE60;">🚀 需優先建設</td>
                                    </tr>
                                    <tr style="background: #d4edda;">
                                        <td style="padding: 10px; font-weight: bold;">🍎 食品供應鏈</td>
                                        <td style="padding: 10px;"><span style="background: #3498DB; color: white; padding: 2px 6px; border-radius: 4px;">聯盟鏈</span></td>
                                        <td style="padding: 10px;">500-1,000</td>
                                        <td style="padding: 10px;">99.9%</td>
                                        <td style="padding: 10px;">&lt;3秒</td>
                                        <td style="padding: 10px; font-weight: bold; color: #27AE60;">🚀 需優先建設</td>
                                    </tr>
                                    <tr style="background: #fff3cd;">
                                        <td style="padding: 10px; font-weight: bold;">🏗️ 建設</td>
                                        <td style="padding: 10px;"><span style="background: #9B59B6; color: white; padding: 2px 6px; border-radius: 4px;">混合鏈</span></td>
                                        <td style="padding: 10px;">100-500</td>
                                        <td style="padding: 10px;">99.95%</td>
                                        <td style="padding: 10px;">&lt;5秒</td>
                                        <td style="padding: 10px; font-weight: bold; color: #27AE60;">🚀 需優先建設</td>
                                    </tr>
                                    <tr style="background: #fff3cd;">
                                        <td style="padding: 10px; font-weight: bold;">💎 RWA</td>
                                        <td style="padding: 10px;"><span style="background: #2ECC71; color: white; padding: 2px 6px; border-radius: 4px;">公有鏈</span></td>
                                        <td style="padding: 10px;">200-1,000</td>
                                        <td style="padding: 10px;">99.99%</td>
                                        <td style="padding: 10px;">&lt;10秒</td>
                                        <td style="padding: 10px; font-weight: bold; color: #27AE60;">🚀 需優先建設</td>
                                    </tr>
                                    <tr style="background: #fff3cd;">
                                        <td style="padding: 10px; font-weight: bold;">📈 交易所</td>
                                        <td style="padding: 10px;"><span style="background: #2ECC71; color: white; padding: 2px 6px; border-radius: 4px;">公有鏈+跨鏈橋</span></td>
                                        <td style="padding: 10px;">1,000-5,000</td>
                                        <td style="padding: 10px;">99.99%</td>
                                        <td style="padding: 10px;">&lt;2秒</td>
                                        <td style="padding: 10px; font-weight: bold; color: #27AE60;">🚀 需優先建設</td>
                                    </tr>
                                    <tr style="background: #f8d7da;">
                                        <td style="padding: 10px; font-weight: bold;">🌍 跨境貿易</td>
                                        <td style="padding: 10px;"><span style="background: #2ECC71; color: white; padding: 2px 6px; border-radius: 4px;">公有鏈+跨鏈橋</span></td>
                                        <td style="padding: 10px;">500-1,000</td>
                                        <td style="padding: 10px;">99.9%</td>
                                        <td style="padding: 10px;">&lt;5秒</td>
                                        <td style="padding: 10px; font-weight: bold; color: #E67E22;">🛡️ 監管優先關注</td>
                                    </tr>
                                    <tr style="background: #e2e3e5;">
                                        <td style="padding: 10px; font-weight: bold;">🔧 其他業務</td>
                                        <td style="padding: 10px;"><span style="background: #3498DB; color: white; padding: 2px 6px; border-radius: 4px;">聯盟鏈</span></td>
                                        <td style="padding: 10px;">100-300</td>
                                        <td style="padding: 10px;">99.5%</td>
                                        <td style="padding: 10px;">&lt;10秒</td>
                                        <td style="padding: 10px; font-weight: bold; color: #95A5A6;">📊 可延後優化</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>🏗️ 技術架構建設策略</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ebf3fd, #3498DB); color: white;">
                                <div class="kpi-value">聯盟鏈</div>
                                <div class="kpi-label">零售+食品+其他</div>
                                <div style="font-size: 11px; margin-top: 5px;">🔒 高性能+控制權</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #e8f8f5, #2ECC71); color: white;">
                                <div class="kpi-value">公有鏈</div>
                                <div class="kpi-label">RWA+交易所+跨境</div>
                                <div style="font-size: 11px; margin-top: 5px;">🌐 透明度+互操作性</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #f4f1fb, #9B59B6); color: white;">
                                <div class="kpi-value">混合架構</div>
                                <div class="kpi-label">建設業務</div>
                                <div style="font-size: 11px; margin-top: 5px;">⚖️ 彈性部署</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #fff9db, #F39C12); color: white;">
                                <div class="kpi-value">跨鏈橋</div>
                                <div class="kpi-label">國際連通</div>
                                <div style="font-size: 11px; margin-top: 5px;">🌉 跨境互通</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>📈 技術建設優先級分析</h4>
                        <ul style="font-size: 16px; line-height: 1.8;">
                            <li><strong style="color: #27AE60;">🚀 第一優先</strong>：零售、食品、建設、RWA、交易所 → 核心業務支撐</li>
                            <li><strong style="color: #E67E22;">🛡️ 監管關注</strong>：跨境貿易 → 合規要求優先考量</li>
                            <li><strong style="color: #95A5A6;">📊 延後優化</strong>：其他業務 → 資源投入最小化</li>
                            <li><strong style="color: #3498DB;">🔧 特殊需求</strong>：高頻交易、即時結算、低延遲要求</li>
                        </ul>
                    </div>
                </div>
            `;
            
            summaryDiv.innerHTML = `
                <p><strong>架構類型：</strong>混合部署</p>
                <p><strong>最高TPS：</strong>5,000</p>
                <p><strong>最高SLA：</strong>99.99%</p>
                <p><strong>優先建設：</strong>5個業務</p>
            `;
            
            metricsDiv.innerHTML = `
                <div class="kpi-grid">
                    <div class="kpi-item">
                        <div class="kpi-value">3種</div>
                        <div class="kpi-label">鏈架構類型</div>
                    </div>
                    <div class="kpi-item">
                        <div class="kpi-value">5,000</div>
                        <div class="kpi-label">最高TPS需求</div>
                    </div>
                </div>
            `;
            
            renderAnalysisEcosystem(ecosystemSvg, 'tech-infrastructure');
        }
        
        // 渲染環形風險分析圖
        function renderRingRiskAnalysis(mainGroup) {
            const centerX = 600;  // 調整中心X位置，給左側圖例更多空間
            const centerY = 550;  // 調整中心Y位置，給頂部更多空間
            
            // 定義三層風險節點 (1.5倍放大)
            const riskLayers = {
                low: {
                    radius: 180,  // 120 * 1.5
                    color: '#4caf50',
                    nodes: [
                        { name: 'TWDT', label: '穩定幣核心', angle: 0, risk: '風險極低', icon: '💵' },
                        { name: '聯盟鏈', label: '清算基礎', angle: 90, risk: '技術穩定', icon: '🔗' },
                        { name: '7-ELEVEN', label: '零售通路', angle: 180, risk: '場景穩固', icon: '🏪' },
                        { name: '合作夥伴', label: '風險分散', angle: 270, risk: '監管合規', icon: '🤝' }
                    ]
                },
                medium: {
                    radius: 330,  // 220 * 1.5
                    color: '#ff9800',
                    nodes: [
                        { name: '交易所', label: 'DeFi模組', angle: 30, risk: '流動性波動', icon: '💹' },
                        { name: 'RWA', label: '資產抵押', angle: 120, risk: '市場風險', icon: '💎' },
                        { name: '資金池', label: '利差收益', angle: 210, risk: '利率波動', icon: '💰' },
                        { name: '品牌Token', label: '聲譽管理', angle: 300, risk: '品牌信任', icon: '🌟' }
                    ]
                },
                high: {
                    radius: 480,  // 320 * 1.5
                    color: '#e74c3c',
                    nodes: [
                        { name: '跨境支付', label: '法規不確定', angle: 45, risk: '政策變動', icon: '🌍' },
                        { name: '海外供應鏈', label: '匯率波動', angle: 135, risk: '外匯風險', icon: '🏗️' },
                        { name: '大型RWA', label: '流動性風險', angle: 225, risk: '市場不景氣', icon: '🏢' }
                    ]
                }
            };
            
            // 繪製背景圓圈
            Object.entries(riskLayers).forEach(([level, layer]) => {
                const bgCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                bgCircle.setAttribute('cx', centerX);
                bgCircle.setAttribute('cy', centerY);
                bgCircle.setAttribute('r', layer.radius);
                bgCircle.setAttribute('fill', 'none');
                bgCircle.setAttribute('stroke', layer.color);
                bgCircle.setAttribute('stroke-width', '2');
                bgCircle.setAttribute('stroke-dasharray', level === 'high' ? '10,5' : level === 'medium' ? '5,3' : 'none');
                bgCircle.setAttribute('opacity', '0.3');
                mainGroup.appendChild(bgCircle);
            });
            
            // 繪製中心標籤
            const centerGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            const centerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            centerCircle.setAttribute('cx', centerX);
            centerCircle.setAttribute('cy', centerY);
            centerCircle.setAttribute('r', '75');  // 50 * 1.5
            centerCircle.setAttribute('fill', '#667eea');
            centerCircle.setAttribute('stroke', '#fff');
            centerCircle.setAttribute('stroke-width', '3');
            centerGroup.appendChild(centerCircle);
            
            const centerText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerText.setAttribute('x', centerX);
            centerText.setAttribute('y', centerY - 5);
            centerText.setAttribute('text-anchor', 'middle');
            centerText.setAttribute('fill', 'white');
            centerText.setAttribute('font-size', '21');  // 14 * 1.5
            centerText.setAttribute('font-weight', 'bold');
            centerText.textContent = '統一';
            centerGroup.appendChild(centerText);
            
            const centerSubText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerSubText.setAttribute('x', centerX);
            centerSubText.setAttribute('y', centerY + 10);
            centerSubText.setAttribute('text-anchor', 'middle');
            centerSubText.setAttribute('fill', 'white');
            centerSubText.setAttribute('font-size', '18');  // 12 * 1.5
            centerSubText.textContent = '生態圈';
            centerGroup.appendChild(centerSubText);
            
            mainGroup.appendChild(centerGroup);
            
            // 繪製各層節點
            Object.entries(riskLayers).forEach(([level, layer]) => {
                layer.nodes.forEach((node, index) => {
                    const nodeGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    
                    // 計算節點位置
                    const angleRad = (node.angle * Math.PI) / 180;
                    const nodeX = centerX + layer.radius * Math.cos(angleRad);
                    const nodeY = centerY + layer.radius * Math.sin(angleRad);
                    
                    // 節點大小依風險層級調整 (1.5倍放大)
                    const nodeSize = level === 'high' ? 67.5 : level === 'medium' ? 60 : 52.5;  // 45*1.5, 40*1.5, 35*1.5
                    
                    // 繪製節點背景
                    const nodeCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    nodeCircle.setAttribute('cx', nodeX);
                    nodeCircle.setAttribute('cy', nodeY);
                    nodeCircle.setAttribute('r', nodeSize);
                    nodeCircle.setAttribute('fill', layer.color);
                    nodeCircle.setAttribute('stroke', '#fff');
                    nodeCircle.setAttribute('stroke-width', '3');
                    nodeCircle.setAttribute('opacity', '0.8');
                    nodeGroup.appendChild(nodeCircle);
                    
                    // 風險指示圈
                    const riskRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    riskRing.setAttribute('cx', nodeX);
                    riskRing.setAttribute('cy', nodeY);
                    riskRing.setAttribute('r', nodeSize + 12);  // 8 * 1.5
                    riskRing.setAttribute('fill', 'none');
                    riskRing.setAttribute('stroke', layer.color);
                    riskRing.setAttribute('stroke-width', '2');
                    riskRing.setAttribute('stroke-dasharray', '6,3');
                    riskRing.setAttribute('opacity', '0.6');
                    nodeGroup.appendChild(riskRing);
                    
                    // 節點標題 (向上移動，避免重疊)
                    const nodeText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    nodeText.setAttribute('x', nodeX);
                    nodeText.setAttribute('y', nodeY - 15);  // 從-5改為-15，向上移動更多
                    nodeText.setAttribute('text-anchor', 'middle');
                    nodeText.setAttribute('fill', 'white');
                    nodeText.setAttribute('font-size', '14');  // 從16.5減少到14，避免太大
                    nodeText.setAttribute('font-weight', 'bold');
                    nodeText.textContent = node.name;
                    nodeGroup.appendChild(nodeText);
                    
                    // 節點圖標 (向下移動，避免重疊)
                    const iconText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    iconText.setAttribute('x', nodeX);
                    iconText.setAttribute('y', nodeY + 18);  // 從+8改為+18，向下移動更多
                    iconText.setAttribute('text-anchor', 'middle');
                    iconText.setAttribute('font-size', '20');  // 從24減少到20，避免太大
                    iconText.textContent = node.icon;
                    nodeGroup.appendChild(iconText);
                    
                    // 風險標籤（節點外側）
                    const labelX = nodeX + (nodeSize + 37.5) * Math.cos(angleRad);  // 25 * 1.5
                    const labelY = nodeY + (nodeSize + 37.5) * Math.sin(angleRad);
                    
                    const riskLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    riskLabel.setAttribute('x', labelX);
                    riskLabel.setAttribute('y', labelY);
                    riskLabel.setAttribute('text-anchor', 'middle');
                    riskLabel.setAttribute('fill', layer.color);
                    riskLabel.setAttribute('font-size', '15');  // 10 * 1.5
                    riskLabel.setAttribute('font-weight', 'bold');
                    riskLabel.textContent = node.risk;
                    nodeGroup.appendChild(riskLabel);
                    
                    // 連接到中心的線條
                    const connectionLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    connectionLine.setAttribute('x1', centerX + 75 * Math.cos(angleRad));  // 50 * 1.5
                    connectionLine.setAttribute('y1', centerY + 75 * Math.sin(angleRad));
                    connectionLine.setAttribute('x2', nodeX - nodeSize * Math.cos(angleRad));
                    connectionLine.setAttribute('y2', nodeY - nodeSize * Math.sin(angleRad));
                    connectionLine.setAttribute('stroke', layer.color);
                    connectionLine.setAttribute('stroke-width', '2');
                    connectionLine.setAttribute('opacity', '0.4');
                    connectionLine.setAttribute('stroke-dasharray', level === 'high' ? '8,4' : '4,2');
                    mainGroup.appendChild(connectionLine);
                    
                    mainGroup.appendChild(nodeGroup);
                });
            });
            
            // 添加圖例
            const legend = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            const legendData = [
                { color: '#4caf50', label: '低風險（綠色內圈）', y: 480 },   // Y軸中間位置
                { color: '#ff9800', label: '中風險（橙色中圈）', y: 520 },  // Y軸中間位置
                { color: '#e74c3c', label: '高風險（紅色外圈）', y: 560 }   // Y軸中間位置
            ];
            
            legendData.forEach((item, index) => {
                const legendCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                legendCircle.setAttribute('cx', 50);  // 移到左邊但給足夠的邊距
                legendCircle.setAttribute('cy', item.y);
                legendCircle.setAttribute('r', '12');  // 8 * 1.5
                legendCircle.setAttribute('fill', item.color);
                legend.appendChild(legendCircle);
                
                const legendText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                legendText.setAttribute('x', 75);  // 緊貼圓圈右側，給足夠的間距
                legendText.setAttribute('y', item.y + 7.5);  // 5 * 1.5
                legendText.setAttribute('font-size', '18');  // 12 * 1.5
                legendText.setAttribute('fill', '#333');
                legendText.textContent = item.label;
                legend.appendChild(legendText);
            });
            
            mainGroup.appendChild(legend);
        }
        
        // 渲染技術棧結構圖（左側）
        function renderTechStack() {
            const svg = document.getElementById('tech-stack-svg');
            if (!svg) return;
            
            svg.innerHTML = '';
            
            // 業務模組數據（統一大小，重點用文字標註）
            const businessModules = [
                { name: '零售網路', tps: 1500, radius: 28, priority: 'high', connection: '聯盟鏈', x: 80, y: 200, tpsLevel: '高TPS' },
                { name: '食品供應鏈', tps: 800, radius: 28, priority: 'high', connection: '聯盟鏈', x: 180, y: 200, tpsLevel: '中TPS' },
                { name: 'RWA（實物資產代幣化）', tps: 500, radius: 28, priority: 'high', connection: '公有鏈', x: 280, y: 200, tpsLevel: '中TPS' },
                { name: '跨境支付', tps: 300, radius: 28, priority: 'low', connection: '混合鏈', x: 120, y: 260, tpsLevel: '低TPS' },
                { name: '交易場域', tps: 1000, radius: 28, priority: 'low', connection: '公有鏈', x: 220, y: 260, tpsLevel: '高TPS' },
                { name: '海外供應鏈', tps: 200, radius: 28, priority: 'low', connection: '混合鏈', x: 320, y: 260, tpsLevel: '低TPS' }
            ];
            
            // 基礎層數據（底部寬矩形）
            const infrastructureLayers = [
                { name: '聯盟鏈', tps: '1,500-2,000', sla: '99.99%', delay: '<1秒', x: 50, y: 350, width: 120, color: '#28a745' },
                { name: '公有鏈', tps: '200-1,000', sla: '99.99%', delay: '<10秒', x: 180, y: 350, width: 100, color: '#17a2b8' },
                { name: '混合鏈', tps: '100-500', sla: '99.95%', delay: '<10秒', x: 290, y: 350, width: 90, color: '#6f42c1' }
            ];
            
            // 1. 繪製基礎層（底部寬矩形）
            infrastructureLayers.forEach(layer => {
                // 基礎層背景
                const layerRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                layerRect.setAttribute('x', layer.x);
                layerRect.setAttribute('y', layer.y);
                layerRect.setAttribute('width', layer.width);
                layerRect.setAttribute('height', '80');
                layerRect.setAttribute('fill', layer.color);
                layerRect.setAttribute('opacity', '0.15');
                layerRect.setAttribute('stroke', layer.color);
                layerRect.setAttribute('stroke-width', '2');
                layerRect.setAttribute('rx', '8');
                svg.appendChild(layerRect);
                
                // 基礎層標題
                const layerTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                layerTitle.setAttribute('x', layer.x + layer.width / 2);
                layerTitle.setAttribute('y', layer.y + 20);
                layerTitle.setAttribute('text-anchor', 'middle');
                layerTitle.setAttribute('font-size', '14');
                layerTitle.setAttribute('font-weight', 'bold');
                layerTitle.setAttribute('fill', layer.color);
                layerTitle.textContent = layer.name;
                svg.appendChild(layerTitle);
                
                // TPS指標
                const tpsText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tpsText.setAttribute('x', layer.x + layer.width / 2);
                tpsText.setAttribute('y', layer.y + 40);
                tpsText.setAttribute('text-anchor', 'middle');
                tpsText.setAttribute('font-size', '10');
                tpsText.setAttribute('fill', layer.color);
                tpsText.textContent = `TPS: ${layer.tps}`;
                svg.appendChild(tpsText);
                
                // SLA指標
                const slaText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                slaText.setAttribute('x', layer.x + layer.width / 2);
                slaText.setAttribute('y', layer.y + 55);
                slaText.setAttribute('text-anchor', 'middle');
                slaText.setAttribute('font-size', '9');
                slaText.setAttribute('fill', '#666');
                slaText.textContent = `SLA: ${layer.sla}`;
                svg.appendChild(slaText);
                
                // 延遲指標
                const delayText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                delayText.setAttribute('x', layer.x + layer.width / 2);
                delayText.setAttribute('y', layer.y + 70);
                delayText.setAttribute('text-anchor', 'middle');
                delayText.setAttribute('font-size', '9');
                delayText.setAttribute('fill', '#666');
                delayText.textContent = layer.delay;
                svg.appendChild(delayText);
            });
            
            // 2. 繪製業務層節點（中間層）
            businessModules.forEach(module => {
                // 節點背景（根據TPS調整大小）
                const nodeCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                nodeCircle.setAttribute('cx', module.x);
                nodeCircle.setAttribute('cy', module.y);
                nodeCircle.setAttribute('r', module.radius);
                nodeCircle.setAttribute('fill', '#ffc107');
                nodeCircle.setAttribute('opacity', '0.8');
                nodeCircle.setAttribute('stroke', '#fff');
                nodeCircle.setAttribute('stroke-width', '2');
                svg.appendChild(nodeCircle);
                
                // 優先級邊框（高優先用綠色邊框）
                if (module.priority === 'high') {
                    const priorityRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    priorityRing.setAttribute('cx', module.x);
                    priorityRing.setAttribute('cy', module.y);
                    priorityRing.setAttribute('r', module.radius + 5);
                    priorityRing.setAttribute('fill', 'none');
                    priorityRing.setAttribute('stroke', '#28a745');
                    priorityRing.setAttribute('stroke-width', '3');
                    priorityRing.setAttribute('stroke-dasharray', '5,3');
                    svg.appendChild(priorityRing);
                    
                    // 優先標籤
                    const priorityLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    priorityLabel.setAttribute('x', module.x + module.radius - 5);
                    priorityLabel.setAttribute('y', module.y - module.radius + 10);
                    priorityLabel.setAttribute('font-size', '8');
                    priorityLabel.setAttribute('font-weight', 'bold');
                    priorityLabel.setAttribute('fill', '#28a745');
                    priorityLabel.textContent = '優先';
                    svg.appendChild(priorityLabel);
                }
                
                // 節點文字（白色背景，黑色文字）
                const textBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                const textWidth = module.name.length * 8;
                textBg.setAttribute('x', module.x - textWidth / 2);
                textBg.setAttribute('y', module.y - 8);
                textBg.setAttribute('width', textWidth);
                textBg.setAttribute('height', '16');
                textBg.setAttribute('fill', '#fff');
                textBg.setAttribute('opacity', '0.9');
                textBg.setAttribute('rx', '8');
                textBg.setAttribute('stroke', '#ccc');
                textBg.setAttribute('stroke-width', '1');
                svg.appendChild(textBg);
                
                const nodeText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                nodeText.setAttribute('x', module.x);
                nodeText.setAttribute('y', module.y + 4);
                nodeText.setAttribute('text-anchor', 'middle');
                nodeText.setAttribute('font-size', '12');
                nodeText.setAttribute('font-weight', 'bold');
                nodeText.setAttribute('fill', '#000');
                nodeText.textContent = module.name;
                svg.appendChild(nodeText);
                
                // TPS等級標籤（節點下方）
                const tpsLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tpsLabel.setAttribute('x', module.x);
                tpsLabel.setAttribute('y', module.y + module.radius + 15);
                tpsLabel.setAttribute('text-anchor', 'middle');
                tpsLabel.setAttribute('font-size', '9');
                tpsLabel.setAttribute('fill', '#666');
                tpsLabel.setAttribute('font-weight', 'bold');
                tpsLabel.textContent = module.tpsLevel;
                svg.appendChild(tpsLabel);
                
                // 3. 連接線到基礎層
                const targetLayer = infrastructureLayers.find(layer => layer.name === module.connection);
                if (targetLayer) {
                    const targetX = targetLayer.x + targetLayer.width / 2;
                    const targetY = targetLayer.y;
                    
                    // 連接線
                    const connectionLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    connectionLine.setAttribute('x1', module.x);
                    connectionLine.setAttribute('y1', module.y + module.radius);
                    connectionLine.setAttribute('x2', targetX);
                    connectionLine.setAttribute('y2', targetY);
                    connectionLine.setAttribute('stroke', targetLayer.color);
                    connectionLine.setAttribute('stroke-width', '2');
                    connectionLine.setAttribute('opacity', '0.6');
                    connectionLine.setAttribute('stroke-dasharray', '4,2');
                    svg.appendChild(connectionLine);
                    
                    // 箭頭
                    const arrowX = targetX;
                    const arrowY = targetY - 8;
                    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    arrow.setAttribute('points', `${arrowX-4},${arrowY} ${arrowX+4},${arrowY} ${arrowX},${arrowY+8}`);
                    arrow.setAttribute('fill', targetLayer.color);
                    arrow.setAttribute('opacity', '0.8');
                    svg.appendChild(arrow);
                }
            });
            
            // 4. 添加圖例
            const legend = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            // 層級標題
            const baseTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            baseTitle.setAttribute('x', '20');
            baseTitle.setAttribute('y', '30');
            baseTitle.setAttribute('font-size', '14');
            baseTitle.setAttribute('font-weight', 'bold');
            baseTitle.setAttribute('fill', '#333');
            baseTitle.textContent = '核心層 → 服務層 → 關鍵部署層';
            svg.appendChild(baseTitle);
            
            // 優先級圖例
            const highPriorityCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            highPriorityCircle.setAttribute('cx', '30');
            highPriorityCircle.setAttribute('cy', '60');
            highPriorityCircle.setAttribute('r', '8');
            highPriorityCircle.setAttribute('fill', '#ffc107');
            highPriorityCircle.setAttribute('stroke', '#28a745');
            highPriorityCircle.setAttribute('stroke-width', '2');
            svg.appendChild(highPriorityCircle);
            
            const highPriorityText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            highPriorityText.setAttribute('x', '45');
            highPriorityText.setAttribute('y', '65');
            highPriorityText.setAttribute('font-size', '10');
            highPriorityText.setAttribute('fill', '#333');
            highPriorityText.textContent = '優先部署（綠邊框）';
            svg.appendChild(highPriorityText);
            
            const lowPriorityCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            lowPriorityCircle.setAttribute('cx', '30');
            lowPriorityCircle.setAttribute('cy', '80');
            lowPriorityCircle.setAttribute('r', '8');
            lowPriorityCircle.setAttribute('fill', '#ffc107');
            lowPriorityCircle.setAttribute('stroke', '#6c757d');
            lowPriorityCircle.setAttribute('stroke-width', '2');
            svg.appendChild(lowPriorityCircle);
            
            const lowPriorityText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            lowPriorityText.setAttribute('x', '45');
            lowPriorityText.setAttribute('y', '85');
            lowPriorityText.setAttribute('font-size', '10');
            lowPriorityText.setAttribute('fill', '#333');
            lowPriorityText.textContent = '延後優化（灰邊框）';
            svg.appendChild(lowPriorityText);
        }
        
        // 渲染優先排序矩陣圖（右側）
        function renderPriorityMatrix() {
            const svg = document.getElementById('priority-matrix-svg');
            if (!svg) return;
            
            svg.innerHTML = '';
            
            // 矩陣數據（標準散點圖，統一大小）
            const matrixData = [
                { name: '零售網路', tps: 1500, impact: 90, color: '#28a745', priority: 'high' },
                { name: '食品供應鏈', tps: 800, impact: 85, color: '#28a745', priority: 'high' },
                { name: 'RWA', tps: 500, impact: 75, color: '#28a745', priority: 'high' },
                { name: '交易場域', tps: 1000, impact: 55, color: '#ffc107', priority: 'medium' },
                { name: '跨境支付', tps: 300, impact: 45, color: '#6c757d', priority: 'low' },
                { name: '海外供應鏈', tps: 200, impact: 35, color: '#6c757d', priority: 'low' }
            ];
            
            // 設置座標系
            const margin = { top: 50, right: 50, bottom: 80, left: 80 };
            const width = 400 - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;
            
            // X軸（TPS壓力）
            const xScale = (tps) => margin.left + (tps / 1600) * width;
            
            // Y軸（戰略影響力）
            const yScale = (impact) => margin.top + height - (impact / 100) * height;
            
            // 標準散點大小（統一）
            const standardRadius = 12;
            
            // 繪製背景網格
            // X軸分段線
            const xSegments = [500, 1000, 1500];
            xSegments.forEach(tps => {
                const x = xScale(tps);
                const gridLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                gridLine.setAttribute('x1', x);
                gridLine.setAttribute('y1', margin.top);
                gridLine.setAttribute('x2', x);
                gridLine.setAttribute('y2', height + margin.top);
                gridLine.setAttribute('stroke', '#e0e0e0');
                gridLine.setAttribute('stroke-width', '1');
                gridLine.setAttribute('stroke-dasharray', '3,3');
                svg.appendChild(gridLine);
                
                // X軸刻度標籤
                const xTickLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                xTickLabel.setAttribute('x', x);
                xTickLabel.setAttribute('y', height + margin.top + 20);
                xTickLabel.setAttribute('text-anchor', 'middle');
                xTickLabel.setAttribute('font-size', '9');
                xTickLabel.setAttribute('fill', '#666');
                xTickLabel.textContent = tps;
                svg.appendChild(xTickLabel);
            });
            
            // Y軸分段線
            const ySegments = [33, 66, 100];
            const yLabels = ['低戰略影響力', '中戰略影響力', '高戰略影響力'];
            ySegments.forEach((impact, index) => {
                const y = yScale(impact);
                const gridLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                gridLine.setAttribute('x1', margin.left);
                gridLine.setAttribute('y1', y);
                gridLine.setAttribute('x2', width + margin.left);
                gridLine.setAttribute('y2', y);
                gridLine.setAttribute('stroke', '#e0e0e0');
                gridLine.setAttribute('stroke-width', '1');
                gridLine.setAttribute('stroke-dasharray', '3,3');
                svg.appendChild(gridLine);
                
                // Y軸分段標籤
                const yTickLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                yTickLabel.setAttribute('x', margin.left - 30);
                yTickLabel.setAttribute('y', y + 4);
                yTickLabel.setAttribute('text-anchor', 'middle');
                yTickLabel.setAttribute('font-size', '9');
                yTickLabel.setAttribute('fill', '#666');
                yTickLabel.textContent = yLabels[index];
                svg.appendChild(yTickLabel);
            });
            
            // 繪製座標軸
            // X軸
            const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', margin.left);
            xAxis.setAttribute('y1', height + margin.top);
            xAxis.setAttribute('x2', width + margin.left);
            xAxis.setAttribute('y2', height + margin.top);
            xAxis.setAttribute('stroke', '#333');
            xAxis.setAttribute('stroke-width', '2');
            svg.appendChild(xAxis);
            
            // Y軸
            const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', margin.left);
            yAxis.setAttribute('y1', margin.top);
            yAxis.setAttribute('x2', margin.left);
            yAxis.setAttribute('y2', height + margin.top);
            yAxis.setAttribute('stroke', '#333');
            yAxis.setAttribute('stroke-width', '2');
            svg.appendChild(yAxis);
            
            // X軸標籤
            const xLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            xLabel.setAttribute('x', margin.left + width / 2);
            xLabel.setAttribute('y', height + margin.top + 50);
            xLabel.setAttribute('text-anchor', 'middle');
            xLabel.setAttribute('font-size', '12');
            xLabel.setAttribute('font-weight', 'bold');
            xLabel.setAttribute('fill', '#333');
            xLabel.textContent = '峰值 TPS 需求 →';
            svg.appendChild(xLabel);
            
            // Y軸標籤
            const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            yLabel.setAttribute('x', 25);
            yLabel.setAttribute('y', margin.top + height / 2);
            yLabel.setAttribute('text-anchor', 'middle');
            yLabel.setAttribute('font-size', '12');
            yLabel.setAttribute('font-weight', 'bold');
            yLabel.setAttribute('fill', '#333');
            yLabel.setAttribute('transform', `rotate(-90, 25, ${margin.top + height / 2})`);
            yLabel.textContent = '戰略影響力 ↑';
            svg.appendChild(yLabel);
            
            // 繪製散點
            matrixData.forEach(item => {
                const x = xScale(item.tps);
                const y = yScale(item.impact);
                
                // 標準散點（統一大小）
                const point = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                point.setAttribute('cx', x);
                point.setAttribute('cy', y);
                point.setAttribute('r', standardRadius);
                point.setAttribute('fill', item.color);
                point.setAttribute('opacity', '0.8');
                point.setAttribute('stroke', item.color);
                point.setAttribute('stroke-width', '2');
                svg.appendChild(point);
                
                // 標籤背景（確保可讀性）
                const labelBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                const labelWidth = item.name.length * 8;
                labelBg.setAttribute('x', x - labelWidth / 2);
                labelBg.setAttribute('y', y - 10);
                labelBg.setAttribute('width', labelWidth);
                labelBg.setAttribute('height', '16');
                labelBg.setAttribute('fill', '#fff');
                labelBg.setAttribute('opacity', '0.95');
                labelBg.setAttribute('rx', '8');
                labelBg.setAttribute('stroke', '#999');
                labelBg.setAttribute('stroke-width', '1');
                svg.appendChild(labelBg);
                
                // 標籤文字（黑色）
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', y - 1);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('font-size', '11');
                label.setAttribute('font-weight', 'bold');
                label.setAttribute('fill', '#000');
                label.textContent = item.name;
                svg.appendChild(label);
                
                // 數據標籤（峰值TPS和戰略影響力）
                const dataLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                dataLabel.setAttribute('x', x);
                dataLabel.setAttribute('y', y + standardRadius + 18);
                dataLabel.setAttribute('text-anchor', 'middle');
                dataLabel.setAttribute('font-size', '8');
                dataLabel.setAttribute('fill', '#666');
                dataLabel.textContent = `TPS:${item.tps} | 影響:${item.impact}%`;
                svg.appendChild(dataLabel);
            });
            
            // 圖例
            const legendData = [
                { color: '#28a745', label: '優先部署', x: 280, y: 25 },
                { color: '#ffc107', label: '中期部署', x: 280, y: 40 },
                { color: '#6c757d', label: '延後優化', x: 280, y: 55 }
            ];
            
            legendData.forEach(item => {
                const legendCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                legendCircle.setAttribute('cx', item.x);
                legendCircle.setAttribute('cy', item.y);
                legendCircle.setAttribute('r', '6');
                legendCircle.setAttribute('fill', item.color);
                legendCircle.setAttribute('opacity', '0.8');
                svg.appendChild(legendCircle);
                
                const legendText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                legendText.setAttribute('x', item.x + 15);
                legendText.setAttribute('y', item.y + 4);
                legendText.setAttribute('font-size', '10');
                legendText.setAttribute('fill', '#333');
                legendText.textContent = item.label;
                svg.appendChild(legendText);
            });
            
            // 指標定義說明框
            const definitionBox = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            definitionBox.setAttribute('x', '20');
            definitionBox.setAttribute('y', '15');
            definitionBox.setAttribute('width', '180');
            definitionBox.setAttribute('height', '45');
            definitionBox.setAttribute('fill', '#f8f9fa');
            definitionBox.setAttribute('stroke', '#dee2e6');
            definitionBox.setAttribute('stroke-width', '1');
            definitionBox.setAttribute('rx', '4');
            svg.appendChild(definitionBox);
            
            const definitionTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            definitionTitle.setAttribute('x', '25');
            definitionTitle.setAttribute('y', '30');
            definitionTitle.setAttribute('font-size', '10');
            definitionTitle.setAttribute('font-weight', 'bold');
            definitionTitle.setAttribute('fill', '#495057');
            definitionTitle.textContent = '指標定義：';
            svg.appendChild(definitionTitle);
            
            const definition1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            definition1.setAttribute('x', '25');
            definition1.setAttribute('y', '43');
            definition1.setAttribute('font-size', '8');
            definition1.setAttribute('fill', '#6c757d');
            definition1.textContent = '• 峰值TPS需求：模組在高峰期的交易處理量需求';
            svg.appendChild(definition1);
            
            const definition2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            definition2.setAttribute('x', '25');
            definition2.setAttribute('y', '55');
            definition2.setAttribute('font-size', '8');
            definition2.setAttribute('fill', '#6c757d');
            definition2.textContent = '• 戰略影響力：模組對整體生態的戰略必要性';
            svg.appendChild(definition2);
        }
        
        // 渲染分析生態圖
        function renderAnalysisEcosystem(svg, analysisType) {
            // 確保SVG存在
            if (!svg) {
                console.error('SVG element not found');
                return;
            }
            
            // 設置SVG基本屬性 (調整viewBox以容納1.5倍放大的圖形)
            svg.setAttribute('viewBox', '0 0 1200 1200');  // 進一步擴大範圍
            svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
            svg.style.width = '100%';
            svg.style.height = '800px';  // 增加顯示高度到800px
            
            // 清空SVG
            svg.innerHTML = '';
            
            // 創建主要組
            const mainGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            svg.appendChild(mainGroup);
            
            // 如果是風險分析，使用新的環形分層設計
            if (analysisType === 'risk-analysis') {
                renderRingRiskAnalysis(mainGroup);
                return;
            }
            
            // 簡化的節點位置（適合小型顯示）
            const miniNodes = [
                { id: 'stablecoin', name: '穩定幣', x: 400, y: 200, type: 'core' },
                { id: 'retail', name: '零售', x: 200, y: 100, type: 'business' },
                { id: 'food', name: '食品', x: 600, y: 100, type: 'business' },
                { id: 'crossborder', name: '跨境', x: 150, y: 200, type: 'business' },
                { id: 'construction', name: '建設', x: 300, y: 300, type: 'business' },
                { id: 'rwa', name: 'RWA', x: 500, y: 300, type: 'finance' },
                { id: 'exchange', name: '交易所', x: 650, y: 200, type: 'finance' }
            ];
            
            // 繪製連接線
            const connections = [
                { from: 'stablecoin', to: 'retail' },
                { from: 'stablecoin', to: 'food' },
                { from: 'stablecoin', to: 'crossborder' },
                { from: 'stablecoin', to: 'construction' },
                { from: 'stablecoin', to: 'rwa' },
                { from: 'stablecoin', to: 'exchange' }
            ];
            
            connections.forEach(conn => {
                const sourceNode = miniNodes.find(n => n.id === conn.from);
                const targetNode = miniNodes.find(n => n.id === conn.to);
                
                if (sourceNode && targetNode) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', sourceNode.x);
                    line.setAttribute('y1', sourceNode.y);
                    line.setAttribute('x2', targetNode.x);
                    line.setAttribute('y2', targetNode.y);
                    line.setAttribute('stroke', '#ccc');
                    line.setAttribute('stroke-width', '2');
                    line.setAttribute('opacity', '0.6');
                    mainGroup.appendChild(line);
                }
            });
            
            // 根據分析類型設置不同的視覺效果
            miniNodes.forEach(node => {
                const nodeGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // 基礎圓形
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', '54');
                circle.setAttribute('fill', getAnalysisNodeColor(node.type, analysisType));
                circle.setAttribute('stroke', '#fff');
                circle.setAttribute('stroke-width', '2');
                
                // 節點文字
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + 5);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '12');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.name;
                
                // 根據分析類型添加特效
                if (analysisType === 'value-flow') {
                    addValueFlowEffect(nodeGroup, node);
                } else if (analysisType === 'risk-analysis') {
                    addRiskEffect(nodeGroup, node);
                } else if (analysisType === 'tech-infrastructure') {
                    addTechEffect(nodeGroup, node);
                } else if (analysisType === 'efficiency') {
                    addEfficiencyEffect(nodeGroup, node);
                }
                
                nodeGroup.appendChild(circle);
                nodeGroup.appendChild(text);
                mainGroup.appendChild(nodeGroup);
            });
        }
        
        
        // 獲取分析節點顏色
        function getAnalysisNodeColor(type, analysisType) {
            if (analysisType === 'value-flow') {
                return type === 'core' ? '#667eea' : '#2ECC71';
            } else if (analysisType === 'risk-analysis') {
                return type === 'core' ? '#667eea' : '#E74C3C';
            } else if (analysisType === 'tech-infrastructure') {
                return type === 'core' ? '#667eea' : '#3498DB';
            } else if (analysisType === 'efficiency') {
                return type === 'core' ? '#667eea' : '#27AE60';
            }
            return getNodeColor(type);
        }
        
        // 添加價值流效果
        function addValueFlowEffect(nodeGroup, node) {
            if (['retail', 'crossborder', 'food'].includes(node.id)) {
                const pulse = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                pulse.setAttribute('cx', node.x);
                pulse.setAttribute('cy', node.y);
                pulse.setAttribute('r', '35');
                pulse.setAttribute('fill', 'none');
                pulse.setAttribute('stroke', '#FFD700');
                pulse.setAttribute('stroke-width', '3');
                pulse.setAttribute('opacity', '0.8');
                nodeGroup.appendChild(pulse);
            }
        }
        
        // 添加風險效果
        function addRiskEffect(nodeGroup, node) {
            const riskColors = {
                'crossborder': '#E74C3C',
                'construction': '#E74C3C', 
                'rwa': '#F39C12',
                'exchange': '#F39C12',
                'food': '#F39C12'
            };
            
            if (riskColors[node.id]) {
                const riskRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                riskRing.setAttribute('cx', node.x);
                riskRing.setAttribute('cy', node.y);
                riskRing.setAttribute('r', '35');
                riskRing.setAttribute('fill', 'none');
                riskRing.setAttribute('stroke', riskColors[node.id]);
                riskRing.setAttribute('stroke-width', '3');
                riskRing.setAttribute('opacity', '0.8');
                nodeGroup.appendChild(riskRing);
            }
        }
        
        
        // 添加技術效果
        function addTechEffect(nodeGroup, node) {
            const techColors = {
                'retail': '#3498DB',
                'food': '#3498DB',
                'rwa': '#2ECC71',
                'exchange': '#2ECC71',
                'construction': '#9B59B6',
                'crossborder': '#2ECC71'
            };
            
            if (techColors[node.id]) {
                const techRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                techRing.setAttribute('cx', node.x);
                techRing.setAttribute('cy', node.y);
                techRing.setAttribute('r', '35');
                techRing.setAttribute('fill', 'none');
                techRing.setAttribute('stroke', techColors[node.id]);
                techRing.setAttribute('stroke-width', '3');
                techRing.setAttribute('stroke-dasharray', '6,3');
                techRing.setAttribute('opacity', '0.8');
                nodeGroup.appendChild(techRing);
            }
        }
        
        // 添加效益分析效果
        function addEfficiencyEffect(nodeGroup, node) {
            const efficiencyColors = {
                'retail': '#27AE60',
                'food': '#27AE60',
                'construction': '#F39C12',
                'rwa': '#F39C12',
                'crossborder': '#3498DB',
                'exchange': '#3498DB'
            };
            
            if (efficiencyColors[node.id]) {
                const efficiencyRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                efficiencyRing.setAttribute('cx', node.x);
                efficiencyRing.setAttribute('cy', node.y);
                efficiencyRing.setAttribute('r', '35');
                efficiencyRing.setAttribute('fill', 'none');
                efficiencyRing.setAttribute('stroke', efficiencyColors[node.id]);
                efficiencyRing.setAttribute('stroke-width', '3');
                efficiencyRing.setAttribute('stroke-dasharray', '4,2');
                efficiencyRing.setAttribute('opacity', '0.8');
                
                // 添加動畫效果
                const animate = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
                animate.setAttribute('attributeName', 'stroke-dashoffset');
                animate.setAttribute('from', '0');
                animate.setAttribute('to', '12');
                animate.setAttribute('dur', '3s');
                animate.setAttribute('repeatCount', 'indefinite');
                efficiencyRing.appendChild(animate);
                
                nodeGroup.appendChild(efficiencyRing);
            }
        }
        
        // 綜合效益分析
        function showEfficiencyAnalysis() {
            showAnalysisDetailPage('efficiency-analysis', '💰 綜合效益分析', '統一集團導入穩定幣與區塊鏈技術的完整效益評估與成本分析');
        }
        
        // 綜合效益分析內容
        function loadEfficiencyAnalysisContent(contentDiv, summaryDiv, metricsDiv, ecosystemSvg) {
            contentDiv.innerHTML = `
                <div class="detail-section">
                    <h2>💰 穩定幣與區塊鏈導入效益分析</h2>
                    
                    <div class="detail-card">
                        <h4>💵 一、直接成本節省（年度）</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item" style="background: linear-gradient(135deg, #d4edda, #c3e6cb);">
                                <div class="kpi-value" style="color: #27AE60; font-size: 20px;">15-60億</div>
                                <div class="kpi-label">手續費節省</div>
                                <div style="font-size: 11px; margin-top: 5px;">信用卡/反手續費1.5-3% → 鏈上分之幾</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #cce5ff, #b3d9ff);">
                                <div class="kpi-value" style="color: #0066cc; font-size: 20px;">1-3億</div>
                                <div class="kpi-label">跨境匯兌成本降低</div>
                                <div style="font-size: 11px; margin-top: 5px;">跨境匯款2-5% → 即時區塊鏈轉帳</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffeaa7, #fdcb6e);">
                                <div class="kpi-value" style="color: #e17055; font-size: 20px;">0.5-1億</div>
                                <div class="kpi-label">流程自動化降本</div>
                                <div style="font-size: 11px; margin-top: 5px;">對帳/稽核自動化，智能合約自動化</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffe6cc, #ffd9b3);">
                                <div class="kpi-value" style="color: #cc6600; font-size: 20px;">2.5億</div>
                                <div class="kpi-label">食品召回降本</div>
                                <div style="font-size: 11px; margin-top: 5px;">精準溯源每案最高2.5億</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>📈 二、開源項目（新收益來源）</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item" style="background: linear-gradient(135deg, #d4edda, #c3e6cb);">
                                <div class="kpi-value" style="color: #27AE60; font-size: 18px;">4-10億</div>
                                <div class="kpi-label">穩定幣資金沉澱利息</div>
                                <div style="font-size: 11px; margin-top: 5px;">儲備金規模與短債定存利差</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #cce5ff, #b3d9ff);">
                                <div class="kpi-value" style="color: #0066cc; font-size: 18px;">2-8億</div>
                                <div class="kpi-label">NFT/禮券二級市場</div>
                                <div style="font-size: 11px; margin-top: 5px;">平台抽成，參考星巴克/樂天案例</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffeaa7, #fdcb6e);">
                                <div class="kpi-value" style="color: #e17055; font-size: 18px;">2-6億</div>
                                <div class="kpi-label">供應鏈金融新收入</div>
                                <div style="font-size: 11px; margin-top: 5px;">B2B智能結算加值、融資服務</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffe6cc, #ffd9b3);">
                                <div class="kpi-value" style="color: #cc6600; font-size: 18px;">3-7億</div>
                                <div class="kpi-label">會員經濟活化</div>
                                <div style="font-size: 11px; margin-top: 5px;">跨平台行銷增收、用戶增長</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #f0ccff, #e6b3ff);">
                                <div class="kpi-value" style="color: #8000ff; font-size: 18px;">1-3億</div>
                                <div class="kpi-label">跨境匯款服務</div>
                                <div style="font-size: 11px; margin-top: 5px;">移工市場服務收入</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffcccc, #ffb3b3);">
                                <div class="kpi-value" style="color: #cc0000; font-size: 18px;">0.5-2億</div>
                                <div class="kpi-label">API/生態授權</div>
                                <div style="font-size: 11px; margin-top: 5px;">平台數據/金流API技術年費</div>
                            </div>
                        </div>
                        <p style="margin-top: 15px; font-size: 14px; color: #666;"><strong>小計：</strong>12.5-36億（保守估算，需視實際推廣成效調整）</p>
                    </div>
                    
                    <div class="detail-card">
                        <h4>📈 三、潛在利益與正面效益</h4>
                        <ul style="font-size: 16px; line-height: 1.8;">
                            <li><strong style="color: #27AE60;">💰 結算效率提升</strong>：24/7即時結算，資金無需在途，減少流動資金閒置損失</li>
                            <li><strong style="color: #3498DB;">🎯 消費誘因創新</strong>：穩定幣專屬折扣、現金回饋、持有利息，提升會員黏著度</li>
                            <li><strong style="color: #E67E22;">👥 新客層拓展</strong>：移工、年輕族群、無卡戶更易進入數位支付圈</li>
                            <li><strong style="color: #9B59B6;">📊 數據自主權</strong>：完整掌控交易數據，展開全生態會員分析與精準行銷</li>
                            <li><strong style="color: #E74C3C;">🤝 議價能力提升</strong>：自家結算系統強化與銀行、金融機構談判力</li>
                            <li><strong style="color: #F39C12;">⚡ 供應鏈創新</strong>：智能合約「驗收即撥款」，縮短請款流程</li>
                            <li><strong style="color: #2ECC71;">🎨 數位資產經濟</strong>：NFT會員、積分流通、數位收藏品新收益</li>
                            <li><strong style="color: #34495E;">🌱 ESG永續加分</strong>：碳權交易、ESG資訊上鏈，強化品牌永續形象</li>
                        </ul>
                    </div>
                    
                    <div class="detail-card">
                        <h4>🎯 三、中長期戰略好處</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item" style="background: linear-gradient(135deg, #e8f8f5, #d1f2eb);">
                                <div style="color: #27AE60; font-weight: bold;">資金韌性</div>
                                <div style="font-size: 12px; margin-top: 5px;">降低對傳統銀行清算的依賴，確保資金即時結算與流動</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ebf3fd, #d6eaff);">
                                <div style="color: #3498DB; font-weight: bold;">內外雙循環經濟</div>
                                <div style="font-size: 12px; margin-top: 5px;">穩定幣同時支持企業內部結算與對外支付，兼顧內部效率與外部商業價值</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #fff9e6, #fff2cc);">
                                <div style="color: #F39C12; font-weight: bold;">數位金融領先</div>
                                <div style="font-size: 12px; margin-top: 5px;">率先推動合規穩定幣在零售、供應鏈、跨境領域的應用</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #f4e6ff, #e6ccff);">
                                <div style="color: #9B59B6; font-weight: bold;">產業標準制定</div>
                                <div style="font-size: 12px; margin-top: 5px;">穩定幣應用模式成為零售與供應鏈行業的參考標準，提升議價與話語權</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>📊 四、總合計算</h4>
                        <div class="kpi-grid">
                            <div class="kpi-item" style="background: linear-gradient(135deg, #d4edda, #c3e6cb); border: 3px solid #27AE60;">
                                <div class="kpi-value" style="color: #27AE60; font-size: 24px; font-weight: bold;">16.5-66.5億</div>
                                <div class="kpi-label" style="font-weight: bold;">直接金流節省</div>
                                <div style="font-size: 11px; margin-top: 5px;">年化計算，不含偶發召回案例</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #cce5ff, #b3d9ff); border: 3px solid #0066cc;">
                                <div class="kpi-value" style="color: #0066cc; font-size: 24px; font-weight: bold;">12.5-36億</div>
                                <div class="kpi-label" style="font-weight: bold;">開源項目收益</div>
                                <div style="font-size: 11px; margin-top: 5px;">保守估算，需視推廣成效調整</div>
                            </div>
                            <div class="kpi-item" style="background: linear-gradient(135deg, #ffeaa7, #fdcb6e); border: 3px solid #f39c12;">
                                <div class="kpi-value" style="color: #e17055; font-size: 26px; font-weight: bold;">28.5-102.5億</div>
                                <div class="kpi-label" style="font-weight: bold;">總合計效益</div>
                                <div style="font-size: 11px; margin-top: 5px;">若含多案召回、產業升級成效可上看120億</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745;">
                            <p style="margin: 0; font-size: 14px; color: #333;"><strong>附註：</strong>節省部分金額依據年交易額、手續費率、現有商業案例直接換算。開源部分多屬彈性推估，需視實際推廣成效調整。</p>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>📋 五、效益總結表</h4>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; font-size: 14px; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #34495e; color: white;">
                                        <th style="padding: 12px; text-align: left;">類型</th>
                                        <th style="padding: 12px;">預估效益</th>
                                        <th style="padding: 12px;">說明</th>
                                        <th style="padding: 12px;">產業證據</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="background: #d4edda;">
                                        <td style="padding: 10px; font-weight: bold;">手續費節省</td>
                                        <td style="padding: 10px;">15-60億元/年</td>
                                        <td style="padding: 10px;">依據外部客戶收入基礎計算</td>
                                        <td style="padding: 10px;">Walmart、CVS實證</td>
                                    </tr>
                                    <tr style="background: #cce5ff;">
                                        <td style="padding: 10px; font-weight: bold;">匯兌節省</td>
                                        <td style="padding: 10px;">1-3億元/年</td>
                                        <td style="padding: 10px;">跨境區塊鏈應用</td>
                                        <td style="padding: 10px;">現行交易規模推算</td>
                                    </tr>
                                    <tr style="background: #ffe6cc;">
                                        <td style="padding: 10px; font-weight: bold;">食品召回</td>
                                        <td style="padding: 10px;">每案最高2.5億</td>
                                        <td style="padding: 10px;">精準召回vs傳統方式</td>
                                        <td style="padding: 10px;">IBM Food Trust案例</td>
                                    </tr>
                                    <tr style="background: #f0ccff;">
                                        <td style="padding: 10px; font-weight: bold;">流程自動化</td>
                                        <td style="padding: 10px;">數千萬-1億+/年</td>
                                        <td style="padding: 10px;">對帳、合約、撥款自動化</td>
                                        <td style="padding: 10px;">美國政府採購案例</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            summaryDiv.innerHTML = `
                <p><strong>最高年節省：</strong>66.5億/年</p>
                <p><strong>綜合效益：</strong>28.5-102.5億/年</p>
                <p><strong>戰略價值：</strong>極高</p>
                <p><strong>產業地位：</strong>先行者優勢</p>
            `;
            
            metricsDiv.innerHTML = `
                <div class="kpi-grid">
                    <div class="kpi-item">
                        <div class="kpi-value">66.5億</div>
                        <div class="kpi-label">最高年節省</div>
                    </div>
                    <div class="kpi-item">
                        <div class="kpi-value">28.5-102.5億</div>
                        <div class="kpi-label">綜合效益</div>
                    </div>
                </div>
            `;
            
            // Chart removed as requested
        }
        
        // 搜尋節點
        function searchNodes(query) {
            if (!query) {
                resetView();
                return;
            }
            
            const lowQuery = query.toLowerCase();
            
            // 重置所有節點
            document.querySelectorAll('.node').forEach(n => {
                n.style.opacity = '0.3';
            });
            
            // 高亮匹配的節點
            nodes.forEach(node => {
                if (node.name.toLowerCase().includes(lowQuery) || 
                    node.info.toLowerCase().includes(lowQuery)) {
                    const nodeElement = document.querySelector(`[data-id="${node.id}"]`);
                    if (nodeElement) {
                        nodeElement.style.opacity = '1';
                        
                        // 添加搜索高亮效果
                        const circle = nodeElement.querySelector('circle');
                        circle.setAttribute('filter', 'url(#glow)');
                    }
                }
            });
        }
        
        // 按類型過濾
        function filterByType(type) {
            // 重置所有元素
            document.querySelectorAll('.node').forEach(n => {
                n.style.opacity = '0.3';
            });
            document.querySelectorAll('.link').forEach(l => {
                l.style.opacity = '0.1';
            });
            
            // 只高亮選中類型的節點，不顯示連接
            nodes.filter(n => n.type === type).forEach(node => {
                const nodeElement = document.querySelector(`[data-id="${node.id}"]`);
                if (nodeElement) {
                    nodeElement.style.opacity = '1';
                }
            });
            
            // 只高亮同類型節點之間的連線
            const typeNodeIds = nodes.filter(n => n.type === type).map(n => n.id);
            document.querySelectorAll('.link').forEach(link => {
                const source = link.dataset.source;
                const target = link.dataset.target;
                if (typeNodeIds.includes(source) && typeNodeIds.includes(target)) {
                    link.style.opacity = '0.8';
                }
            });
        }
        
        // 重置視圖
        function resetView() {
            // 重置所有元素
            document.querySelectorAll('.node').forEach(n => {
                n.style.opacity = '1';
            });
            document.querySelectorAll('.link').forEach(l => {
                l.style.opacity = '0.6';
                const linkData = links.find(link => 
                    (link.source === l.dataset.source && link.target === l.dataset.target) ||
                    (link.source === l.dataset.target && link.target === l.dataset.source)
                );
                l.setAttribute('stroke-width', linkData?.strength || '2');
                l.setAttribute('stroke', getLineColor(linkData?.type || 'flow'));
            });
            
            // 移除臨時元素
            document.querySelectorAll('.flow-number').forEach(n => n.remove());
            document.querySelectorAll('.risk-indicator').forEach(n => n.remove());
            document.querySelectorAll('.flow-particle').forEach(n => n.remove());
            
            // 隱藏信息面板
            hideInfoPanel();
            
            // 恢復圖例顯示，隱藏流程說明
            document.querySelector('.legend').style.display = 'block';
            document.getElementById('flow-description').style.display = 'none';
            
            // 重置按鈕狀態
            document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        }
        
        // 切換動畫
        function toggleAnimation() {
            animationEnabled = !animationEnabled;
            event.target.classList.toggle('active');
            initSVG();
        }
        
        // 顯示所有連接
        function resetView() {
            // 重置所有節點和連線的透明度
            document.querySelectorAll('.node').forEach(n => {
                n.style.opacity = '1';
            });
            document.querySelectorAll('.link').forEach(l => {
                l.style.opacity = '0.6';
                l.style.strokeWidth = '2';
            });
            
            // 重置按鈕狀態
            document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        }

        function showAllConnections() {
            resetView();
            event.target.classList.add('active');
            
            // 確保圖例顯示
            document.querySelector('.legend').style.display = 'block';
            document.getElementById('flow-description').style.display = 'none';
            
            // 高亮所有連接線
            document.querySelectorAll('.link').forEach(l => {
                l.style.opacity = '1';
                const linkData = links.find(link => 
                    (link.source === l.dataset.source && link.target === l.dataset.target) ||
                    (link.source === l.dataset.target && link.target === l.dataset.source)
                );
                l.setAttribute('stroke-width', (linkData?.strength || 2) + 1);
            });
            
            // 為不同類型的連接添加視覺區分
            links.forEach((link, index) => {
                setTimeout(() => {
                    const linkElement = document.querySelector(
                        `[data-source="${link.source}"][data-target="${link.target}"], 
                         [data-source="${link.target}"][data-target="${link.source}"]`
                    );
                    if (linkElement) {
                        linkElement.style.animation = `pulse 1s ${index * 0.1}s ease-in-out infinite`;
                    }
                }, index * 50);
            });
        }
        
        // 設置縮放功能
        function setupDragAndZoom() {
            // 滾輪縮放
            svg.addEventListener('wheel', (e) => {
                e.preventDefault();
                const rect = svg.getBoundingClientRect();
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                const newZoom = currentZoom * delta;
                
                if (newZoom >= 0.8 && newZoom <= 2) {
                    currentZoom = newZoom;
                    updateTransform();
                }
            });
            
            // 觸控支持
            let touches = [];
            svg.addEventListener('touchstart', (e) => {
                touches = Array.from(e.touches);
            });
            
            svg.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (e.touches.length === 2 && touches.length === 2) {
                    // 雙指縮放
                    const dist1 = Math.hypot(
                        touches[0].clientX - touches[1].clientX,
                        touches[0].clientY - touches[1].clientY
                    );
                    const dist2 = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );
                    
                    const scale = dist2 / dist1;
                    const newZoom = currentZoom * scale;
                    if (newZoom >= 0.8 && newZoom <= 2) {
                        currentZoom = newZoom;
                        updateTransform();
                    }
                    
                    touches = Array.from(e.touches);
                }
            });
        }
        
        
        function updateTransform() {
            const mainGroup = document.getElementById('main-group');
            if (mainGroup) {
                mainGroup.setAttribute('transform', `scale(${currentZoom})`);
            }
        }
        
        // 縮放控制
        function zoomIn() {
            currentZoom *= 1.2;
            currentZoom = Math.min(currentZoom, 3);
            updateTransform();
        }
        
        function zoomOut() {
            currentZoom *= 0.8;
            currentZoom = Math.max(currentZoom, 0.5);
            updateTransform();
        }
        
        function resetZoom() {
            currentZoom = 1;
            updateTransform();
            resetView();
        }
        
        // 添加CSS動畫
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0%, 100% { opacity: 0.6; }
                50% { opacity: 1; }
            }
            
            .node {
                transition: opacity 0.3s ease;
            }
            
            .link {
                transition: opacity 0.3s ease, stroke-width 0.3s ease;
            }
            
            .flow-particle {
                mix-blend-mode: screen;
            }
            
            .info-panel-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                display: none;
            }
            
            .flow-description {
                background: #f8f9fa;
                border-radius: 15px;
                padding: 25px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                border-left: 4px solid #667eea;
                animation: slideIn 0.3s ease;
                height: 100%;
                overflow-y: auto;
            }
            
            .flow-header {
                border-bottom: 2px solid #e9ecef;
                padding-bottom: 20px;
                margin-bottom: 25px;
            }
            
            .flow-section {
                background: white;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            }
            
            .flow-section h4 {
                color: #2c3e50;
                font-size: 1.1em;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 8px;
                border-bottom: 1px solid #e9ecef;
                padding-bottom: 10px;
            }
            
            .flow-section ul {
                margin: 15px 0;
                padding-left: 20px;
            }
            
            .flow-section li {
                color: #555;
                font-size: 0.95em;
                line-height: 1.6;
                margin: 10px 0;
                padding: 5px 0;
            }
            
            .flow-section p {
                color: #666;
                font-size: 1em;
                line-height: 1.6;
                margin: 10px 0;
            }
            
            /* 流程詳情頁面樣式 */
            .flow-detail-page {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100vh;
                background: #f8f9fa;
                z-index: 2000;
                overflow-y: auto;
                padding: 40px;
                box-sizing: border-box;
            }
            
            .flow-detail-header {
                display: flex;
                align-items: center;
                gap: 30px;
                margin-bottom: 40px;
                padding-bottom: 30px;
                border-bottom: 3px solid #e9ecef;
            }
            
            .back-btn {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                transition: all 0.3s;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .back-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
            }
            
            .flow-detail-title h1 {
                font-size: 2.5em;
                margin: 0;
                background: linear-gradient(135deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            .flow-detail-title p {
                font-size: 1.2em;
                color: #666;
                margin: 10px 0 0 0;
            }
            
            .flow-detail-content {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 40px;
                margin-bottom: 40px;
            }
            
            .detail-section {
                margin-bottom: 30px;
            }
            
            .detail-section h2 {
                color: #2c3e50;
                font-size: 1.5em;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .detail-card {
                background: white;
                border-radius: 15px;
                padding: 25px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                border-left: 4px solid #667eea;
            }
            
            .detail-card p {
                font-size: 1.1em;
                line-height: 1.8;
                color: #555;
                margin: 0;
            }
            
            .detail-card ul {
                margin: 0;
                padding-left: 20px;
            }
            
            .detail-card li {
                font-size: 1.05em;
                line-height: 1.8;
                color: #555;
                margin: 15px 0;
                padding: 10px 0;
                border-bottom: 1px solid #f0f0f0;
            }
            
            .kpi-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .kpi-item {
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                border-left: 4px solid #667eea;
            }
            
            .kpi-value {
                font-size: 2em;
                font-weight: bold;
                color: #667eea;
                margin-bottom: 5px;
            }
            
            .kpi-label {
                color: #666;
                font-size: 0.9em;
            }
            
            .flow-detail-ecosystem {
                background: white;
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.1);
                border: 2px solid #e9ecef;
            }
            
            .flow-detail-ecosystem h2 {
                color: #2c3e50;
                font-size: 1.8em;
                margin-bottom: 20px;
                text-align: center;
            }
            
            .mini-ecosystem {
                background: #fafafa;
                border-radius: 15px;
                overflow: hidden;
                border: 1px solid #e9ecef;
            }
            
            .related-nodes {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
            
            .related-node-item {
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                padding: 15px;
                border-radius: 10px;
                border-left: 4px solid #667eea;
                transition: all 0.3s;
            }
            
            .related-node-item:hover {
                transform: translateX(5px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }
            
            .related-node-name {
                font-weight: bold;
                color: #2c3e50;
                margin-bottom: 5px;
            }
            
            .related-node-desc {
                color: #666;
                font-size: 0.9em;
                line-height: 1.5;
            }
        `;
        document.head.appendChild(style);
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            initSVG();
        });
    </script>
    
    <!-- 必要元素：Tooltip -->
    <div id="tooltip" style="position: absolute; background: rgba(0,0,0,0.9); color: white; padding: 10px; border-radius: 5px; font-size: 12px; pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 1000;"></div>
</body>
</html>
